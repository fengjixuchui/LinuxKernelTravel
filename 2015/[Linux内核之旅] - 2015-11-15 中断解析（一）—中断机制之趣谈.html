<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		中断解析（一）—中断机制之趣谈
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=405389777&amp;idx=2&amp;sn=5b64c68ef2e653b8895563f7f6508ab3&amp;chksm=76b6ec3441c165224773b674ba844f470832409f4b7acc517c4e8ecbf2bade3d37ac5cbeb556&amp;scene=27#wechat_redirect&cpage=86' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">中断解析（一）—中断机制之趣谈</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2015-11-15</em>





                </div>

                
                
                                
                
                
                
                                                
                                <div class="rich_media_thumb_wrp" id="media">
                    
                                        
                                    </div>
                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">中断的汉语解释是半中间发生阻隔、停顿或故障而断开。那么，在计算机系统中，我们为什么需要“阻隔、停顿和断开”呢？</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">举个日常生活中的例子，比如说我正在厨房用煤气烧一壶水，这样就只能守在厨房里，苦苦等着水开——如果水溢出来浇灭了煤气，有可能就要发生一场灾难了。等啊等啊，外边突然传来了惊奇的叫声“怎么不关水龙头？”于是我惭愧的发现，刚才接水之后只顾着抱怨这份无聊的差事，居然忘了这事，于是慌慌张张的冲向水管，三下两下关了龙头，声音又传到耳边，“怎么干什么都是这么马虎？”。伸伸舌头，这件小事就这么过去了，我落寞的眼神又落在了水壶上。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">门外忽然又传来了铿锵有力的歌声，我最喜欢的古装剧要开演了，真想夺门而出，然而，听着水壶发出“咕嘟咕嘟”的声音，我清楚：除非等到水开，否则没有我享受人生的时候。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">这个场景跟中断有什么关系呢？</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">如果说我专心致志等待水开是一个过程的话，那么叫声、电视里传出的音乐不都让这个过程“半中间发生阻隔、停顿或故障而断开”了吗？这不就是活生生的“中断”吗？</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">在这个场景中，我是唯一具有处理能力的主体，不管是烧水、关水龙头还是看电视，同一个时间点上我只能干一件事情。但是，在我专心致志干一件事情时，总有许多或紧迫或不紧迫的事情突然出现在面前，都需要去关注，有些还需要我停下手头的工作马上去处理。只有在处理完之后，方能回头完成先前的任务，“把一壶水彻底烧开！”</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">中断机制不仅赋予了我处理意外情况的能力，如果我能充分发挥这个机制的妙用，就可以“同时”完成多个任务了。回到烧水的例子，实际上，无论我在不在厨房，煤气灶总是会把水烧开的，我要做的，只不过是及时关掉煤气灶而已，为了这么一个一秒钟就能完成的动作，却让我死死地守候在厨房里，在</span>10<span style="font-size: 16px; font-family: SimSun;">分钟的时间里不停地看壶嘴是不是冒蒸气，怎么说都不划算。我决定安下心来看电视。当然，在有生之年，我都不希望让厨房成为火海，于是我上了闹钟，</span>10<span style="font-size: 16px; font-family: SimSun;">分钟以后它会发出“尖叫”，提醒我炉子上的水烧开了，那时我再去关煤气也完全来得及。我用一个中断信号——闹铃——换来了</span>10<span style="font-size: 16px; font-family: SimSun;">分钟的欢乐时光，心里不禁由衷地感叹：中断机制真是个好东西。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">正是由于中断机制，我才能有条不紊地“同时”完成多个任务，中断机制实质上帮助我提高了并发“处理”能力。它也能给计算机系统带来同样的好处：如果在键盘按下的时候会得到一个中断信号，</span>CPU<span style="font-size: 16px; font-family: SimSun;">就不必死守着等待键盘输入了；如果硬盘读写完成后发送一个中断信号，</span>CPU<span style="font-size: 16px; font-family: SimSun;">就可以腾出手来集中精力“服务大众”了——无论是人类敲打键盘的指尖还是来回读写介质的磁头，跟</span>CPU<span style="font-size: 16px; font-family: SimSun;">的处理速度相比，都太慢了。没有中断机制，就像我们苦守厨房一样，计算机谈不上有什么并行处理能力。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">跟人相似，</span>CPU<span style="font-size: 16px; font-family: SimSun;">也一样要面对纷繁芜杂的局面——现实中的意外是无处不在的——有可能是用户等得不耐烦，猛敲键盘；有可能是运算中碰到了</span>0<span style="font-size: 16px; font-family: SimSun;">除数；还有可能网卡突然接收到了一个新的数据包。这些都需要</span>CPU<span style="font-size: 16px; font-family: SimSun;">具体情况具体分析，要么马上处理，要么暂缓响应，要么置之不理。无论如何应对，都需要</span>CPU<span style="font-size: 16px; font-family: SimSun;">暂停“手头”的工作，拿出一种对策，只有在响应之后，方能回头完成先前的使命，“把一壶水彻底烧开！”</span></span></p><p><span style="font-size: 16px;"><br clear="all" style="page-break-before: always"  /></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">先让我们感受一下中断机制对并发处理带来的帮助。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">让我们用程序来探讨一下烧水问题，如果没有“中断”（注意，我们这里只是模仿中断的场景，实际上是用异步事件——消息——处理机制来展示中断产生的效果。毕竟，在用户空间没有办法与实际中断产生直接联系，不过操作系统为用户空间提供的异步事件机制，可以看作是模仿中断的产物），设计如下：</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">void StayInKitchen()</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">{</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">bool WaterIsBoiled = false;</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">while ( WaterIsBoiled != true )</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">{</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">       bool VaporGavenOff  = false;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">              if  (VaporGavenOff )</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">                     WaterIsBoiled  = true;</span></p><p style="font-size: 14px;font-family: 0 0 0 56px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">else</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">              WaterIsBoiled  = false;</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">}</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">// <span style="font-size: 16px; font-family: SimSun;">关煤气炉</span></span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">printf(“Close gas oven.\n”);</span></p><p style="font-size: 14px;font-family: 0 0 0 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;">// <span style="font-size: 16px; font-family: SimSun;">一切安定下来，终于可以看电视了，</span>10<span style="font-size: 16px; font-family: SimSun;">分钟的宝贵时间啊，逝者如斯夫</span>…</span></p><p style="font-size: 14px;font-family: 0 0 0 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;">watching_tv();</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">return;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">}</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">可以看出，整个流程如同我们前面描述的一样，所有工作要顺序执行，没有办法完成并发任务。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">如果用“中断”，在开始烧水的时候设定一个</span>10<span style="font-size: 16px; font-family: SimSun;">分钟的“闹铃”，然后让</span>CPU<span style="font-size: 16px; font-family: SimSun;">去看电视（有点难度，具体实现不在我们关心的范围之内，留给读者自行解决吧：</span>&gt;<span style="font-size: 16px; font-family: SimSun;">）。等闹钟响的时候再去厨房关炉子。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">#include &lt;sys/types.h&gt;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">#include &lt;unistd.h&gt;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">#include &lt;sys/stat.h&gt;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">#include &lt;signal.h&gt;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">#include &lt;stdio.h&gt;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">// <span style="font-size: 16px; font-family: SimSun;">闹钟到时会执行此程序</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">void sig_alarm(int signo)</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">{</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">       //<span style="font-size: 16px; font-family: SimSun;">关煤气炉</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">       printf(“Close gas oven.\n”);</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">}</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">void watching_tv()</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">{</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">       while(1)</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">       {</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">              // <span style="font-size: 16px; font-family: SimSun;">呵呵，悠哉悠哉</span></span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">}</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">}</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal"><span style="font-size: 16px;">       int main()</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">{</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;">// <span style="font-size: 16px; font-family: SimSun;">点火后设置定时中断</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">  printf(“Start to boil water, set Alarm”);</span></p><p style="font-size: 14px;font-family: 0 0 0 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">if (signal( SIGALRM, sig_alrm ) == SIG_ERR)</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;">{</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">    perror(&quot;signal(SIGALRM) error&quot;);</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">    return -1;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">  }</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal;text-indent: 14px"><span style="font-size: 16px;">// <span style="font-size: 16px; font-family: SimSun;">然后就可以欣赏电视节目了</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">  printf(“Watching TV!\n”);</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;">watching_tv();</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 42px"><span style="font-size: 16px;">return 0;</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">}</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">这两段程序都在用户空间执行。第二段程序跟中断也没有太大的关系，实际上它只用了信号机制而已。但是，通过这两个程序的对比，我们可以清楚地看到异步事件的处理机制是如何提升并发处理能力的。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><strong><span style="font-size: 16px; color: green;">Alarm</span></strong><strong><span style="font-size: 16px; color: green; font-family: SimSun;">定时器：</span></strong><span style="font-size: 16px; color: green;">alarm</span><span style="font-size: 16px; color: green; font-family: SimSun;">相当于系统中的一个定时器，如果我们调用</span><span style="font-size: 16px; color: green;">alarm(5)</span><span style="font-size: 16px; color: green; font-family: SimSun;">，那么</span><span style="font-size: 16px; color: green;">5</span><span style="font-size: 16px; color: green; font-family: SimSun;">秒钟后就会“响起一个闹铃”（实际上靠信号机制实现的，我们这里不想深入细节，如果你对此很感兴趣，请参考</span><span style="font-size: 16px; color: green;">Richard Stevens</span><span style="font-size: 16px; color: green; font-family: SimSun;">不朽著作《</span><span style="font-size: 16px; color: green;">Unix</span><span style="font-size: 16px; color: green; font-family: SimSun;">环境高级编程》）。在闹铃响起的时候会发生什么呢</span><span style="font-size: 16px; color: green;">?</span><span style="font-size: 16px; color: green; font-family: SimSun;">系统会执行一个函数，至于到底是什么函数，系统允许程序自行决定。程序员编写一个函数，并调用</span><span style="font-size: 16px; color: green;">signal</span><span style="font-size: 16px; color: green; font-family: SimSun;">对该函数进行注册，这样一旦定时到来，系统就会调用程序员提供的函数（</span><span style="font-size: 16px; color: green;">CallBack</span><span style="font-size: 16px; color: green; font-family: SimSun;">函数？没错，不过在这里如何实现并不关键，我们就不引入新的概念和细节了）。上面的例子里我们提供的函数是</span><span style="font-size: 16px; color: green;">sig_alarm</span><span style="font-size: 16px; color: green; font-family: SimSun;">，所做的工作很简单，打印“关闭煤气灶”消息。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">上面的两个例子很简单，但很能说明问题，首先，它证明采用异步的消息处理机制可以提高系统的并发处理能力。更重要的是，它揭示了这种处理机制的模式。用户根据需要设计处理程序，并可以将该程序和特定的外部事件绑定起来，在外部事件发生时系统自动调用处理程序，完成相关工作。这种模式给系统带来了统一的管理方法，也带来无尽的功能扩展空间。</span></p><p><span style="font-size: 16px;"><br clear="all" style="page-break-before: always"  /></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">计算机系统实现中断机制是非常复杂的一件工作，再怎么说人都是高度智能化的生物，而计算机作为一个铁疙瘩，没有程序的教导就一事无成。而处理一个中断过程，它受到的限制和需要学习的东西太多了。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">首先，计算机能够接收的外部信号形式非常有限。中断是由外部的输入引起的，可以说是一种刺激。在烧水的场景中，这些输入是叫声和电视的音乐，我们这里只以声音为例。其实现实世界中能输入人类</span>CPU<span style="font-size: 16px; font-family: SimSun;">——大脑的信号很多，图像、气味一样能被我们接受，人的信息接口很完善。而计算机则不然，接受外部信号的途径越多，设计实现就越复杂，代价就越高。因此个人计算机（</span>PC<span style="font-size: 16px; font-family: SimSun;">）给所有的外部刺激只留了一种输入方式——特定格式的电信号，并对这种信号的格式、接入方法、响应方法、处理步骤都做了规约（具体内容本文后面部分会继续详解），这种信号就是中断或中断信号，而这一整套机制就是中断机制。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">其次，计算机不懂得如何应对信号。人类的大脑可以自行处理外部输入，我从来不用去担心闹钟响时会手足无措——走进厨房关煤气，这简直是天经地义的事情，还用大脑想啊，小腿肚子都知道——可惜计算机不行，没有程序，它就纹丝不动。因此，必须有机制保证外部中断信号到来后，有正确的程序在正确的时候被执行。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">还有，计算机不懂得如何保持工作的持续性。我在看电视的时候如果去厨房关了煤气，回来以后能继续将电视进行到底，不受太大的影响。而计算机则不然，如果放下手头的工作直接去处理“意外”的中断，那么它就再也没有办法想起来曾经作过什么，做到什么程度了。自然也就没有什么“重操旧业”的机会了。这样的处理方式就不是并发执行，而是东一榔头，西一棒槌了。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">那么，通用的计算机系统是如何解决这些问题的呢？它是靠硬件和软件配合来协同实现中断处理的全过程的。我们将通过</span>Intel X86<span style="font-size: 16px; font-family: SimSun;">架构的实现来介绍这一过程。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">CPU<span style="font-size: 16px; font-family: SimSun;">执行完一条指令后，下一条指令的逻辑地址存放在</span>cs<span style="font-size: 16px; font-family: SimSun;">和</span>eip<span style="font-size: 16px; font-family: SimSun;">这对寄存器中。在执行新指令前，控制单元会检查在执行前一条指令的过程中是否有中断或异常发生。如果有，控制单元就会抛下指令，进入下面的流程：</span></span></p><p style="font-size: 14px;font-family: 0 0 0 52px;text-align: justify;white-space: normal"><span style="font-size: 16px;">1.<span style="font-size: 9px;">       </span><span style="font-size: 16px; font-family: SimSun;">确定与中断或异常关联的向量</span>i (0<span style="font-size: 16px; font-family: Symbol;">£</span>i<span style="font-size: 16px; font-family: Symbol;">£</span>255)</span></p><p style="font-size: 14px;font-family: 0 0 0 52px;text-align: justify;white-space: normal"><span style="font-size: 16px;">2.<span style="font-size: 9px;">       </span><span style="font-size: 16px; font-family: SimSun;">寻找向量对应的处理程序</span></span></p><p style="font-size: 14px;font-family: 0 0 0 52px;text-align: justify;white-space: normal"><span style="font-size: 16px;">3.<span style="font-size: 9px;">       </span><span style="font-size: 16px; font-family: SimSun;">保存当前的“工作现场”，执行中断或异常的处理程序</span></span></p><p style="font-size: 14px;font-family: 0 0 0 52px;text-align: justify;white-space: normal"><span style="font-size: 16px;">4.<span style="font-size: 9px;">       </span><span style="font-size: 16px; font-family: SimSun;">处理程序执行完毕后，把控制权交还给控制单元</span></span></p><p style="font-size: 14px;font-family: 0 0 0 52px;text-align: justify;white-space: normal"><span style="font-size: 16px;">5.<span style="font-size: 9px;">       </span><span style="font-size: 16px; font-family: SimSun;">控制单元恢复现场，返回继续执行原程序</span></span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal"><span style="font-family: SimSun; font-size: 16px;">整个流程如下图所示：</span></p><p><span style="font-size: 16px;"><img border="0" width="552" height="241" src="data:image/JPG;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCADxAigDASIAAhEBAxEB/8QAHAABAAMBAQEBAQAAAAAAAAAAAAQFBgcDAgEI/8QASxAAAQQBAgQCBAgLBgUDBQAAAQACAwQRBRIGEyExFCIVFzJBFiNRVaOk0tMHUlNWYWZxgZOV4zZCdZGhsyQzYnSyQ0SUJTRjscH/xAAbAQEAAwEBAQEAAAAAAAAAAAAAAQIDBAYFB//EADQRAQACAQEEBgkFAAMBAAAAAAABAhEDBBIhUQUTFDGR0RUWQVJTYaHB8AYicYHhIzKxQv/aAAwDAQACEQMRAD8A7MiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiDMcZce6VwR4P0nXuTeM38vwzGuxs25zucPxgnBvHulcb+M9GV7kPg9nM8Sxrc792MbXH8Uqm/CnwFqvG/ov0ZYpw+D53M8S9zc79mMbWn8Up+CzgLVeCPSnpOxTm8ZyeX4Z7nY2b853NH4wQdAREQERV9/XdO0ydsNuZ7Xbd7yyF72wsyRvkc0ERt6O8zyB5XdfKcBYIqJvGWiyPayF16cvgjsN5GmWZAY5BljstjPQgH94I7ghTamu6df1F9CrM+aVkDLBc2F/KdG/2HNkxscD1xgnOHfIcBYIoWlatT1mq6zSMxiZK6ImWvJCdzThww9oPQ5B/SCO4K8Nc1yDRaNqZw5tiCjPcZBkt5jYgC7zYIHVzR+/scFBaIqW3xVpWm65Npmp3qdDZWinjks2Wx83e6RpADsezyx1z/AHvd7/jVdc1Cs+g7SqVHUYNQcxld7rzoy9xDnkjEbmlojaX53dQCACcAheos+7iZ9WnUfchpmxdli8OynadNHJC+WGIyCQxtHQztOMdRjB740CAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgzHGXHulcEeD9J17k3jN/L8MxrsbNuc7nD8YJwbx7pXG/jPRle5D4PZzPEsa3O/djG1x/FKpvwp8Barxv6L9GWKcPg+dzPEvc3O/ZjG1p/FKfgs4C1Xgj0p6TsU5vGcnl+Ge52Nm/OdzR+MEHQEREBZyHUqWhaxrLdUsMquu22T1GP9qy3w8MeIwOr3bmOGxuXez08zc6NEGMryzycZ2qWi3NO02WLSKYko2K4mfEA+YhgbHK0N2h7c4yPM3HQjMmqzT+ENV2XbbKmnjS6lOtZtyNa17oXTZaXdAHbXsOOmfNgHa7GqRBUcMwyw6O4zRPiM1u1Oxr2lrtkliSRhIPVpLXNODgjOCAchUf4Q6epSUbVynHD4eLRNQisSyn2A4ROAa0dS4iNwHYDuc4DXbNec0MVmCSCeJksUrSx8b2hzXtIwQQe4I9yDIa5Rgp3rkPj5nV9X2v1gSAvbBACW8zy4EbXMHIJ6HaBJn4l5L8IVR0MFbWYfi3wSwwS2XatPTEUT54w4YYC3a7s5xwQAD12gDUs0zT44LMDKNZsVtz32IxE0Nmc4YcXjHmJHcnuvF/D+iyT1p36RRdLUaxleQ1mF0LWnLQw48oB7AdkGFbpdXwdHU9OvVrFZmoRsmjg1N15sUst2m7DJHAEg8svcHdd0h7grpSi2tM0+9PXnuUa1iWq7fBJLE17onZBy0keU5A6j5ApSAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAsZ+FOhqs/CE2oaNqNylb07M7vDWHRcyIDzg4cB0Hmycny4HtLZog/kz4Z8VfnLq/wD86X7SfDPir85dX/8AnS/aU38IXC/wS4vtafG3FST4+p1/9JxOB3J8pDm5PU7c+9Pwe8L/AAt4vq6fI3NSP4+31/8ASaRkdwfMS1uR1G7PuQdz/BZQ1WDhCHUNZ1G5dt6jidvibDpeXER5AMuI6jzZGD5sH2Vs0RAWM4j1HX5tL4rfSv06lfS4pI2AVZDMf+GZKXCQSgNdmQgHacYB6rZrMcUcHaVqek61PDotOzq1ytJy5pY2ukMvK2M2ud7ONrcYIAPXvkoI2uatxDo0F6Oe9Rmd6Gu3IZK9J0TopIRHt9qR4cPjO2PcqitxfrUXpyR3QxXq8cZl0625vn8NGS2NwaW9HOeIgS4l/ToNz9JqXBekHStSj0fS6NC7b0+emySKIRNxI0e1tHUZa3rgkdcdzmiq8I65HqUtizDCX3L1eeWdmoOlJEb67zzQYmbsch+zb0aZi0NDSS0JMvFVXReEtX1Sne1TVrMbnmP0hUdGTKGluxrdkYLWcpznhvVoa8nqqzVuIdS4f1eLThr1Z3o5ojBsGvvmYWDHNEl1hc72Tv2NOQcYa4g6ObSL7uBNc0xsGbdv0jyY97fNzZZXR9c4GQ9vc9M9cKNd0XXLWuanP4Z81Z87DWLuILVQBghjBAjia5oG8P6nBJJ6YwSEXiDXoW6TobtR1WEyyyizZhpajHRklgdFKGFubAy0PLM4kIJaSMhV9LiTQm65pktXULNKKOd7rT73EkU8To+TIANniX5O8sPs+7utbU0M6lwlpVDX/EvswQQPn223sfz2NHUvY4FxDhnOSMgHuAVFi0SzV4jpuqN1FlaCV0ks82rTTxTRmJzdhje8kP5jmu9kt2tzuydqDToiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiD4lkbDE+VwcWsaXEMaXHA+QDqT+gdVWniPTxK2IsvCR4Lms9HWMkDGTjZ2GR/mFarNx3b9y1od2CvXlsWNMlkkY+V0TBuMBOCGuPf3f6qJaUrE96/r2GWoGzRtka13YSRujd3x1a4Aj94R1iJtqOqX4mkY6RrcHq1paCf83N/wA18y7XUH+Nha5piPOia0ygjHmaBjLh3GMdfkWOs6bX9C6jrFTQNNiIimZypo2Dw3JLwHBoY5r3k7ieoGA0dcZKZwmlIs3Cg+mKRq+JjfLMwP5bhBA+V7HYyWuY0FzSPeCBjseq+dJoR0opCNLo0JHuG5tM5DgOxJ2N69T0x/8AtUV/UpqjbUU+r1tPuG6IWSQxxxNlzFE4veJN2djT+MM4DcgkJM4jKK03rYj8/wDWkqX4bu/lMsN2Yzzq0kXf5N7Rnt7ks6hXqucx5ke9jA9zIYnyuDScA4aCepzj5cO+Q4r9DtwXpbDq+uTahyHGN8bzAQ0nq12Y2jIIHTr7yCMggecXpB2sXa1Mw0msDJszMM5nL3PBc7DgQfiwGgOwG9COwYybnGVjV1OvclMUUdprg3dmapLEMfte0DPXt3UxVGmzatPftR2rVN0NWblOEVV7HPzG14IJkOOr/kPb9PS3SFbRiRERSqIiICIiAipuLdSs6Pw3Z1Co5omgdGW7m5BBkaCCPkIJH71TcN/hF07VWCHVDHp9oYGXO+Kk6ZJDj7PUHoT7xgkrOdSlbbszxdensevqaM61K5rE4lB/DHwv6e4QdqEDc29J3Tt6+1Fj4wdSB2AdnqfJgd0/A5wv6B4QbqE7cW9W2zu6+zFj4sdCR2JdnofPg9l0BFo5BERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERARVPFGqz6Jw7a1GsyN8sOza2QEtOXtb1wR7iqjQ/wi6PquIrZ9HWPkmcDGe/Z/QdgO4HU4GVSdSsW3Zni6qbJr6mlOtSuaxOJw1qIiu5RERAREQEREBERB5WInzwOjjsSV3O7Sxhpc3r7twI/zCqYOG3VvD8rWtQb4WEwQ+WA7WHb0/5fX2G9/kVpdtx0KFi5KHGOvE6Vwb3IaCTj9PRUh4ivsEdWTSZ2ak+WLMGYy3Y4yOOHczBIZE8ZJGTg4AOBE4a0i0xw+y7qV5a8RZLcmtOLs75gwEfo8jWjH7veoMnDlCaGSGZ1p8chkL2C3Ixrg97nuBa1wBGXkdR2wDlQtT4nMGm17MJq1DPYMDhflAdGWyiN5DGnDwPMTh4wBnJUS7xPYrxajIzWNHDqjA6GJ8ZLrPxLH5b8b2cXEDAP71EzHtWpp6k8a/n5lpKlCGlv5T7Dt+M86zJL2+Te447+5RvQxj81bUbleR/WaRhY4zO/GcHNIB93lA6YHZrQPDU9btUr761eg2dscUcjnbpScvLwAGxxvOPiz1OO4Xhpeu6leuGo+jXbIw75MmxEWxlxAOHwgE4HyjJae3unMK7l8byyp6dJVtPsSajYtOewMPNjhGQDkdWMaemTgZx5j0XuypGy/LcBdzJYmROGegDC8jH6fOf9F7opZ5lGpUIqDJGxukeZX73vkeXOccBoyffhrWjPc4ySTkmSiIhxT1e8U/Nn08X2k9XvFPzZ9PF9pdrRcfY9PnL0UfqPa4/+a+E+binq94p+bPp4vtJ6veKfmz6eL7S7Widj0+cp9ZNr92vhPm4p6veKfmz6eL7Ser3in5s+ni+0u1onY9PnJ6ybX7tfCfNwvUODdf0qjJdu0eVBHje/nMdjJAHQOJ7kKkwu+8Q6R6e0OxpnP5HP2/GbN23Dg7tkfJ8qjaHwjo+gBrqlfmTj/wBxOd8nv7Hs3ocdAM+/KytsWbftng79D9S7ujM6tc3zwiOEY+feyXA+j8Y1C13P8DQ/IXGF+fa9mPILfN1PVucg9V0heF25Bp9Ge7ak5detE6WV+CdrWjJOB1PQe5e67tOm5XDy+17TbadWdS0RGeUYERFdyiIiAiIgIiICIiAiIgIiICIiCs4j1yvw3w9d1iyN0dWPcGdRvcThrcgHGXEDOOmcrjWkcKa1rumQ6lplPn1J93Lk5rG7sOLT0cQe4K6xxfwdS40owUtRt3Ia8EvN2VnMbudggElzSegLu2O/XPTHhwHwczgvQ/BNtzTPn2yzsc5ro2zbQHlhDQ7acD2s9AO3XOOro11cbz6Ow9I6uxb3VxE5x3/Jzv1e8U/Nn08X2k9XvFPzZ9PF9pdrRY9j0+cvpesm1+7XwnzcU9XvFPzZ9PF9pPV7xT82fTxfaXa0Tsenzk9ZNr92vhPm4p6veKfmz6eL7Ser3in5s+ni+0u1onY9PnJ6ybX7tfCfNxT1e8U/Nn08X2k9XvFPzZ9PF9pdrROx6fOT1k2v3a+E+binq94p+bPp4vtJ6veKfmz6eL7S7Widj0+cnrJtfu18J83FPV7xT82fTxfaT1e8U/Nn08X2l2tE7Hp85PWTa/dr4T5uKer3in5s+ni+0nq94p+bPp4vtLtaJ2PT5yesm1+7XwnzcU9XvFPzZ9PF9pPV7xT82fTxfaXa0Tsenzk9ZNr92vhPm4p6veKfmz6eL7Ser3in5s+ni+0u1onY9PnJ6ybX7tfCfNxT1e8U/Nn08X2k9XvFPzZ9PF9pdrROx6fOT1k2v3a+E+bheo8G69pVGS7do8qvFje/nMOMkAdA4nuQqRd94h0j09oljTOfyOft+M2bsYcHdsj5PlUbQ+EdH0AB1SvzJx/7iY75Pf2PZvQ46AZ9+VlbYv3ftng79H9S40ZnVrm+eERwjHz72T4I0fjGmWnn+CofkLjC/PtezHkFvm6nq3OQeq6OiLupTcrh5fa9pttOrOpaIjPKMCIiu5RERAREQEREFbxJ/ZjVf+ym/wDAqkqw6WdZuWxJqEDK0FV/OsOnbI0cyUuBMnm5ZwNw9noT0xka1FEw0rfFZhj7VWW1olV3OfHTOqulJikcx0u+4OWQR3YWvc7IOc7CCoty/UbrUUcOr154HQyOfJJxBLEHvyzq4MG1h6uw1vQjPbaAt0iiar11sd8c/qpHV4b969ee6x4QQwtY+vJIx0u0PeXNMZy9pEoAxnJB6dAoeh6DX8FDYq2LcDRcfIC21KRLEx5EYA3bS0sbGMkHLP2gjTopxCnWWiJiJERFLMREQEREBERAREQEREFfxBJSi4c1OTUYXzUmVJXWI2HDnxhh3AdR1Iz7x+1WCr+ILUVHhzU7k9VluKvUlkfXfjbK1rCSw5B6EDHY91YICIiAiIgIiICIiAiIgIiICIiAiIgKv4fqxUeHNMpwWmW4q9SKNlhmNsrWsADxgnoQM9z3Vgq/h+OlFw5pkenTPmpMqRNryPGHPjDBtJ6DqRj3D9iCwREQFW6jxBpWlsn8TeriWBhe6ASt5p6ZADSe5HYfpVksvrUep19P4jc2pXNWwx7+a+yWv2+HY0kNDDnBae5Gce7uotOIaadYtbErga9pDoZ5Y9SqzNrxOmlEMokLWN7nDclG67phE7n3IYo4HAGSSRrWOBax25pz1b8awZ+U/sVNrsWqTVb1m3TrxRRaTcjDobJky5wYQCCxuOjT2z+731MMEjLGphjrkbbGoVsTuhiY7dzK53PAjG13xm5oPfL9zQQc1m0w1po1tGc/mYax+uRNozW207hbHOyBrHQ8p8rnlgBaHlvTLwMnHYqK7iqIQTzDTLzm1onS2AOUDEGvkYc5f16xP7Z6YUGy25Y4bmdPcmtyO1FkLGyObEBsuBgw6NoLSQBk9cdwPcqRvPrmVjnQthBc2xHK58u7E9w4yZGcxvQh2/IIJc7AaSk2laulWazPKfz8w3WpanW0qs2eyXbXysia1g3Oc5xAAa3u4+/AycA4BXnBrdKxcjqMFps0rXOY2WnNGCG4ycuaBgZH+YHvCr9Wi1BlZtqaGu4mqIrjo2tfhpBMmzmvaxjenc7t3l3NwzrX6S2/DLDHQqO06xcrtlkbqFeN4LWbGkB0bmuBHM6NeMdmgMAwpmZyzrSs0yubHEUEFi5H4O49lGEzTy8sMa0AP7byC7Ow4LQR+le9bVXTX2UptOtVJJInysMxiIcGloPsPd187VmnULNziDWpCHMrOrhhjmdYe4xkzNceWH+bJa/a0YGHtc3BBDpHDMjHWZr9qxJ/w7J4988NpjWMbJgnfNI5ozsBI7jsexURMrW06RGY+X1hbfCWi6uyeCDULDH7S0xafOQWkjzA7cEYOenu7ZPRe7taqihbucu0I6kRlkElaSIkAE+XeG5PRZefQpxoGnWHQ6bFK6KrA4T6YJJmlwZF5nOd12l2QMD2QD0zmRqmmW6nCmo0pKGmzU6dcmv8WYtmGPLpGgmTLhkYJLSTvyR0JZk6vT4Yn2tS+3Gy/DSIdzJonytPTGGFgP7/ADj/AFSe3HBLFCQ58sxwyNnU4GNzv0NGRk/pA6kgHHa7osTOdEKlGwyno9h0hFdsZgc8l0ZYACCMteGju3DiXEnream6WbUqIqzxxQ2ZjBLNBgyucxkrg3d2AY5vY5ySQQBkOnKk6cRETE80yPUrb5WMdol6NriAXufBhvXucSE/5Ar0l1SpBLKyWVsccABmme4NjiJxtaXE+0cg4+TGcbm5rZK2oM1mtTGvXjHLXmlcTHXyCx0YGPi+3nP+iq55DpF2/Znq2Kx2Wpakfio3MLgHOdI0Pkd5iMnyxjbzHAhw6pnBFIn8817T4m0e813IvwvkDpAIWSNfI8MJBLWNJLgQ3IwOoIX5LxJRikhY6DUMzPLG/wD0+Yddpd729ejT0GT+7JEPRYdR03VW0bkjnRzxT2GgTskAdzGlx6QsOSZCe5Hfp2WdmZqdZ2lQT0bFmxE5osuj1mw8h/JeSCAPK7GXYj3HAx2eMxNpiGtNGtrTH3j5827qX4bu/lMsN2Yzzq0kXf5N7Rnt7lJWdpXJtF0XUNRuRzT1xKJoWwWXW8xFkYy178Etzud1xjqe3U6JWiXNauBERSqIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiKm4x/sTrv8Ahtj/AG3IMk3iLW9YY2/Dq8lGvPl9eGtBF0iJywvMjXkv2kZwQ35B7z9eO1/85b/8Cr90vhRbeoeFsxV2VJ7MkrHvAh2DAaWgk7nD3uC8ZPSO16upMUtjv5PSRsmz0pG9Cb47Xvzlv/wKv3S/PHa/+ct/+BV+6VLV12aSAS2NLsxsNl0HMaYtrfjTG3I3k/IDgd846JX150+pxVPByAPM7ejdwPLkawODuwHtEg9egx3bu067pHM/u7v4U6rZcf8AVc+P4g/OW9/ArfdJ4/iD85b38Ct90q6hes3xFaFeOGlNFvZvfmVxONuWjoBjPvJ7duoU5Yam3bZp23bX4/01psuz2jMVffj+IPzlvfwK33S0XCWtXdQfcoajIyaxTEb2zMj2cyJ4IaXDON+6N+cADG3AGSBmla8F/wBotX/7Op/52F9DorbdfW19zUtmMOPbtm0tPS3qxiW0REXpnxRERAVLrl64y7S0vT5mV5rTZZZZ3x7+XCwNDtgzjmbpI8ZBbjcSDgA3Szjv7b6j/htP/csqtpxGVLzu1zD59G6r+deqfwan3KejdV/OvVP4NT7lWiy7uLbc7NJnq8O6g6vqEg2OkNfMjDC+Ru0c3ofKD5sdAffhYxa0uaL3laejdV/OvVP4NT7lPRuq/nXqn8Gp9yob+KuXyg7SbjJPHeDmhdsdJH8QZ94DHODxtx0Bz3wCcA+Wm8UWtS03S3QaW593UKpnHMdyYcNEe92TueG7pNrfKScZ9khyZune1Fj6N1X869U/g1PuU9G6r+deqfwan3K+o5dZjlpNnr1ZmSRhtt0MhbyJA0kuaD7bC7DQOhHfzZO2l0/iuTUjRdLqOhaY+y2KQU32ufPI2QBzW4+L5bsEY6Pzu/R1b1zeuuPRuq/nXqn8Gp9yvGnoN7T6MFKrxPqkdetG2KJnKqna1owBkw5PQe9QZuK7MTXTSx6LUgNieGF17VzA6TlSGNxxyiO4z0JxkKXpWvWb+oQQSwUDBZryzQ2aV42Gu5b2NcP+W0d5PcT2KTa8G9qJPo3Vfzr1T+DU+5Xhel1fQaUuqem578NVvNsQ24IcGFvmk2ctjCJNoO3JLc9COuRdqn4t/sdrf+HWP9tyiupaZwV1LZhqV5Wa8VyrLVnZvhmY6ORuSMtIwRkfoXqqKxqlmLxjamo0bRZYgiYMb3wOkl2ObI1rhkDPl7HoQckZPS7axMzwXUsUc0T4pWNkjkaWvY8ZDge4I94UKPQdHhlZLDplWF7HBwMUTWZI6jOO+CAcH3gHuARVnWZIauo2PHWJrVWm+cwS0HwQNwDtOHN3ddp7vOfNjt0WtYuUpLDJtTr/APDf85zNGsPZH5Q7q5ryOxB79MqMwvFL90fddjTqgjbGIvIyZ04aXEjmFxcSRnr5nEjPQHBHYYjQ8P6XA/c2rvOxzDzpHSBwcXE5DickmR/U9cOIzg4VfZ1i7Uo3hakbur22wvtVqz9sUfLZI+Qty8ggOcAeoztyMZXlNxJcLbDhUmgijsVgx/KJe1rjAXxvZg4fiYgAZJw7oC0ExmExTUnhHt/PuuxpdXbAx3OkbXcXMEtiR+TnILtxO4g4I3ZxgYwvVtOBlx9sNcZnt27nPc7aOmQ0E4aDgZxjOATnCqJdXvw36kFirM10jXvEUMY+NJLtke9x2BzWNc543DqG7SRkKtq8R6y2xJctV3TUWxMzDFBCyUOLntxtNguDi4BuCCSWloaCDlmCNO0xnLS2dMrW5HSyc5j3hrXOhsSREhu7Ay1w/Hd/n+gLwg4f0+tkMbYcx27dFLblkjfuzu3Mc4tOcknI7nKjDWbLOIbNOSlY5QhZyWl0I3v+OJIy/J3BgwPdtJIaOq/OH9bm1DS4+fUsG3HShnfnljn7w7Bbh2Bksd0O3uOycJRNbxWePDh7VrYpVrUsMs8LZHwu3Rk+49D+8ZDTg+9rT3AIW6Va/EIrULZWNduAd8vb/IgkEe8Eg5BIVNLqdY5Zc4nioWGvdvjjfC1o7Da0yMJcGkEbh3dv7Y2tS6jG7SXt07iDx0ps143TsfC98TZJWM7Nbt7F2Mg+9TlEUtwXLaVZsU8Rha5lhznTB/m5meh3Z7jGBj3AAdgAvKDS6deKvHHG7FaV0sZfI55D3btxJJJJO93fPdY6vxQZnvlfrN5kD2tMLTY00PwRklwJGDk4246Y79cCxtatZbHo3K1K+K90CR8jdP5k5Do5HjzNYY89GgtDM4Gc4yVXehrOhqVndz+YaVlKtHcfcZC0TyN2uf8AL2/1OGgnuQ1ufZGPAaLprWXmMpxsGo58VsG0y5GDkj9Ge3vJPckqk8bqXP8A/u9U8R6Q5fh/AfE8nn49vlduV1zu/eve9qusx27xqshNWpLsc4wNdsAiY8uc508Yx5z2HTb1U5ZxW2e9ZRaJShldK02nSOidFvkuTPLWuxnaXOO0+UdRg9F7s06lEysyKtHEyq8yQsjbsaxxDmkgDp2e7/NVeg2tZtucLcjeVXPKe6So1jpXAYOHMmc3oe/TGcjuDi9UwrfMTjOUOHSdPry2JYqULX2ZWzTHYPO9uCHH9IIz+3J7klTERSrMzPeIiIgREQEREBERAREQEREBERAREQEREBERAREQEREBU3GP9idd/wANsf7blcqFrOn+ltEv6bzeT4ytJBzNu7ZvaW5xkZxntlCGFUK7pz7VyCxHelrGGORh5TWEu3Fh/vAjHk+T9/y+9Kd1qnFPJEYZHt+Micesb+zmH9LTkH9IK91+eZvo6s474y9d+3UrDO6dpU1mmA7U7Bay/JIWOZGWu2WHO64aD12+49z8nRVTazYddZZlqMi5Niw50slJ5acztIc+TbgeTcWkHDdoJdgkDbL8wu2nSF62tM14T/X2YW2WsxHFm+HNMq1rMbjRijsM02q4kxBrmvPMDj2zk4wff8q0iIuPada2vqb8w30tONOu7ArXgv8AtFq//Z1P/OwqpW3BTHHXdXlDSY/D1Y94HTeHTEtz8oD2kj5HD5QvpdCRPaf6lxdJT/w/22SIi9g88IiICzh/tvqP+G0/9yytGs9db4Pi9k7z5NRpCFrj0DXwuc4Nz7y5szzjuBE49euKXjNWepGaysFjJuHbmmfBqg3iK+4RWOS0iKuAzbVm6tHLJ7DGHF3QnucFbNFzxmHLETDFa9ob6deAzh+tNn1YWJjZpGcMb4V0QLo4mecNLWkYaMnAyPaWZg0iE8MSV7WnRbqOh25HNlomKSKUx18PeHMb59zJQ147iPuSHFdbRXiZaRMsjr1fTdGsada03S6gsaYZJ3NhibFy4TFM1oc8DDGOleO/T23HoxxFZRv6Xp8dOUcR6bYi0psccNN9+IGYsiMLpmnfhjnNPlYTsx1dhzy5nQUTMmZYOtZfFO2xTnsQWKlrUoXZ0azbjcJLRdkOjwMjYOxPc+8KZoD4/hDRrh88krauoTSyS0JqrXOlsQyeVsgzgZI6E+7PdbBFGZVzIqji3+x2t/4dY/23K4VRxYC7hHV42jL5acsUbB3e97C1jWj3uLiAB7yQFWsTvIrE5hp1mdW8QdRktCrMarnQs3CJ7nOdA6SQYDGucGl5YNxbjDX/ACsLtMi6pjLvrbDGzxtj0i9VoR3J32qU0cjJKE8eCGPLRESzDWgnaIycYIwc53yrlO3bN4CnrkEV/wD58MbqW0+QMOC5xIy1o961CKN1frfkyssVy14p3gtRrTTaox8LG8roRXYA6QnezYC3ORuIcG4G4YVdd02AXrZvadLNIbNXa0UJLOYwIOYecWEuADXjHTPmyCSMbtEmuVq601nMfnd5MnDVuwQxWaEM7BFWkYMRtgjDN78ERmJ0glPlcQ1ga4gd8AH8q6Zb09xuMu6pHSkY2JoZDG+ZjGlxYTHyiQ3L3ANAywbcjGRHrUTdV62ePzZt1NzdU1SxDpskstmFtaLxeZGF5dIXZJJ2xYLHEAgf3QNw2r6rUTpOqRadFBbmqWKkVUT8x5LAwTOcS8eyfMwDq32vL7OBokU4R1kz3qjSWei9FkaKkjWRWbBbDFH1DDO/Ba33jacgDqR2B6BRnV563DmjUZoJN0Zr88xsMhi5Leaejc5yYgzp73DGex0CJhG/OcsnWqaxXZDTp29TZDVr4fC5sALcFnLY2R0W1ztm/IBIDgAXDuVnR4ZBoFl8Np9WrE1jIXwu51dvIkJc7Z1DyREOgyHNG3qVrEUbsL9daJzHD/WHr1qkHEUtqPToY6zRE6Lbw7OCMPeSG49l4Bbl+OvTp0V67TKz2XbuqaXHaMll0jYnQtmcxgDI8j5ctjDyB164wSOt2iRXCLas2nKh0ThqlSq6XYkowwXqtdoeY42AmQsDXFzgMuPtDvg5z1IBF8iKylrTacyIiIqIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiIKO5wdoV2y+w+nJDJIS6TwtmWuHuJyXOEbmguOerj1PTr0Xj8BNA/J3/wCaWvvFokVZpWe+FotaPayep8GcNVNKt2Z5NRqxQwPkfOzUrLnRNDSS4AvOSB1xg9uxUr4CaB+SvfzS194rLX5KUXDmpyajC+akypK6xGw4c+MMO4DqOpGfeP2qwUbleRv25s78BNA/JXv5pa+8T4CaB+SvfzS194tEiblORv25s78A9A/JX/5pa+8Vvp2l0dIq+G0+rHXjJ3ODB1e7ABc493OOBlxyT7ypaK0ViO6ETaZ75ERFKBERAUW/ptLVIBBdrsmY129hcPNG/BAe1w6tcMnDgQR7ipSIKT4I6X+W1X+cW/vE+COl/ltV/nFv7xXaKMQjEKT4I6X+W1X+cW/vE+COl/ltV/nFv7xXaJgxCk+COl/ltV/nFv7xPgjpf5bVf5xb+8V2iYMQpPgjpf5bVf5xb+8UXTODq8Wl1I9Rt6lNdZAxtiRmr2w18gaNxHxg6E59w/YtKq/QKsVHhzTKcFpluKvUijZYZjbK1rAA8YJ6EDPc90wYhE+CWl/ltV/nFv7xekHC2kQTxzuhnsvicHxi5bmstjeDkPa2Rzg1w9zgMjJ69SrdEwYgREUpEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERBX8QWoqPDmp3J6rLcVepLJJXfjbK1rCSw5B6EDHY91YLGfhSoarY4Qmv6LqNylb07M58NYdFzIgPODhwHQebJyfKQPaWY/Bzxzo2kcPF3EfE9yzqVmQueyyLE3JYOjWg+ZvXq7Ix7WD7IW2loaurnq6zOOUZRMxHe60iyPrT4K+efqs32E9afBXzz9Vm+wtew7V8K3hPkjerza5FkfWnwV88/VZvsJ60+Cvnn6rN9hOw7V8K3hPkb1ebXIsj60+Cvnn6rN9hPWnwV88/VZvsJ2HavhW8J8jerza5FkfWnwV88/VZvsJ60+Cvnn6rN9hOw7V8K3hPkb1ebXIsj60+Cvnn6rN9hPWnwV88/VZvsJ2HavhW8J8jerza5FkfWnwV88/VZvsJ60+Cvnn6rN9hOw7V8K3hPkb1ebXIsj60+Cvnn6rN9hPWnwV88/VZvsJ2HavhW8J8jerza5FzLjn8InDmp8I3Kukau915zonw7IZY3BzZWOyHFowRtz39yzfDP4X9W0zl1tZZ6TqjDebnbOweUd+z8AE9epJ6uXZpdDbZqaM6la90908J/niib1iXcVX8Px0ouHNMj06Z81JlSJteR4w58YYNpPQdSMe4fsUXh7i7ROJ4Q7TLrHyhu59d/llZ0GctPuBcBkZGfeVK4fkpS8OaZJp0L4aT6kTq8bzlzIywbQep6gY95/avl3palt28YlfOVgiIqAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAuSeoo+7iT6j/UXW0XXsu27RsmeptjPf3fdW1Yt3uSeor9ZPqP9RPUV+sn1H+outou3050h8T6R5K9VTk5J6iv1k+o/1E9RX6yfUf6i62ienOkPifSPI6qnJyT1FfrJ9R/qJ6iv1k+o/wBRdbRPTnSHxPpHkdVTk5J6iv1k+o/1E9RX6yfUf6i62ienOkPifSPI6qnJyT1FfrJ9R/qJ6iv1k+o/1F1tE9OdIfE+keR1VOTknqK/WT6j/UT1FfrJ9R/qLraJ6c6Q+J9I8jqqcnJPUV+sn1H+onqK/WT6j/UXW0T050h8T6R5HVU5OG8U/gnPDPDlrWDrnifD7PivCbN257W995x7We3uWV4e4T1viebZpdJz4g7a+w/yxM6jOXH3gOBwMnHYFf0nqGn1NUpup3oGWK7nNc6J/Vri1wcMj3jIHTsex6L2hhirwsggjZFFG0MZGxoa1rQMAADsAF16X6i2qmjNbfutnvn2R/EInSrMsBwn+CXTtFmgv6pYfevQubIxrCWRRPBa4EY6uIcD1OAQfZW+hhirQRwQRMiiiaGMjY0NaxoGAAB2AHuXoi+Hr7Rq7Rff1bZlpERHCBERYJEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQeNq1DSrPsWH7I2YycEkknAAA6kkkAAdSSAOpVLa4tZRZN4vRtShlhqyW3RObESYmFgcQ4PLCfPnbuzhp6dW7p+u1Z7mmBldnMkisQThmQC8RyskLRnpkhpAyQMkZIHVVWvam/U+F9YZU0+66J1GWJrn1ZWSPlc3a1jYi3eR16uwAMjv5tt6xE4yJNnigUa1ma7o+oV3wV32RC4wufLGwt5jm7ZCPLuaSCQTnplS7OrmrJpscmnWy/UZOWA0xfEO2l5D/P7mtcfLu9k4zkZrrOgSajotx41G3ctW9Olr1n32Ni5IlaMgtZG0jJDM7gSNvTHUH2fO/WdT0ww07UHgLDp7PiYXRhmYpIwxpPR7sv7sLm4aTu6t3TiostT1Bml0jafDLP8ZHG2OLbuc572saBuIHdw7kKni4k1J+tWqZ4cvlkNeGUMD6/MBc6QEk87btOwYx1yHZ9ytNZ012rad4Rlp9V3OhlEzGhzmmORr+gPTPlx1BHXseyoq2k3TxdqMY4j1IObQquMnLrbnAyWMA/FYwMHGBnzHJPTE0iu7Oe/+/kF3jdscdeWtQnMNiGjYbKYjJhliUtLHMZkh2xriCMgu6d9odYt1fU79x9bTdOZEKs8TLkl2UDYHNZI5rGs3bnBj8ZJaA4jBcMrG8QaAa1mpp0lF9uKvQ06AXWaY+w8CKZ4k2AMc1p2ncdxOQA3a7dkSKWkafqF/T7N7SaEjrGqNidipiMtZpxDo2h7chjZGOG0jyuZggEFbTp6e7n+ft/qOLUcQWNc07T9Q1Knc08QVa75mQTUnucdrMkF4lA6kHrt6Z96l1261X5st2zVusbGSyCpTMMjne4Bz5i35Rg46kdQsrxNr2jsm4qhdqtISu0VsDYzYZudIDZBYBnq4Fw6d+o+VXmmX9AD5KmjcQ17Fyy08pk2pOuHcASCGOkJwOpIaRkDv06ZTWYr3fT+EvGbiq9Fqb4ncP3Y69WqZ7XMlrNcwOd8W7dztu3DJs+8Yb7l7atxJZ0/h/UNQk0i7UlrwudAJ42zNe/a4jIhe7a0FoyXFo691nbzK8/CWo1J/TFvUXuvtZJXhsEWH82SNnMMLRG44ja3a7oAAMBqna2+nJwbqlPTp9ahdJG9rRZgsOdM98bg2LdYaThxAGGkeYtAILhm+7XMcPb+fmELG7xhUpahVEzLUdKSlPZle/T7AezY9jQSNuWjBeTkdPKegI3Wl29LFairxNbG0uYZrE4Ija1ztoY05G6Rx8oAPTOT/da/L61o7bcGpy6SLAho6TbptZE4yC3NICXtwckua5oLnN8z3uwXZY4KXblo8Q3dC1COR9mnNenqiF5a6F4bDZY92BkODtvQkny4xjc7NJrXETHz/wAFvDX4hbMwz6ppr4g4b2s06RrnNz1AJnOD+nB/YVEscSTwa5LW9GWHUK80VWS03lkc+Ux7eheHBoEjc4acl3u2+aA/h3h2bjCvVi0GgY4KU5sR+BaGBznQmNxy3ByOYGn/AKZAOocBWazFp9jWNWgsx3ZJZNboMLNs5quYRVBDwPiiSCRh3Xt/0q1a1meP/nz/AJF5pXFk1yoH29OdTdPVnvVZbEkccD4GuGwuc173MOySPcS3od2O2FWQcZ27FOKwda0CDnag+s8gGVlVgE5aXO5rd2/lN2uwzOexyMTo2FmtR1tHtOtWaNC8zN575DDK+WJ0bZSfNtO07c9XMbkE91mbjqmi8H3Ima/L6QikumKOzrT4JTtmmbzWtb1keSxvlPlJBIwS7dpStLezjMx9/wDCctRT4mtP0m/ZZJp+qvr6hDTglquMMMvM5IBJzJjDpSDjPs9lEn401aCRkkukRRQewQ+K+C57nNDMO8LgdSRjBJLhgjGD90p4NT0uKjRsV7Up1KvI81tVk1BsLWPbLufI8bmAiFzQMY3EfKcH8PaXPxlDDGdScYakjrD3X7W5jwWCE7y/ONslgAg4Pxg7h2KV6vM78HFq6jrT6zHXYYYZzneyGUyMHXphxa0npj3D/wDq9lR14dV0qzpGnQSeNrO57r08/MdI0Y3N2uJOBucGgOLnbcd9rnC8WFowkREVQREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBFn+NGST6GKbJLscduZsFh1SuZjyXA8wOAY8gFm4Age0WdQMrH3uJvEHh2abUdUrv5fjC6WWhFlro3tLm80M67pdgy0Nc1ri0HG5baejN4zCJnDqCLC64KuoxaNfu8NS6jWPL5lp7akksuXbIo8h4G1z3NeS07cYBGHO2x5J5azKGnDRmaK02o3WK8cEcbJpG26QbK3YSMFshGA44OWknaCkaWYjiZdCRYuPU7h421YVdQqWmR02CXw1F83I2GwWtftl9triMtA3P3YDW4Lh+cF6tZdw4yCXUdPMFXRq08NkRENhyJGuEvxmHbDF1ILf73b3ROlMRnPL6mW1RY6u3TtTqCV/CM+sx86XbZsRV3SveHct7ntlcwscTHjaBgNaweXGxr0nWrcIm9pOnO4cpzzVZBYMdeNpjlkja6TALgCGHqXgY6fJ0dXOce1LYouf19R0v4T33/D/a0064E/Ppech8+WZ5ePLkHoM+frnpiv1fWdXloUrpnlkadP0m1YLxFyGvM7nF5Dns2uLmt6tO3AIdjyubeNnmbYzy+qMuoIsM+9NLrDoNToa1qPKuQx1I2TwRtZK2vHOQ8NkYHvyHOOdzBgBuOxo+LTV9Oa23k0PFcyf43mDxWz0W7y7dueXnrndjd0x71NNnm04z7Mkzh1VFi9Au6PV1DVrGnV6un767jHB4aWrC5td7w6R73RNDTmUNcAHbdvc9hBlp3bF6xNRl1KzPbbzpeZzqRMjdjHcuHnwlzQ3YPMOgOTK4jYadXiZieH9GXQkWA4jv6f6vdRq1Z9QsDTo+VPLfltQS73sIG4lmZCS9p2HDcOGdowok0mms1CKZ3DOlWGTV2Voq3hLDo4pGvme5sZFUguIdlzcAtcxwIy0q0aFprnE+H8eZl0pFhrFSevp3D2nuuWofD6O4u8Oy15nsNZgJiicyR3RzuhxjOSOhVRp00EGp2ZbljVI6MO996VtXVInl4ADckTPA8ga8l4GGlg952RXSzGc/Qy6giIsEiIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiCNeoVtRhEFpr3xB24sEjmtf0I2uAI3NIPVrsg+8FZw8MalW4U0/S6ViuDXggis0nANrWNrmul8wZvBfhwJIIIcQW5ORrEVovMcBnOK9Dta94evFpukzMikjeLV0l74cSNc9oj2eYOa0Aje3OcHC+JuH77adGnDW0cthtRyGWCF1XkRNmjlc1jPPuLiwk+Zozt74WmRTGpbERyFDPpGqT3dQm8VDD46OOrzYS5skUDTK7e3/APJ8btHXA27+ueWvT0Raq8QV7enOghomGOCxCBt2xxNm2NYACMF0rT3bgR+/OBdIo3pFVSo39P0ieGB1d1o2rE7A8u2Oa+d8gaSOoJa7GcHaeuHYwfbTdKjo6HR0uYsstpwxRhzmDDnRgYdjrg5aCPkKnoomZkQIaUsev275czlT1YIWgE7g5j5Sc/oxI3H71Tatwc67qcNyjZq1GQR1mRQvqOkbEYJHPaWhsjQPa29shuQCNxWoRWre1ZzAzOmcMWNPdSO+u1te+J3Mj3BrY21DWaG7snJw12CemSMuxl0bXOGNU1OK2yF1Rni7FiZxfK74vNR1aMDy9c5DndtvUDd3OvRTGpaJyYUOkaTqGm6g+y8VJG3sutBp2mB2+R4DCG+cfGBvXZ1a5+N0jlFfwnWsSz6pb0DRZ9QkyGVy0ckZcC5zpOWS95xncW9OjQBlznahFG/bORn7nDIm4Mj0Rr2S2KtB1evM/LG8zkOh3EDPQhx6dcZ+UBQ9c0XWtW1WtZFOu2OpM4t2a3ZhMjNkjR5WRgMd5wS4ZOAW5IK1iKY1LROfziKrTtNsNtQ3buxssNXw0UDJnzCIbsvdzXAOeXBsWdwyCw9TkktM0qWJtx+p+HsS27TbDmsYdjXMZGxpAdnBzEH/APSTjJ27jaoqZkERFAIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiD//Z " src="SeWfibBcBT0FMu48NvOWmicLRU3TKvVzhiaA1ECyyNibUxeOqAR0QKXtJQEJI8O0ZT70yQ6XaurtH4Wvfr8ZcF5ZGQ"  data-type="gif" data-ratio="0.43529411764705883" data-w=""  /></span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: justify;white-space: normal"><span style="font-size: 16px;">　</span></p><p style="font-size: 14px;font-family: 0 0 0 28px;text-align: center;white-space: normal"><span style="font-family: SimSun; font-size: 16px;">图一：中断处理过程</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">让我们深入这个流程，看看都有什么问题需要面对。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">1<span style="font-size: 16px; font-family: SimSun;">、异常是什么概念？</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">在处理器执行到由于编程失误而导致的错误指令（例如除数是</span>0<span style="font-size: 16px; font-family: SimSun;">）的时候，或者在执行期间出现特殊情况（例如缺页），需要靠操作系统来处理的时候，处理器就会产生一个异常。对大部分处理器体系结构来说，处理异常和处理中断的方式基本是相同的，</span>x86<span style="font-size: 16px; font-family: SimSun;">架构的</span>CPU<span style="font-size: 16px; font-family: SimSun;">也是如此。异常与中断还是有些区别，异常的产生必须考虑与处理器时钟的同步。实际上，异常往往被称为同步中断。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">2<span style="font-size: 16px; font-family: SimSun;">、中断向量是什么？</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">中断向量代表的是中断源——从某种程度上讲，可以看作是中断或异常的类型。中断和异常的种类很多，比如说被</span>0<span style="font-size: 16px; font-family: SimSun;">除是一种异常，缺页又是一种异常，网卡会产生中断，声卡也会产生中断，</span>CPU<span style="font-size: 16px; font-family: SimSun;">如何区分它们呢？中断向量的概念就是由此引出的，其实它就是一个被送通往</span>CPU<span style="font-size: 16px; font-family: SimSun;">数据线的一个整数。</span>CPU<span style="font-size: 16px; font-family: SimSun;">给每个</span>IRQ<span style="font-size: 16px; font-family: SimSun;">分配了一个类型号，通过这个整数</span>CPU<span style="font-size: 16px; font-family: SimSun;">来识别不同类型的中断。这里可能很多朋友会寻问为什么还要弄个中断向量这么麻烦的东东？为什么不直接用</span>IRQ0~IRQ15<span style="font-size: 16px; font-family: SimSun;">就完了？比如就让</span>IRQ0<span style="font-size: 16px; font-family: SimSun;">为</span>0<span style="font-size: 16px; font-family: SimSun;">，</span>IRQ1<span style="font-size: 16px; font-family: SimSun;">为</span>1<span style="font-size: 16px; font-family: SimSun;">……，这不是要简单得多么？其实这里体现了模块化设计规则，及节约规则。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">首先我们先谈谈节约规则，所谓节约规则就是所使用的信号线数越少越好，这样如果每个</span>IRQ<span style="font-size: 16px; font-family: SimSun;">都独立使用一根数据线，如</span>IRQ0<span style="font-size: 16px; font-family: SimSun;">用</span>0<span style="font-size: 16px; font-family: SimSun;">号线，</span>IRQ1<span style="font-size: 16px; font-family: SimSun;">用</span>1<span style="font-size: 16px; font-family: SimSun;">号线……这样，</span>16<span style="font-size: 16px; font-family: SimSun;">个</span>IRQ<span style="font-size: 16px; font-family: SimSun;">就会用</span>16<span style="font-size: 16px; font-family: SimSun;">根线，这显然是一种浪费。那么也许马上就有朋友会说：那么只用</span>4<span style="font-size: 16px; font-family: SimSun;">根线不就行了吗？（</span>2^4=16<span style="font-size: 16px; font-family: SimSun;">）。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">这个问题，体现了模块设计规则。我们在前面就说过中断有很多类，可能是外部硬件触发，也可能是由软件触发，然而对于</span>CPU<span style="font-size: 16px; font-family: SimSun;">来说中断就是中断，只有一种，</span>CPU<span style="font-size: 16px; font-family: SimSun;">不用管它到底是由外部硬件触发的还是由运行的软件本身触发的，因为对于</span>CPU<span style="font-size: 16px; font-family: SimSun;">来说，中断处理的过程都是一样的：<span style="font-size: 16px; color: blue;">中断现行程序，转到中断服务程序处执行，回到被中断的程序继续执行。</span></span>CPU<span style="font-size: 16px; font-family: SimSun;">总共可以处理</span>256<span style="font-size: 16px; font-family: SimSun;">种中断，而并不知道，也不应当让</span>CPU<span style="font-size: 16px; font-family: SimSun;">知道这是硬件来的中断还是软件来的中断，这样，就可以使</span>CPU<span style="font-size: 16px; font-family: SimSun;">的设计独立于中断控制器的设计，这样</span>CPU<span style="font-size: 16px; font-family: SimSun;">所需完成的工作就很单纯了。</span>CPU<span style="font-size: 16px; font-family: SimSun;">对于其它的模块只提供了一种接口，这就是</span>256<span style="font-size: 16px; font-family: SimSun;">个中断处理向量，也称为中断号。由这些中断控制器自行去使用这</span>256<span style="font-size: 16px; font-family: SimSun;">个中断号中的一个与</span>CPU<span style="font-size: 16px; font-family: SimSun;">进行交互，比如，硬件中断可以使用前</span>128<span style="font-size: 16px; font-family: SimSun;">个号，软件中断使用后</span>128<span style="font-size: 16px; font-family: SimSun;">个号，也可以软件中断使用前</span>128<span style="font-size: 16px; font-family: SimSun;">个号，硬件中断使用后</span>128<span style="font-size: 16px; font-family: SimSun;">个号，这与</span>CPU<span style="font-size: 16px; font-family: SimSun;">完全无关了，当你需要处理的时候，只需告诉</span>CPU<span style="font-size: 16px; font-family: SimSun;">你用的是哪个中断号就行，而不需告诉</span>CPU<span style="font-size: 16px; font-family: SimSun;">你是来自哪儿的中断。这样也方便了以后的扩充，比如现在机器里又加了一片</span>8259<span style="font-size: 16px; font-family: SimSun;">芯片，那么这个芯片就可以使用空闲的中断号，看哪一个空闲就使用哪一个，而不是必须要使用第</span>0<span style="font-size: 16px; font-family: SimSun;">号，或第</span>1<span style="font-size: 16px; font-family: SimSun;">号中断号了。其实这相当于一种映射机制，把</span>IRQ<span style="font-size: 16px; font-family: SimSun;">信号映射到不同的中断号上，</span>IRQ<span style="font-size: 16px; font-family: SimSun;">的排列或说编号是固定的，但通过改变映射机制，就可以让</span>IRQ<span style="font-size: 16px; font-family: SimSun;">映射到不同的中断号，也可以说调用不同的中断服务程序。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">3<span style="font-size: 16px; font-family: SimSun;">、什么是中断服务程序？</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">在响应一个特定中断的时候，内核会执行一个函数，该函数叫做中断处理程序（</span>interrupt handler<span style="font-size: 16px; font-family: SimSun;">）或中断服务程序（</span>interrupt service routine(ISR)<span style="font-size: 16px; font-family: SimSun;">）。产生中断的每个设备都有相应的中断处理程序。例如，由一个函数专门处理来自系统时钟的中断，而另外一个函数专门处理由键盘产生的中断。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">一般来说，中断服务程序要负责与硬件进行交互，告诉该设备中断已被接收。此外，还需要完成其他相关工作。比如说网络设备的中断服务程序除了要对硬件应答，还要把来自硬件的网络数据包拷贝到内存，对其进行处理后再交给合适的协议栈或应用程序。每个中断服务程序根据其要完成的任务，复杂程度各不相同。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">一般来说，一个设备的中断服务程序是它的设备驱动程序（</span>device driver<span style="font-size: 16px; font-family: SimSun;">）的一部分——设备驱动程序是用于对设备进行管理的内核代码。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">4<span style="font-size: 16px; font-family: SimSun;">、隔离变化</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">不知道您有没有意识到，中断处理前面这部分的设计是何等的简单优美。人是高度智能化的，能够对遇到的各种意外情况做有针对性的处理，计算机相比就差距甚远了，它只能根据预定的程序进行操作。对于计算机来说，硬件支持的，只能是中断这种电信号传播的方式和</span>CPU<span style="font-size: 16px; font-family: SimSun;">对这种信号的接收方法，而具体如何处理这个中断，必须得靠操作系统实现。操作系统支持所有事先能够预料到的中断信号，理论上都不存在太大的挑战，但在操作系统安装到计算机设备上以后，肯定会时常有新的外围设备被加入系统，这可能会带来安装系统时根本无法预料的“意外”中断。如何支持这种扩展，是整个系统必须面对的。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">而硬件和软件在这里的协作，给我们带来了完美的答案。当新的设备引入新类型的中断时，</span>CPU<span style="font-size: 16px; font-family: SimSun;">和操作系统不用关注如何处理它。</span>CPU<span style="font-size: 16px; font-family: SimSun;">只负责接收中断信号，并引用中断服务程序；而操作系统提供默认的中断服务——一般来说就是不理会这个信号，返回就可以了——并负责提供接口，让用户通过该接口注册根据设备具体功能而编制的中断服务程序。如果用户注册了对应于一个中断的服务程序，那么</span>CPU<span style="font-size: 16px; font-family: SimSun;">就会在该中断到来时调用用户注册的服务程序。这样，在中断来临时系统需要如何操作硬件、如何实现硬件功能这部分工作就完全独立于</span>CPU<span style="font-size: 16px; font-family: SimSun;">架构和操作系统的设计了。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">而当你需要加入新设备的时候，只需要告诉操作系统该设备占用的中断号、按照操作系统要求的接口格式撰写中断服务程序，用操作系统提供的函数注册该服务程序，设备的中断就被系统支持了。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">中断和对中断的处理被解除了耦合。这样，无论是你在需要加入新的中断时，还是在你需要改变现有中断的服务程序时、又或是取消对某个中断支持的时候，</span>CPU<span style="font-size: 16px; font-family: SimSun;">架构和操作系统都无需作改变。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">5<span style="font-size: 16px; font-family: SimSun;">、保存当前工作“现场”</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">在中断处理完毕后，计算机一般来说还要回头处理原先手头正做的工作。这给中断的概念带来些额外的“内涵”。<span style="font-family: SimSun; font-size: 16px; color: red;">注一</span>“回头”不是指从头再来重新做，而是要接着刚才的进度继续做。这就需要在处理中断信号之前保留工作“现场”。“现场”这个词比较晦涩，其实就是指一个信息集，它能反映某个时间点上任务的状态，并能保证按照这些信息就能恢复任务到该状态，继续执行下去。再直白一点，现场不过就是一组寄存器值。而如何保护现场和恢复场景是中断机制需要考虑的重点之一。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">每个中断处理都要经历这个保存和恢复过程，我们可以抽象出其中的步骤：</span></p><p style="font-size: 14px;font-family: 0 0 0 56px;text-align: justify;white-space: normal"><span style="font-size: 16px;">1.<span style="font-size: 9px;">         </span><span style="font-size: 16px; font-family: SimSun;">保存现场</span></span></p><p style="font-size: 14px;font-family: 0 0 0 56px;text-align: justify;white-space: normal"><span style="font-size: 16px;">2.<span style="font-size: 9px;">         </span><span style="font-size: 16px; font-family: SimSun;">执行具体的中断服务程序</span></span></p><p style="font-size: 14px;font-family: 0 0 0 56px;text-align: justify;white-space: normal"><span style="font-size: 16px;">3.<span style="font-size: 9px;">         </span><span style="font-size: 16px; font-family: SimSun;">从中断服务返回</span></span></p><p style="font-size: 14px;font-family: 0 0 0 56px;text-align: justify;white-space: normal"><span style="font-size: 16px;">4.<span style="font-size: 9px;">         </span><span style="font-size: 16px; font-family: SimSun;">恢复现场</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-family: SimSun; font-size: 16px;">上面说过了，“现场”看似在不断变化，没有哪个瞬间相同。但实际上组成现场的要素却不会有任何改变。也就是说，只要我们保存了相关的寄存器状态，现场就能保存下来。而恢复“现场”就是重新载入这些寄存器。换句话说，对于任何一个中断，保护现场和恢复现场所做的都是完全相同的操作。</span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">既然操作相同，实现操作的过程和代码就相同。减少代码的冗余是模块化设计的基本准则，实在没有道理让所有的中断服务程序都重复实现这样的功能，应该将它作为一种基本的结构由底层的操作系统或硬件完成。而对中断的处理过程需要迅速完成，因此，</span>Intel CPU<span style="font-size: 16px; font-family: SimSun;">的控制器就承担了这个任务，非但如此，上面的所有步骤次序都被固化下来，由控制器驱动完成。保存现场和恢复现场都由硬件自动完成，大大减轻了操作系统和设备驱动程序的负担。</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"> </span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;">6<span style="font-size: 16px; font-family: SimSun;">、硬件对中断支持的细节</span></span></p><p style="font-size: 14px;text-align: justify;white-space: normal;text-indent: 28px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: SimSun;">下面的部分，本来应该介绍</span>8259<span style="font-size: 16px; font-family: SimSun;">、中断控制器编程、中断描述符表等内容，可是我看到了潇寒写的<span style="font-size: 16px; color: blue;">“保护模式下的</span></span><span style="font-size: 16px; color: blue;">8259A</span><span style="font-size: 16px; color: blue; font-family: SimSun;">芯片编程及中断处理探究”</span><span style="font-size: 16px; font-family: SimSun;">（见参考资料</span>1<span style="font-size: 16px; font-family: SimSun;">），前人之述备矣，读者直接读它好了。</span> </span></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name"></div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p class="reward_button_wrp">
                    
                      <span class="reward_pop_panel">
                        <img src="https://res.wx.qq.com/mpres/zh_CN/htmledition/pages/home/index/pic_mp_app4290ba.png" alt="">
                        <strong>扫一扫下载订阅号助手，用手机发文章</strong>
                      </span>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='https://www.52pojie.cn/' target='_blank'>
			吾爱破解论坛
		</a>
	</div>
</body>