<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		《Linux内核设计与实现》读书笔记（二）- 内核开发的准备
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=412781400&amp;idx=2&amp;sn=ac1efee6e739d7fcd49aa7bbbef90030&amp;chksm=7605a6bd41722fab8d2dc4ef87e300d5c5a48bbd53d0e1034c7f016f159d833ab484fc2d13e2&amp;scene=27#wechat_redirect&cpage=83' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">《Linux内核设计与实现》读书笔记（二）- 内核开发的准备</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2015-12-22</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">在尝试内核开发之前，需要对内核有个整体的了解。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);"><strong><span style="color: rgb(0, 0, 255);">主要内容：</span></strong></p><ul style="margin-left: 30px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>获取内核源码</p></li><li><p>内核源码的结构</p></li><li><p>编译内核的方法</p></li><li><p>内核开发的特点</p></li></ul><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);"><br  /></p><h3 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 20px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 18px; line-height: 18px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(43, 102, 149);"><strong>1. 获取内核源码</strong></h3><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">内核是开源的，所有获取源码特别方便，参照以下的网址，可以通过git或者直接下载压缩好的源码包。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">http://www.kernel.org</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);"><br  /></p><h3 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 20px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 18px; line-height: 18px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(43, 102, 149);"><strong>2. 内核源码的结构</strong></h3><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);"><br  /></p><table cellspacing="0" cellpadding="2" align="center"><tbody><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;"><strong>目录</strong></td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;"><strong>说明</strong></td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">arch</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">特定体系结构的代码</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">block</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">块设备I/O层</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">crypo</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">加密API</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">Documentation</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">内核源码文档</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">drivers</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">设备驱动程序</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">firmware</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">使用某些驱动程序而需要的设备固件</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">fs</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">VFS和各种文件系统</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">include</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">内核头文件</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">init</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">内核引导和初始化</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">ipc</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">进程间通信代码</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">kernel</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">像调度程序这样的核心子系统</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">lib</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">同样内核函数</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">mm</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">内存管理子系统和VM</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">net</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">网络子系统</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">samples</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">示例，示范代码</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">scripts</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">编译内核所用的脚本</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">security</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">Linux 安全模块</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">sound</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">语音子系统</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">usr</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">早期用户空间代码（所谓的initramfs）</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">tools</td><td valign="top" width="269" style="padding: 3px; border-color: silver; border-collapse: collapse;">在Linux开发中有用的工具</td></tr><tr><td valign="top" width="106" style="padding: 3px; border-color: silver; border-collapse: collapse;">virt</td><td valign="top" width="255" style="padding: 3px; border-color: silver; border-collapse: collapse;">虚拟化基础结构</td></tr></tbody></table><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);"><br  /></p><h3 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 20px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 18px; line-height: 18px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(43, 102, 149);"><strong>3. 编译内核的方法</strong></h3><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">还未实际尝试过手动编译内核，只是用yum更新过内核。这部分等以后手动编译过再补上。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">安装新的内核后，重启时会提示进入哪个内核。当多次安装新的内核后，启动列表会很长（因为有很多版本的内核），显得不是很方便。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">下面介绍3种删除那些不用的内核的方法：(是如何安装的就选择相应的删除方法)</p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">3.1 rpm 删除法</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">rpm -qa | grep kernel*  (查找所有linux内核版本)<br  />   rpm -e kernel-(想要删除的版本)</p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">3.2 yum 删除法</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">yum remove kernel-(要删除的版本)</p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">3.3 手动删除</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">删除/lib/modules/目录下不需要的内核库文件<br  />   删除/usr/src/kernel/目录下不需要的内核源码<br  />   删除/boot目录下启动的核心档案禾内核映像<br  />   更改grub的配置，删除不需要的内核启动列表</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);"><br  /></p><h3 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 20px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 18px; line-height: 18px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(43, 102, 149);"><strong>4. 内核开发的特点</strong></h3><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">4.1  无标准C库</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">为了保证内核的小和高效，内核开发中不能使用C标准库，所以连最常用的printf函数也没有，但是还好有个printk函数来代替。</p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">4.2 使用GNU C，推荐用gcc 4.4或以后的版本来编译内核</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">因为使用GNU C，所有内核中常使用GNU C中的一些扩展：</p><h5 style="margin: 15px auto 2px; font-size: 12px; font-weight: bold; font-family: Verdana, Arial, Helvetica, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">4.2.1 内联函数</h5><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">内联函数在编译时会在它被调用的地方展开，减少了函数调用的开销，性能较好。但是，频繁的使用内联函数也会使代码变长，从而在运行时占用更多的内存。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">所以内联函数使用时最好要满足以下几点：函数较小，会被反复调用，对程序的时间要求比较严格。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">内联函数示例：static <span style="color: rgb(255, 0, 0);"><strong>inline</strong></span> void sample();</p><h5 style="margin: 15px auto 2px; font-size: 12px; font-weight: bold; font-family: Verdana, Arial, Helvetica, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">4.2.2 内联汇编</h5><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">内联汇编用于偏近底层或对执行时间严格要求的地方。示例如下：</p><pre style="">unsigned <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">int</span><span style="line-height: 1.5 !important;"> low, high;
asm </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">volatile</span>(<span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">rdtsc</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span> : <span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">=a</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span> (low), <span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">=d</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span><span style="line-height: 1.5 !important;"> (high));</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">/*</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;"> low 和 high 分别包含64位时间戳的低32位和高32位 </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">*/</span></pre><h5 style="margin: 15px auto 2px; font-size: 12px; font-weight: bold; font-family: Verdana, Arial, Helvetica, sans-serif; white-space: normal; background-color: rgb(255, 255, 255);">4.2.3 分支声明</h5><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">如果能事先判断一个if语句时经常为真还是经常为假，那么可以用unlikely和likely来优化这段判断的代码。</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><img src="data:image/JPG;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAUABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAQFAgYH/8QAJhAAAgEEAQMEAwEAAAAAAAAAAQIDAAQFEUESEyEGIjEyUWFx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAIBEf/aAAwDAQACEQMRAD8A6zc37W4nYpF0Q8tL0lvaD4Gv3WVpkre7iRuoRSN47TkBgfxrn+j5qqyqZIXMy2uPuJkkfr7kUiAfVRrzKh3tTxVRlrtbzHQWvdcBo4nDLsFPYNEHtkc7+3zyKtEZSdXzW70qBgp5br0/jriZy8strE7sfksUBJpUVE+q1vTuDY7bDY8k8m1T/KUp0T4oo4IkiijWOONQqIg0FA8AAcClKUH/2Q== " src="SeWfibBcBT0E1IicVyYNuhxcPibn3LKsaY2yibDfBAlK69sbEAF9dZeTRo0tLeJblwAKkvIkibRhu6MytdhO6ILBArw"  style="border: none !important;" data-type="gif" data-ratio="1" data-w="20"  /></span></p><pre style=""><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">/*</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;"> 如果error在绝大多数情况下为0(假) </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">*/</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">if</span><span style="line-height: 1.5 !important;"> (unlikely(error)) {    </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">/*</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;"> ... </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">*/</span><span style="line-height: 1.5 !important;">}</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">/*</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;"> 如果success在绝大多数情况下不为0(真) </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">*/</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">if</span><span style="line-height: 1.5 !important;"> (likely(success)) {    </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">/*</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;"> ... </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">*/</span><span style="line-height: 1.5 !important;">}</span></pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><img src="data:image/JPG;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAUABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAQFAgYH/8QAJhAAAgEEAQMEAwEAAAAAAAAAAQIDAAQFEUESEyEGIjEyUWFx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAIBEf/aAAwDAQACEQMRAD8A6zc37W4nYpF0Q8tL0lvaD4Gv3WVpkre7iRuoRSN47TkBgfxrn+j5qqyqZIXMy2uPuJkkfr7kUiAfVRrzKh3tTxVRlrtbzHQWvdcBo4nDLsFPYNEHtkc7+3zyKtEZSdXzW70qBgp5br0/jriZy8strE7sfksUBJpUVE+q1vTuDY7bDY8k8m1T/KUp0T4oo4IkiijWOONQqIg0FA8AAcClKUH/2Q== " src="SeWfibBcBT0E1IicVyYNuhxcPibn3LKsaY2yibDfBAlK69sbEAF9dZeTRo0tLeJblwAKkvIkibRhu6MytdhO6ILBArw"  style="border: none !important;" data-type="gif" data-ratio="1" data-w="20"  /></span></p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">4.3 没有内存保护</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">因为内核是最低层的程序，所以如果内核访问的非法内存，那么整个系统都会挂掉！！所以内核开发的风险比用户程序开发的风险要大。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">而且，内核中的内存是不分页的，每用一个字节的内存，物理内存就少一个字节。所以内核中使用内存一定要谨慎。</p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">4.4 不使用浮点数</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">内核不能完美的支持浮点操作，使用浮点数时，需要人工保存和恢复浮点寄存器及其他一些繁琐的操作。</p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">4.5 内核栈容积小且固定</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">内核栈的大小有编译内核时决定的，对于不用的体系结构，内核栈的大小虽然不一样，但都是固定的。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">查看内核栈大小的方法：</p><pre style="">ulimit -a | <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">grep</span> <span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">stack size</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">&quot;</span></pre><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">4.6 同步和并发</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">Linux是多用户的操作系统，所以必须处理好同步和并发操作，防止因竞争而出现死锁。</p><h4 style="margin: 15px auto 2px; padding-top: 5px; padding-bottom: 5px; padding-left: 10px; font-size: 14px; font-weight: bold; border-radius: 6px; box-shadow: rgb(95, 90, 75) 0px 0px 0px 1px, rgba(10, 10, 0, 0.498039) 1px 1px 6px 1px; color: white; font-family: 微软雅黑, 宋体, 黑体, Arial; height: 15px; line-height: 20px; text-shadow: rgb(34, 34, 34) 2px 2px 3px; white-space: normal; background: rgb(0, 102, 102);">4.7 可移植性</h4><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13.92px; line-height: 20.88px; white-space: normal; background-color: rgb(255, 255, 255);">Linux内核可用于不用的体现结构，支持多种硬件。所以开发时要时刻注意可移植性，尽量使用体系结构无关的代码。</p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name"></div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p class="reward_button_wrp">
                    
                      <span class="reward_pop_panel">
                        <img src="https://res.wx.qq.com/mpres/zh_CN/htmledition/pages/home/index/pic_mp_app4290ba.png" alt="">
                        <strong>扫一扫下载订阅号助手，用手机发文章</strong>
                      </span>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='http://www.cnblogs.com/wang_yb/archive/2012/08/16/2641836.html' target='_blank'>
			阅读全文
		</a>
	</div>
</body>