<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		ARM64 Kernel Image Mapping的变化
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664606217&amp;idx=1&amp;sn=040ba5eceb3ff39046bed757e19cfe80&amp;chksm=f04d87ecc73a0efa092a9ce3995c4d47488b7cb3567d7b2c35913476f57d076ef83771dd81ae&amp;scene=27#wechat_redirect&cpage=9' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">ARM64 Kernel Image Mapping的变化</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                                                        <span class="rich_media_meta rich_media_meta_text">
                                                        smcdef
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2019-02-20</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <h2 style="color: rgb(31, 31, 31);font-size: 18px;font-weight: bold;margin-top: 25px;margin-bottom: 10px;font-family: Arial, Helvetica, sans-serif;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">引言</h2><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">随着linux的代码更新，阅读linux-4.15代码，从中发现很多与众不同的地方。之所以与众不同，就是因为和我之前从网上博客或者书籍中看到的内容有所差异。当然了，并不是为了表明书上或者博客的观点是错误的。而是因为linux代码更新的太快，网上的博客和书籍跟不上linux的步伐而已。究竟是哪些发生了差异了？例如：kernel image映射区域从原来的linear mapping region（线性映射区域）搬移到VMALLOC区域。因此，我希望通过本篇文章揭晓这些差异。当然，我相信不久的将来这篇文章也将会成为一段历史。<br  /></p><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><p style="padding-bottom: 15px;line-height: 20px;">注：文章代码分析基于linux-4.15，架构基于aarch64（ARM64）。涉及页表代码分析部分，假设页表映射层级是4，即配置CONFIG_ARM64_PGTABLE_LEVELS=4。地址宽度是48，即配置CONFIG_ARM64_VA_BITS=48。</p></blockquote><h2 style="color: rgb(31, 31, 31);font-size: 18px;font-weight: bold;margin-top: 25px;margin-bottom: 10px;font-family: Arial, Helvetica, sans-serif;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">kernel启动页表在哪里</h2><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">在ARM64架构上，汇编代码初始化阶段会创建两次地址映射。第一次是为了打开MMU操作的准备。因为再打开MMU之前，当前代码运行在物理地址之上，而打开MMU之后代码运行在虚拟地址之上。为了从物理地址（Physical Address，简称PA）转换到虚拟地址（Virtual Address，简称VA）的平滑过渡，ARM推荐创建VA和PA相等的一段映射（例如：虚拟地址addr通过页表查询映射的物理地址也是addr）。这段映射在linux中称为identity mapping。第二次是kernel image映射。而这段映射在linux-4.15代码上映射区域是VMALLOC区域。</p><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">kernel启动开始首先就会打开MMU，但是打开MMU之前，我们需要填充页表。也就是告诉MMU虚拟地址和物理地址的对应关系。系统启动初期使用section mapping，因此需要3个页面存储页表项。但是我们有identity mapping和kernel image mapping，因此总需要6个页面。那么这6个页面内存是在哪里分配的呢？可以从vmlinux.lds.S中找到答案。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="pln" style="color: rgb(0, 0, 0);">BSS_SECTION</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> ALIGN</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">PAGE_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">idmap_pg_dir </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">.;</span></p></li><li><p><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">+=</span><span class="pln" style="color: rgb(0, 0, 0);"> IDMAP_DIR_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">swapper_pg_dir </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">.;</span></p></li><li><p><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">+=</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_DIR_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">从链接脚本中可以看到预留6个页面存储页表项。紧跟在bss段后面。idmap_pg_dir是identity mapping使用的页表。swapper_pg_dir是kernel image mapping初始阶段使用的页表。请注意，这里的内存是一段连续内存。也就是说页表（PGD/PUD/PMD）都是连在一起的，地址相差PAGE_SIZE（4k）。</p><h2 style="color: rgb(31, 31, 31);font-size: 18px;font-weight: bold;margin-top: 25px;margin-bottom: 10px;font-family: Arial, Helvetica, sans-serif;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">如何填充页表的页表项</h2><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">从链接脚本vmlinux.lds.S文件中可以找到kernel代码起始代码段是".head.text"段，因此kernel的代码起始位置位于arch/arm64/kernel/head.S文件<code>_head</code>标号。在head.S文件中有三个宏定义和创建地址映射相关。分别是：<code>create_table_entry</code>、<code>create_pgd_entry</code>和<code>create_block_map</code>。</p><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">create_table_entry实现如下。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Macro to create a table entry to the next page.</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *	tbl:	页表基地址</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *	virt:	需要创建地址映射的虚拟地址</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *	shift:	#imm page table shift</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *	ptrs:	#imm pointers per table page</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Preserves:	virt</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Corrupts:	tmp1, tmp2</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Returns:	tbl -&gt; next level table page address</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">macro	create_table_entry</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> shift</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> ptrs</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp2</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	lsr	\tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#\shift</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	and	\tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#\ptrs - 1	 &nbsp; &nbsp;// table index</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	add	\tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#PAGE_SIZE</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	orr	\tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#PMD_TYPE_TABLE	// address of next table and entry type</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	str	\tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">[</span><span class="pln" style="color: rgb(0, 0, 0);">\tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> lsl </span><span class="com" style="color: rgb(136, 0, 0);">#3]</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	add	\tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#PAGE_SIZE		 &nbsp; &nbsp;// next level table page</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">endm </span></p></li></ol></pre></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">这里是汇编中的宏定义。汇编中宏定义是以<code>.macro</code>开头，以<code>.endm</code>结尾。宏定义中以<code>\x</code>来引用宏定义中的参数<code>x</code>。该宏定义的作用是创建一个level的页表项（PGD/PUD/PMD）。具体是哪个level是由virt、shift和ptrs参数决定。我总是喜欢帮你翻译成C语言的形式。C语言如果不懂的话，我也没办法了。既然汇编你不熟悉，没关系，下面帮你转换成C语言的宏定义。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> PAGE_SIZE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">12</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> PMD_TYPE_TABLE &nbsp; &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">3</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> create_table_entry</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> shift</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> ptrs</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">do</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		tmp1 </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> virt </span><span class="pun" style="color: rgb(102, 102, 0);">&gt;&gt;</span><span class="pln" style="color: rgb(0, 0, 0);"> shift</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 1 */</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		tmp1 </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;=</span><span class="pln" style="color: rgb(0, 0, 0);"> ptrs </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 1 */</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		tmp2 </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> tbl </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> PAGE_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 2 */</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		tmp2 </span><span class="pun" style="color: rgb(102, 102, 0);">|=</span><span class="pln" style="color: rgb(0, 0, 0);"> PMD_TYPE_TABLE</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 3 */</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		</span><span class="pun" style="color: rgb(102, 102, 0);">*((</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">long</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">*)(</span><span class="pln" style="color: rgb(0, 0, 0);">tbl </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">tmp1 </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">3</span><span class="pun" style="color: rgb(102, 102, 0);">)))</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 4 */</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		tbl </span><span class="pun" style="color: rgb(102, 102, 0);">+=</span><span class="pln" style="color: rgb(0, 0, 0);"> PAGE_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 5 */</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">while</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre></pre><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><ol start="" class=" list-paddingleft-2" style=""><li><p>根据virt和ptrs参数计算该虚拟地址virt的页表项在页表中的index。例如计算virt地址在PGD也表中的indedx，可以传递shift = PGDIR_SHIFT，ptrs = PTRS_PER_PGD，tbl传递PGD页表基地址。所以，宏定义是一个创建中间level的页表项。</p></li><li><p>既然要填充当前level的页表项就需要告知下一个level页表的基地址，这里就是计算下一个页表的基地址。还记得上面说的idmap_pg_dir和swapper_pg_dir吗？页表（PGD/PUD/PMD）都是连在一起的，地址相差PAGE_SIZE。</p></li><li><p>告知MMU这是一个中间level页表并且是有效的。</p></li><li><p>页表项的真正填充操作，tmp1 &lt;&lt; 3是因为ARM64的地址占用8bytes。</p></li><li><p>更新tbl，也就只指向下一个level页表的地址，可以方便再一次调用create_table_entry填充下一个level页表项而不用自己更新tbl。</p></li></ol></blockquote><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">create_pgd_entry的实现如下。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Macro to populate the PGD (and possibily PUD) for the corresponding</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * block entry in the next level (tbl) for the given virtual address.</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Preserves:	tbl, next, virt</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Corrupts:	tmp1, tmp2</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">macro	create_pgd_entry</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp2</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	create_table_entry \tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> PGDIR_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> PTRS_PER_PGD</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tmp2</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	create_table_entry \tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_TABLE_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> PTRS_PER_PTE</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \tmp2</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">endm </span></p></li></ol></pre></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">create_pgd_entry可以用来填充PGD、PUD、PMD等中间level页表对应页表项。虽然名字是创建PGD的描述符，但是实际上是一级一级的创建页表项，最终只留下最后一级页表没有填充页表项。老规矩转换成C语言分析。</p><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;color: rgb(50, 50, 50);text-align: left;background-color: rgb(255, 255, 255);"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_TABLE_SHIFT	PUD_SHIFT</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> create_pgd_entry</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">do</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		create_table_entry</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> PGDIR_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> PTRS_PER_PGD</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 1 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		create_table_entry</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> virt</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_TABLE_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> PTRS_PER_PTE</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp1</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tmp2</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">/* 2 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">while</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><ol start="" class=" list-paddingleft-2" style=""><li><p>这里的tbl参数相当于PGD页表地址，调用create_table_entry创建PGD页表中virt地址对应的页表项。</p></li><li><p>填充下一个level的页表项。这里是PUD页表。由于使用了ARM64初期使用section mapping，因此PUD页表就是最后一个中间level的页表，所以只剩下PMD页表的页表项没有填充，virt地址对应的PMD页表项最终会填充block descriptor。假设这里使用4级页表，那么下面还会创建PMD页表的页表项，也就是只留下PTE页表。所以，宏定义是创建所有中间level的页表项，只留下最后一级页表。</p></li></ol></blockquote><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">在经过create_pgd_entry宏的调用后，就填充好了从PGD开始的所有中间level的页表的页表项的填充操作。现在是不是只剩下PTE页表的页表项没有填充呢？所以最后一个create_block_map就是完成这个操作的。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Macro to populate block entries in the page table for the start..end</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * virtual range (inclusive).</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Preserves:	tbl, flags</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * Corrupts:	phys, start, end, pstate</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">macro	create_block_map</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> flags</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> end</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	lsr	\phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#SWAPPER_BLOCK_SHIFT</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	lsr	\start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#SWAPPER_BLOCK_SHIFT</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	and	\start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#PTRS_PER_PTE - 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // table index</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	orr	\phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \flags</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> lsl </span><span class="com" style="color: rgb(136, 0, 0);">#SWAPPER_BLOCK_SHIFT &nbsp;// table entry</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	lsr	\end</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \end</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#SWAPPER_BLOCK_SHIFT</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	and	\end</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \end</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#PTRS_PER_PTE - 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // table end index</span></p></li><li><p><span class="lit" style="color: rgb(0, 102, 102);">9999</span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln" style="color: rgb(0, 0, 0);">	str	\phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">[</span><span class="pln" style="color: rgb(0, 0, 0);">\tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> lsl </span><span class="com" style="color: rgb(136, 0, 0);">#3] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // store the entry</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	add	\start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// next entry</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	add	\phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="com" style="color: rgb(136, 0, 0);">#SWAPPER_BLOCK_SIZE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // next block</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	cmp	\start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> \end</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	b</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">ls	</span><span class="lit" style="color: rgb(0, 102, 102);">9999b</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">endm </span></p></li></ol></pre></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">create_block_map宏的作用是创建虚拟地址（从start到end）区域映射到到phys物理地址。传入5个参数，分别如下意思。</p><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><ul class=" list-paddingleft-2" style=""><li><p>tbl：页表基地址</p></li><li><p>flags：将要填充页表项的flags</p></li><li><p>phys：创建映射的物理地址</p></li><li><p>start：创建映射的虚拟地址起始地址</p></li><li><p>end：创建映射的虚拟地址结束地址</p></li></ul></blockquote><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">我们还是依然翻译成C语言分析。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_BLOCK_SHIFT	PMD_SHIFT</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_BLOCK_SIZE	</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> PMD_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> create_block_map</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">tbl</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> flags</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> phys</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> start</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> end</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">do</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp;\</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		phys </span><span class="pun" style="color: rgb(102, 102, 0);">&gt;&gt;=</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_BLOCK_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 1 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		start </span><span class="pun" style="color: rgb(102, 102, 0);">&gt;&gt;=</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_BLOCK_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 2 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		start </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;=</span><span class="pln" style="color: rgb(0, 0, 0);"> PTRS_PER_PTE </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 2 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		phys </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> flags </span><span class="pun" style="color: rgb(102, 102, 0);">|</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">phys </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_BLOCK_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="com" style="color: rgb(136, 0, 0);">/* 3 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		end </span><span class="pun" style="color: rgb(102, 102, 0);">&gt;&gt;=</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_BLOCK_SHIFT</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 4 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		end </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;=</span><span class="pln" style="color: rgb(0, 0, 0);"> PTRS_PER_PTE </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 4 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">while</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">start </span><span class="pun" style="color: rgb(102, 102, 0);">!=</span><span class="pln" style="color: rgb(0, 0, 0);"> end</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 5 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">			</span><span class="pun" style="color: rgb(102, 102, 0);">*((</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">long</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">*)(</span><span class="pln" style="color: rgb(0, 0, 0);">tbl </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">start </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">3</span><span class="pun" style="color: rgb(102, 102, 0);">)))</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> phys</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 6 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">			start</span><span class="pun" style="color: rgb(102, 102, 0);">++;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 7 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">			phys </span><span class="pun" style="color: rgb(102, 102, 0);">+=</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_BLOCK_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 8 */</span><span class="pln" style="color: rgb(0, 0, 0);"> \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		</span><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">while</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre></pre><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><ol start="" class=" list-paddingleft-2" style=""><li><p>针对phys的低SWAPPER_BLOCK_SHIFT位进行清零，和第三步骤的phys &lt;&lt; SWAPPER_BLOCK_SHIFT收尾呼应。相当于对齐（这里的情况是2M对齐）。</p></li><li><p>计算起始地址start的页目录项的index。</p></li><li><p>构造描述符。</p></li><li><p>计算结束地址end的页目录项的index。</p></li><li><p>循环填充start到end的页目录项。</p></li><li><p>根据页表基地址tbl和当前的start变量填充对应的页表项。start &lt;&lt; 3是因为ARM64地址占用8 bytes。</p></li><li><p>更新下一个页表项。</p></li><li><p>更新下一个block的物理地址。</p></li></ol></blockquote><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">如何使用上述三个接口创建映射关系呢？其实很简单，首先我们需要先调用create_pgd_entry宏填充PGD以及所有中间level的页表项。最后的PMD页表的填充可以调用create_block_map宏来完成操作。</p><h2 style="color: rgb(31, 31, 31);font-size: 18px;font-weight: bold;margin-top: 25px;margin-bottom: 10px;font-family: Arial, Helvetica, sans-serif;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">如何创建页表</h2><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">在汇编代码阶段的head.S文件中，负责创建映射关系的函数是create_page_tables。create_page_tables函数负责identity mapping和kernel image mapping。前文提到identity mapping主要是打开MMU的过度阶段，因此对于identity mapping不需要映射整个kernel，只需要映射操作MMU代码相关的部分。如何区分这部分代码呢？当然是利用linux中常用手段自定义代码段。自定义的代码段的名称是".idmap.text"。除此之外，肯定还需要在链接脚本中声明两个标量，用来标记代码段的开始和结束。可以从vmlinux.lds.S中找到答案。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> IDMAP_TEXT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> ALIGN</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">SZ_4K</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	VMLINUX_SYMBOL</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">__idmap_text_start</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">.;</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp;\</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">*(.</span><span class="pln" style="color: rgb(0, 0, 0);">idmap</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">text</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	VMLINUX_SYMBOL</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">__idmap_text_end</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">.;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">从链接脚本中可以看出idmap_text_start和idmap_text_end分别是.idmap.text段的起始和结束地址。在创建identity mapping的时候会使用。另外我们同样从链接脚本中得到_text和_end两个变量，分别是kernel代码链接的开始和结束地址。编译器的链接地址实际上就是最后代码期望运行的地址。在KASLR关闭的情况下就是kernel image需要映射的虚拟地址。当我们编译kernel后，可以根据符号表System.map文件查看哪些函数被放在".idmap.text"段。当然你也可以看代码，但是我觉得没有这种方法简单。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc000 T __idmap_text_start</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc000 T kimage_vaddr</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc008 T el2_setup</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc054 t </span><span class="typ" style="color: rgb(102, 0, 102);">set</span><span class="pln" style="color: rgb(0, 0, 0);">_hcr</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc118 t install_el2_stub</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc16c t </span><span class="typ" style="color: rgb(102, 0, 102);">set</span><span class="pln" style="color: rgb(0, 0, 0);">_cpu_boot_mode_flag</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc190 T secondary_holding_pen</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc1b4 t pen</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc1c8 T secondary_entry</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc1d4 t secondary_startup</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc1e4 t __secondary_switched</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc218 T __enable_mmu</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc26c t __no_granule_support</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc290 t __primary_switch</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc2b0 T cpu_resume</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc2d0 T cpu_do_resume</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc340 T idmap_cpu_replace_ttbr1</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc370 T __cpu_setup</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc3f0 t crval</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ffff200008fbc408 T __idmap_text_end </span></p></li></ol></pre></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">create_page_tables的汇编代码比较简单，就不转换成C语言讲解了。create_page_tables实现如下。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="pln" style="color: rgb(0, 0, 0);">__create_page_tables</span><span class="pun" style="color: rgb(102, 102, 0);">:</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	mov	x7</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> SWAPPER_MM_MMUFLAGS</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 * Create the identity mapping.</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	adrp	x0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> idmap_pg_dir &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 1 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	adrp	x3</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> __idmap_text_start &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// __pa(__idmap_text_start) &nbsp;/* 2 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	create_pgd_entry x0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x3</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 3 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	mov	x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// __pa(__idmap_text_start) &nbsp;/* 4 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	adr_l	x6</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> __idmap_text_end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// __pa(__idmap_text_end)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	create_block_map x0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x7</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x3</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 5 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 * Map the kernel image.</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	adrp	x0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> swapper_pg_dir &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 6 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	mov_q	x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> KIMAGE_VADDR </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> TEXT_OFFSET &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// compile time __va(_text)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	add	x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x23 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">// add KASLR displacement &nbsp; &nbsp;/* 7 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	create_pgd_entry x0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x3</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 8 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	adrp	x6</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> _end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// runtime __pa(_end)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	adrp	x3</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> _text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">// runtime __pa(_text)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	sub	x6</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x6</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// _end - _text</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	add	x6</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x6</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// runtime __va(_end)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	create_block_map x0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x7</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x3</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x5</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 9 */</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre></pre><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><ol start="" class=" list-paddingleft-2" style=""><li><p>x0寄存器PGD页表基地址，这里是idmap_pg_dir，是为了创建identity mapping。</p></li><li><p>adrp指令可以获取__idmap_text_start符号的实际运行物理地址。</p></li><li><p>填充PGD及中间level页表的页表项。</p></li><li><p>因为我们为了创建虚拟地址和物理地址相等的映射，因此这里的x5和x3值相等。</p></li><li><p>调用create_block_map创建identity mapping，注意这里传递的参数物理地址（x3）和虚拟地址（x5）相等。</p></li><li><p>创建kernel image mapping，PGD页表基地址是swapper_pg_dir。</p></li><li><p>KASLR默认关闭的情况下，x23的值为0。</p></li><li><p>填充PGD及中间level页表的页表项。</p></li><li><p>填充PMD页表项。因为采用的是section mapping，所以一个页表项对应2M大小。注意汇编中的注释，va()代表得到的事虚拟地址，pa()得到的是物理地址。</p></li></ol></blockquote><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">经过以上初始化，页表就算是初始化完成。kernel映射区域从先行映射区域迁移到VMALLOC区域在哪里体现呢？答案就是KIMAGE_VADDR宏定义。KIMAGE_VADDR是kernel的虚拟地址。其定义在arch/arm64/mm/memory.h文件。</p><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;color: rgb(50, 50, 50);text-align: left;background-color: rgb(255, 255, 255);"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> VA_BITS &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">CONFIG_ARM64_VA_BITS</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> VA_START &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">UL</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">0xffffffffffffffff</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">UL</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> VA_BITS</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> PAGE_OFFSET &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">UL</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">0xffffffffffffffff</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">UL</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">VA_BITS </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">))</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> KIMAGE_VADDR &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">MODULES_END</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> VMALLOC_START &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">MODULES_END</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> VMALLOC_END &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">PAGE_OFFSET </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> PUD_SIZE </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> VMEMMAP_SIZE </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> SZ_64K</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> MODULES_END &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">MODULES_VADDR </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> MODULES_VSIZE</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> MODULES_VADDR &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">VA_START </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> KASAN_SHADOW_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> MODULES_VSIZE &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">SZ_128M</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> VMEMMAP_START &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">PAGE_OFFSET </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> VMEMMAP_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> PCI_IO_END &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">VMEMMAP_START </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> SZ_2M</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> PCI_IO_START &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">PCI_IO_END </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> PCI_IO_SIZE</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> FIXADDR_TOP &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">PCI_IO_START </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> SZ_2M</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> TASK_SIZE_64 &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">UL</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> VA_BITS</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">上面的宏定义显得不够直观，画张图表示现阶段kernel的地址空间分布情况。可以看出KIMAGE_VADDR正好处在VMALLOC区域，因此kernnel的运行地址位于VMALLOC区域。</p><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-copyright="0" data-ratio="2.015837104072398" data-s="300,640" src="data:image/PNG;base64,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 " src="SeWfibBcBT0Hob46kUyZNVzJXHdQBUMIqicUl94vFNgNtKk85mVqAmmKbXicuwyUh3YiaA5nqZXU6xTlgnRT4TeeRw"  data-type="png" data-w="442" style="text-align: center;white-space: normal;"  /></p><h2 style="color: rgb(31, 31, 31);font-size: 18px;font-weight: bold;margin-top: 25px;margin-bottom: 10px;font-family: Arial, Helvetica, sans-serif;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">virt_to_phys和phys_to_virt怎么办</h2><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">通过上面的介绍，你应该有所了解kernel image和linear mapping region不在一个区域。virt_to_phys宏的作用是将内核虚拟地址转换成物理地址（针对线性映射区域）。在kernel image还在线性映射区域的时候，virt_to_phys宏可以将kernel代码中的一个地址转换成物理地址，因为线性映射区域，物理地址和虚拟地址只有一个偏移。因此两者很容易转换。那么现在kernel image和线性映射区域分开了，virt_to_phys宏又该如何实现呢？virt_to_phys宏实现如下。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> PHYS_OFFSET &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">({</span><span class="pln" style="color: rgb(0, 0, 0);"> VM_BUG_ON</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">memstart_addr </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> memstart_addr</span><span class="pun" style="color: rgb(102, 102, 0);">;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">})</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> __is_lm_address</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">addr</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp;</span><span class="pun" style="color: rgb(102, 102, 0);">(!!((</span><span class="pln" style="color: rgb(0, 0, 0);">addr</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln" style="color: rgb(0, 0, 0);"> BIT</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">VA_BITS </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">)))</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> __lm_to_phys</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">addr</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">(((</span><span class="pln" style="color: rgb(0, 0, 0);">addr</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">&amp;</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">~</span><span class="pln" style="color: rgb(0, 0, 0);">PAGE_OFFSET</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> PHYS_OFFSET</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> __kimg_to_phys</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">addr</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; </span><span class="pun" style="color: rgb(102, 102, 0);">((</span><span class="pln" style="color: rgb(0, 0, 0);">addr</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> kimage_voffset</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> __virt_to_phys_nodebug</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">x</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">({</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="typ" style="color: rgb(102, 0, 102);">phys_addr_t</span><span class="pln" style="color: rgb(0, 0, 0);"> __x </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">phys_addr_t</span><span class="pun" style="color: rgb(102, 102, 0);">)(</span><span class="pln" style="color: rgb(0, 0, 0);">x</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	__is_lm_address</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">__x</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">?</span><span class="pln" style="color: rgb(0, 0, 0);"> __lm_to_phys</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">__x</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">:</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp;\</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">			 &nbsp; &nbsp; &nbsp; __kimg_to_phys</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">__x</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> __virt_to_phys</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">x</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);">	__virt_to_phys_nodebug</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">x</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">static</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">inline</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="typ" style="color: rgb(102, 0, 102);">phys_addr_t</span><span class="pln" style="color: rgb(0, 0, 0);"> virt_to_phys</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">const</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">volatile</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">void</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">*</span><span class="pln" style="color: rgb(0, 0, 0);">x</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pun" style="color: rgb(102, 102, 0);">{</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">return</span><span class="pln" style="color: rgb(0, 0, 0);"> __virt_to_phys</span><span class="pun" style="color: rgb(102, 102, 0);">((</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">unsigned</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">long</span><span class="pun" style="color: rgb(102, 102, 0);">)(</span><span class="pln" style="color: rgb(0, 0, 0);">x</span><span class="pun" style="color: rgb(102, 102, 0);">));</span></p></li><li><p><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre><br  /></pre><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">从__virt_to_phys_nodebug宏可以看出其中的奥秘。通过addr地址的(VA_BITS - 1)位是否为1判断addr是位于kernel image区域还是线性映射区域（因为线性映射区域大小正好是kernel虚拟地址空间大小的一半）。针对线性映射区域，虚拟地址和物理地址的偏差是memstart_addr。针对kernel image区域，虚拟地址和物理地址的偏差是kimage_voffset。kimage_voffset和memstart_addr是如何计算的呢？先看看kimage_voffset的计算。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> KERNEL_START &nbsp; &nbsp;_text</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">#define</span><span class="pln" style="color: rgb(0, 0, 0);"> __PHYS_OFFSET	</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">KERNEL_START </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> TEXT_OFFSET</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">ENTRY</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">kimage_vaddr</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">.</span><span class="pln" style="color: rgb(0, 0, 0);">quad		_text </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> TEXT_OFFSET</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * The following fragment of code is executed with the MMU enabled.</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> *</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> * &nbsp; x0 = __PHYS_OFFSET</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);"> */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">__primary_switched</span><span class="pun" style="color: rgb(102, 102, 0);">:</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	ldr_l	x4</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> kimage_vaddr &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// Save the offset between &nbsp; &nbsp; &nbsp;/* 2 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	sub	x4</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x4</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// the kernel virtual and &nbsp; &nbsp; &nbsp; /* 3 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	str_l	x4</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> kimage_voffset</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> x5 &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">// physical mappings &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* 4 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	b	start_kernel</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">__primary_switch</span><span class="pun" style="color: rgb(102, 102, 0);">:</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	bl	__enable_mmu</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	ldr	x8</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);">__primary_switched</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	adrp	x0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> __PHYS_OFFSET &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 1 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	br	x8 </span></p></li></ol></pre><br  /></pre><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><ol start="" class=" list-paddingleft-2" style=""><li><p>x0是<em>_primary_switch函数中设置。x0寄存器通过adrp指令可以获取运行时的地址。也就是实际运行的物理地址。你是不是好奇此时不是已经打开MMU了嘛！为什么adrp得到的运行地址就是物理地址呢？请往上翻看看_</em>primary_switch函数是不是位于".idmap.text"段，那么该段是identity mapping。因此获取的运行地址虽然是虚拟地址，但是它和实际运行的物理地址相等。</p></li><li><p>x4寄存器保存的是kernel image的运行的虚拟地址。你是不是又好奇这个地方为什么获取的运行地址和物理地址不相等呢？其实是因为__primary_switched函数映射在kernel image mapping区域。</p></li><li><p>计算虚拟地址和物理地址的偏移。</p></li><li><p>将偏移写入kimage_voffset全局变量。</p></li></ol></blockquote><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">memstart_addr是kernel选取的物理基地址，memstart_addr在arm64_memblock_init函数中设置。arm64_memblock_init函数实现如下（截取部分代码）。</p><pre style="color: rgb(50, 50, 50);font-size: 13px;text-align: left;background-color: rgb(255, 255, 255);"><pre class="prettyprint lang-cpp linenums" style="border-width: 0px;border-style: solid;border-color: rgb(136, 136, 136);font-family: &quot;Courier New&quot;, Courier, monospace;font-size: 12px;overflow: auto;margin-top: 5px;margin-bottom: 5px;padding: 0px;line-height: 12pt;"><ol class="linenums list-paddingleft-2" style=""><li><p><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">void</span><span class="pln" style="color: rgb(0, 0, 0);"> __init arm64_memblock_init</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">void</span><span class="pun" style="color: rgb(102, 102, 0);">)</span></p></li><li><p><span class="pun" style="color: rgb(102, 102, 0);">{</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">const</span><span class="pln" style="color: rgb(0, 0, 0);"> s64 linear_region_size </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">-(</span><span class="pln" style="color: rgb(0, 0, 0);">s64</span><span class="pun" style="color: rgb(102, 102, 0);">)</span><span class="pln" style="color: rgb(0, 0, 0);">PAGE_OFFSET</span><span class="pun" style="color: rgb(102, 102, 0);">;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 * Ensure that the linear region takes up exactly half of the kernel</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 * virtual address space. This way, we can distinguish a linear address</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 * from a kernel/module/vmalloc address by testing a single bit.</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	BUILD_BUG_ON</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">linear_region_size </span><span class="pun" style="color: rgb(102, 102, 0);">!=</span><span class="pln" style="color: rgb(0, 0, 0);"> BIT</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">VA_BITS </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="lit" style="color: rgb(0, 102, 102);">1</span><span class="pun" style="color: rgb(102, 102, 0);">));</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 1 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="com" style="color: rgb(136, 0, 0);">/*</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 * Select a suitable value for the base of physical memory.</span></p></li><li><p><span class="com" style="color: rgb(136, 0, 0);">	 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	memstart_addr </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> round_down</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">memblock_start_of_DRAM</span><span class="pun" style="color: rgb(102, 102, 0);">(),</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 2 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">				 &nbsp; ARM64_MEMSTART_ALIGN</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">&nbsp;</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	memblock_remove</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="typ" style="color: rgb(102, 0, 102);">max_t</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">u64</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> memstart_addr </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> linear_region_size</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 3 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">			__pa_symbol</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">_end</span><span class="pun" style="color: rgb(102, 102, 0);">)),</span><span class="pln" style="color: rgb(0, 0, 0);"> ULLONG_MAX</span><span class="pun" style="color: rgb(102, 102, 0);">);</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="kwd" style="color: rgb(0, 0, 136);font-weight: bold;">if</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">memstart_addr </span><span class="pun" style="color: rgb(102, 102, 0);">+</span><span class="pln" style="color: rgb(0, 0, 0);"> linear_region_size </span><span class="pun" style="color: rgb(102, 102, 0);">&lt;</span><span class="pln" style="color: rgb(0, 0, 0);"> memblock_end_of_DRAM</span><span class="pun" style="color: rgb(102, 102, 0);">())</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">{</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		</span><span class="com" style="color: rgb(136, 0, 0);">/* ensure that memstart_addr remains sufficiently aligned */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		memstart_addr </span><span class="pun" style="color: rgb(102, 102, 0);">=</span><span class="pln" style="color: rgb(0, 0, 0);"> round_up</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="pln" style="color: rgb(0, 0, 0);">memblock_end_of_DRAM</span><span class="pun" style="color: rgb(102, 102, 0);">()</span><span class="pln" style="color: rgb(0, 0, 0);"> </span><span class="pun" style="color: rgb(102, 102, 0);">-</span><span class="pln" style="color: rgb(0, 0, 0);"> linear_region_size</span><span class="pun" style="color: rgb(102, 102, 0);">,</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">					 ARM64_MEMSTART_ALIGN</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com" style="color: rgb(136, 0, 0);">/* 4 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">		memblock_remove</span><span class="pun" style="color: rgb(102, 102, 0);">(</span><span class="lit" style="color: rgb(0, 102, 102);">0</span><span class="pun" style="color: rgb(102, 102, 0);">,</span><span class="pln" style="color: rgb(0, 0, 0);"> memstart_addr</span><span class="pun" style="color: rgb(102, 102, 0);">);</span><span class="pln" style="color: rgb(0, 0, 0);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com" style="color: rgb(136, 0, 0);">/* 5 */</span></p></li><li><p><span class="pln" style="color: rgb(0, 0, 0);">	</span><span class="pun" style="color: rgb(102, 102, 0);">}</span></p></li><li><p><span class="pun" style="color: rgb(102, 102, 0);">}</span><span class="pln" style="color: rgb(0, 0, 0);"> </span></p></li></ol></pre><br  /></pre><blockquote style="margin-right: 20px;margin-bottom: 20px;margin-left: 20px;padding: 25px 20px;background: rgb(239, 239, 239);border-left-width: 5px;border-left-color: rgb(105, 105, 105);border-right: 5px solid rgb(105, 105, 105);color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;"><ol start="" class=" list-paddingleft-2" style=""><li><p>从注释以及代码皆可以看出，PAGE_OFFSET是线性区域的开始虚拟地址。线性区域大小是整个kernel虚拟地址空间的一半。</p></li><li><p>选取一个合适的物理基地址，根据RAM的起始地址按照1G对齐。</p></li><li><p>memstart_addr是选取的物理基地址。kernel虚拟地址空间一半大小作为线性映射区域。因此最大支持的内存范围是memstart_addr + linear_region_size。所以告诉memblock，超过这个区域的范围都是非法的。</p></li><li><p>如果memstart_addr + linear_region_size的值小于RAM的结束地址，说明[memstart_addr, memstart_addr + linear_region_size]地址空间范围的区域无法覆盖整个RAM地址范围。这时候就需要从RAM结束地址减去linear_region_size的值作为memstart_addr。什么时候会出现这种情况呢？当物理内存足够大时，if语句就可能满足条件了。</p></li><li><p>既然4满足，自然这里[0, memstart_addr]的地址空间需要从memblock中remove。</p></li></ol></blockquote><p style="padding-bottom: 15px;line-height: 20px;color: rgb(50, 50, 50);font-family: Arial, Helvetica, sans-serif;font-size: 13px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);">memstart_addr的值定下来之后，虚拟地址和物理地址以memstart_addr为偏差创建线性映射区域。在map_mem函数中完成。phys_to_virt宏的实现就不用介绍了，就是virt_to_phys的反操作。</p><p style="text-align: center;"><br  /></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name">smcdef</div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p class="reward_button_wrp">
                    
                      <span class="reward_pop_panel">
                        <img src="https://res.wx.qq.com/mpres/zh_CN/htmledition/pages/home/index/pic_mp_app4290ba.png" alt="">
                        <strong>扫一扫下载订阅号助手，用手机发文章</strong>
                      </span>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='http://www.wowotech.net/memory_management/436.html' target='_blank'>
			阅读全文
		</a>
	</div>
</body>