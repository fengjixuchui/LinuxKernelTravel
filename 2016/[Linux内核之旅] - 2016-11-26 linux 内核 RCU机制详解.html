<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		linux 内核 RCU机制详解
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664603495&amp;idx=2&amp;sn=a526c6c36e9c97a0dec705aa67567d5b&amp;chksm=f04db282c73a3b9469877977d532349dd20e9c25f9a1ce193400822676e0dbc31bbf4e1ce7fa&amp;scene=27#wechat_redirect&cpage=54' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">linux 内核 RCU机制详解</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                        Linux爱好者
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2016-11-26</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 1.5em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="font-size: 16px; color: rgb(255, 41, 65);"><strong><span style="font-size: 16px; max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">本文转载自Linux爱好者</span></strong></span></p><p style="max-width: 100%; min-height: 1em; line-height: 1.5em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="color: rgb(255, 41, 65); font-size: 16px;"><strong><span style="color: rgb(255, 41, 65); max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">来源：xabc3000&nbsp;</span></strong></span></p></blockquote><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 1.5em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="color: rgb(255, 41, 65); font-size: 16px;"><strong><span style="color: rgb(255, 41, 65); max-width: 100%; line-height: 22.4px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">链接：http://blog.csdn.net/xabc3000/article/details/15335131</span></strong></span></p></blockquote><p><br  /></p><h4 style="max-width: 100%; color: rgb(62, 62, 62); line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(123, 12, 0); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">简介</strong></span></h4><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">RCU（Read-Copy Update）是数据同步的一种方式，在当前的Linux内核中发挥着重要的作用。RCU主要针对的数据对象是链表，目的是提高遍历读取数据的效率，为了达到目的使用RCU机制读取数据的时候不对链表进行耗时的加锁操作。这样在同一时间可以有多个线程同时读取该链表，并且允许一个线程对链表进行修改（修改的时候，需要加锁）。RCU适用于需要频繁的读取数据，而相应修改数据并不多的情景，例如在文件系统中，经常需要查找定位目录，而对目录的修改相对来说并不多，这就是RCU发挥作用的最佳场景。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">Linux内核源码当中,关于RCU的文档比较齐全，你可以在 /Documentation/RCU/ 目录下找到这些文件。Paul E. McKenney 是内核中RCU源码的主要实现者，他也写了很多RCU方面的文章。他把这些文章和一些关于RCU的论文的链接整理到了一起。http://www2.rdrop.com/users/paulmck/RCU/</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">在RCU的实现过程中，我们主要解决以下问题：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">1，在读取过程中，另外一个线程删除了一个节点。删除线程可以把这个节点从链表中移除，但它不能直接销毁这个节点，必须等到所有的读取线程读取完成以后，才进行销毁操作。RCU中把这个过程称为宽限期（Grace period）。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">2，在读取过程中，另外一个线程插入了一个新节点，而读线程读到了这个节点，那么需要保证读到的这个节点是完整的。这里涉及到了发布-订阅机制（Publish-Subscribe Mechanism）。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">3， 保证读取链表的完整性。新增或者删除一个节点，不至于导致遍历一个链表从中间断开。但是RCU并不保证一定能读到新增的节点或者不读到要被删除的节点。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><h4 style="max-width: 100%; color: rgb(62, 62, 62); line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(123, 12, 0); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">宽限期</strong></span></h4><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">通过例子，方便理解这个内容。以下例子修改于Paul的文章。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">struct</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">int</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">a</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">char</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">b</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">long</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">c</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">};</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">DEFINE_SPINLOCK</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">foo_mutex</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">struct</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo_read</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">if</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> != </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">NULL</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">dosomething</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">a</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important;">b</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important;">c</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo_update</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">_</span>fp<span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">spin_lock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&amp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">foo_mutex</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">old_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">spin_unlock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&amp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">foo_mutex</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">kfee</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">old_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span></p></blockquote><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">如上的程序，是针对于全局变量gbl_foo的操作。假设以下场景。有两个线程同时运行 foo_ read和foo_update的时候，当foo_ read执行完赋值操作后，线程发生切换；此时另一个线程开始执行foo_update并执行完成。当foo_ read运行的进程切换回来后，运行dosomething 的时候，fp已经被删除，这将对系统造成危害。为了防止此类事件的发生，RCU里增加了一个新的概念叫宽限期（Grace period）。如下图所示：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img class="" data-ratio="0.5863787375415282" src="data:image/PNG;base64,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 " src="9aPYe0E1fb2zicmibmGHVgv00XPuQicciba2f304T7cBKCLRdGVYiaTNQm5jADlAYuYRkQ7V6WLAtp8WlVdbfRNxSlw"  data-type="png" data-w="602" style="margin: auto; border-width: 0px; border-style: initial; border-color: initial; font-size: 0px; color: transparent; vertical-align: middle; text-align: center; display: block; clear: both; box-sizing: border-box !important; word-wrap: break-word !important; width: auto !important; visibility: visible !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">图中每行代表一个线程，最下面的一行是删除线程，当它执行完删除操作后，线程进入了宽限期。宽限期的意义是，在一个删除动作发生后，它必须等待所有在宽限期开始前已经开始的读线程结束，才可以进行销毁操作。这样做的原因是这些线程有可能读到了要删除的元素。图中的宽限期必须等待1和2结束；而读线程5在宽限期开始前已经结束，不需要考虑；而3,4,6也不需要考虑，因为在宽限期结束后开始后的线程不可能读到已删除的元素。为此RCU机制提供了相应的API来实现这个功能。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo_read</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_read_lock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">if</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> != </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">NULL</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">dosomething</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">a</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">b</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">c</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_read_unlock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo_update</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">_</span>fp<span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">spin_lock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&amp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">foo_mutex</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">old_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">spin_unlock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&amp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">foo_mutex</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">synchronize_rcu</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">kfee</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">old_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span></p></blockquote><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">其中foo_read中增加了rcu_read_lock和rcu_read_unlock，这两个函数用来标记一个RCU读过程的开始和结束。其实作用就是帮助检测宽限期是否结束。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">foo_update增加了一个函数synchronize_rcu()，调用该函数意味着一个宽限期的开始，而直到宽限期结束，该函数才会返回。我们再对比着图看一看，线程1和2，在synchronize_rcu之前可能得到了旧的gbl_foo，也就是foo_update中的old_fp，如果不等它们运行结束，就调用kfee(old_fp)，极有可能造成系统崩溃。而3,4,6在synchronize_rcu之后运行，此时它们已经不可能得到old_fp，此次的kfee将不对它们产生影响。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">宽限期是RCU实现中最复杂的部分,原因是在提高读数据性能的同时，删除数据的性能也不能太差。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><h4 style="max-width: 100%; color: rgb(62, 62, 62); line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(123, 12, 0); box-sizing: border-box !important; word-wrap: break-word !important;">订阅——发布机制</span></strong></h4><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">当前使用的编译器大多会对代码做一定程度的优化，CPU也会对执行指令做一些优化调整,目的是提高代码的执行效率，但这样的优化，有时候会带来不期望的结果。如例：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo_update</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">_</span>fp<span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">spin_lock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&amp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">foo_mutex</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">old_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">a</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 153, 153) !important;">1</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">b</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span>‘<span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important;">b</span>’<span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">c</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 153, 153) !important;">100</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">new_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">spin_unlock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&amp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">foo_mutex</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">synchronize_rcu</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">kfee</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">old_fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span></p></blockquote><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">这段代码中，我们期望的是6，7，8行的代码在第10行代码之前执行。但优化后的代码并不对执行顺序做出保证。在这种情形下，一个读线程很可能读到 new_fp，但new_fp的成员赋值还没执行完成。当读线程执行dosomething(fp-&gt;a, fp-&gt;b , fp-&gt;c ) 的 时候，就有不确定的参数传入到dosomething，极有可能造成不期望的结果，甚至程序崩溃。可以通过优化屏障来解决该问题，RCU机制对优化屏障做了包装，提供了专用的API来解决该问题。这时候，第十行不再是直接的指针赋值，而应该改为 :</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">rcu_assign_pointer(gbl_foo,new_fp);</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">rcu_assign_pointer的实现比较简单，如下：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(184, 92, 0) !important;">#define rcu_assign_pointer(p, v) \&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">__rcu_assign_pointer</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">((</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">),</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">v</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">),</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">__rcu</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(184, 92, 0) !important;">#define __rcu_assign_pointer(p, v, space) \&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">do</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">smp_wmb</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">typeof</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">v</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">__force space *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">v</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">while</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 153, 153) !important;">0</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span></span></p></blockquote><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">我们可以看到它的实现只是在赋值之前加了优化屏障 smp_wmb来确保代码的执行顺序。另外就是宏中用到的__rcu，只是作为编译过程的检测条件来使用的。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">在DEC Alpha CPU机器上还有一种更强悍的优化，如下所示：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo_read</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_read_lock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">foo *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">gbl_foo</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">if</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> != </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">NULL</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">dosomething</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">a</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important;">b</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">fp</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">-&gt;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">c</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_read_unlock</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span></p></blockquote><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">第六行的&nbsp;fp-&gt;a,fp-&gt;b,fp-&gt;c会在第3行还没执行的时候就预先判断运行，当他和foo_update同时运行的时候，可能导致传入dosomething的一部分属于旧的gbl_foo，而另外的属于新的。这样导致运行结果的错误。为了避免该类问题，RCU还是提供了宏来解决该问题：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(46, 46, 46); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(46, 46, 46); box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(184, 92, 0) !important;">#define rcu_dereference(p) rcu_dereference_check(p, 0)&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p></blockquote><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(184, 92, 0) !important;">#define rcu_dereference_check(p, c) \&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">__rcu_dereference_check</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">((</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">),</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_read_lock_held</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">()</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> || </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">c</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">),</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">__rcu</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(184, 92, 0) !important;">#define __rcu_dereference_check(p, c, space) \&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">({</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">typeof</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">_________p1</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">typeof</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">_</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">_</span>force<span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">ACCESS_ONCE</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_lockdep_assert</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">c</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(221, 17, 68) !important;">"suspicious rcu_dereference_check()"</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(221, 17, 68) !important;">" usage"</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_dereference_sparse</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">,</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">space</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">smp_read_barrier_depends</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">((</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">typeof</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">*</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">__force __kernel *</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">_________p1</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">));</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">})</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(128, 0, 128) !important;">static</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">inline </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">int</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_read_lock_held</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important; color: rgb(128, 0, 128) !important;">void</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">{</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">if</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">!</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">debug_lockdep_rcu_enabled</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">())</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">return</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 153, 153) !important;">1</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">if</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_is_cpu_idle</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">())</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">return</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 153, 153) !important;">0</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">if</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">!</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">rcu_lockdep_current_cpu_online</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">())</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">return</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 153, 153) !important;">0</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: bold !important;">return</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">lock_is_held</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&amp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">rcu_lock_map</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">}</span></p></blockquote><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(46, 46, 46); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">这段代码中加入了调试信息，去除调试信息，可以是以下的形式（其实这也是旧版本中的代码）：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><blockquote style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(184, 92, 0) !important;">#define rcu_dereference(p)&nbsp;&nbsp;&nbsp;&nbsp; ({ \&nbsp;&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">typeof</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">)</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">_________p1</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> = </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">p</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: teal !important;">smp_read_barrier_depends</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">();</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">(</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 45, 122) !important;">_________p1</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">);</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;"> </span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">\</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;</span></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;"><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(0, 111, 224) !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="" style="max-width: 100%; border-width: 0px; border-style: initial; border-color: initial; font-family: inherit; height: inherit; box-sizing: border-box !important; word-wrap: break-word !important; font-size: inherit !important; line-height: inherit !important; font-weight: inherit !important; color: rgb(51, 51, 51) !important;">})</span></span></p></blockquote><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(46, 46, 46); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">在赋值后加入优化屏障smp_read_barrier_depends()。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">我们之前的第四行代码改为&nbsp;foo *fp = rcu_dereference(gbl_foo);，就可以防止上述问题。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><h4 style="max-width: 100%; color: rgb(62, 62, 62); line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(123, 12, 0); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">数据读取的完整性</strong></span></h4><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">还是通过例子来说明这个问题：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img class="" data-ratio="0.5386064030131826" src="data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAAhMAAAEeCAAAAAAVvsi7AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAUxklEQVR42u2dT4grR37Hi2SzK2f/WNgxKN6HLeInVlm8XmV3Y4tN57njheyAYVcCHwRLsNg+ROCDtSDYOcT0wTRDToKgIOKLDjoolyD6EIaQQx/eQRAadBx00k066qBDHyvV/1s1pVaNpiX1e+/7wZ6nLnV1/br0UXV1dauLNGpqtjx5Q5hcXNO99MsZx1D5C2Fyabo/hmkp4xg+KgqTy/39MayLDypBgtd+LkqtNWgaRLVotugfC5PLy5QsesYxjN4XJrdHKVnaGcewfP3B+7osZxwDfeu5KNVSUzPBiTALnAiBE2EWOBECJ8IscCIEToRZ4EQInAizwIkQOBFmgRMhcCLMAidC4ESYBU6EwIkwC5wIubQTc4de3Im1G9qlnZjRyzth+f8c48Q29d19TvyfNdWv/fF2Xb+xNn5yrUXP6MQ3lqXrV14MXV2/XfrJ3ZpzTicsq6+3vBg6uj6585OnxbtzOjG3RnrHi6Gl68OZn7wmU+/fdCe2RtOipjJIWrDVjNQwRE7cDdvfekttMBU8dCZHsXzVX9IZITfyTowtufWETqwn3Tf+zPXx1ouhz+QoF9XrOXWKpCHrxFgZD7SFVAwiJ5xbvUxcHydeDENdb1WJ2r2ltE7KG1knFpoxMAZSq4qcsG4+/FZNbetDL4aJrnfqpNaebGiXFObuCgfaCVthfxR7J814oBPLfrXaGT1Z8sm33XL1PUKYnLJONDW59e47sRldlVr934z4ZOumVvqQxXAt205UWJ1UpNa878S0XbzSP7+3r1b/qvBrFoPqyDmxUthXdGXIrHrfiXmnpF7/q8KvNx+1is9eI6TsXr2WdGJlMi/HpkmpaUq3E7MSaTlTtdx120dhf+I5qwomp6QTC1Pu00g6Ma+R+nreKrXZd1Hcn1j/pRvERN4JWlnJrBk74bRIabbsFhsjZ0+b6PzCjaEj54TW8ypDKtzICadbKEw2/XJtuN7Xn/jCjaHuHHaiYhhGxaY9OtDGBqsR5kZP0olliZXx541g+0Inum4YpPylTmUwqCb37YidcNwYXvtg4nhLQiemXgyFf5F0wjCacs127IS7l3/6dn/jV49oX9cFL4ivpJxQJCvBJXLixt3+m92ltyB2ourF0JJtJ+ymwQ5gi3GFNuWPHSOvjDBZ5AQ7kjMjVLWuUxl6bgBSRE4svRiCPpTYiSu2QklVP5JuJ6yHthPuXrrdJr96RPvqWlNg9fCOzIaPckJ1Y/hVsCB0wvtu1FX1VtYJdiDfmm47UVlIO2F5bUCY/PjxCbenq1gyaybaCe8LGPTtsxifcKWU+1BiJ7wv4K3EvkoeO7xe1VZm1diJDvF6TT6PG5/wnGDHjsrANo3BqrLqabTXS91i3J9oMPnDjyMDJ9xix02pqoj7E31WFd1wIRsn7Ie2E7dMzCuZfZU871BYt86WiiF2YlkOOpAuj3JiOzbYuagx3rLTH7ow7AFrJTRjnLrFxHnHrB8p8XgnTIN1q9x4JEicd9z159Hrxzthsu7VQO7jSJx3rEdTqX2VHZ8YaAO5LmbivMOZsLPNgJyPY/pZ9IxjwNh2wAs5tu1n0TOOAU4EwIkIOBEAJyLgRACciIATAXAiAk4EwIkIOBEAJyLgRACciIATAXAiAk4EwIkIOBEAJyLgRACciIATAUc60dazRS0Lk4vL/UHoasYxNJ4Ik2uj/TGMahnH0P2+uHrSnChmHIP+3d+LUtsHnLCyDuPLL4XJ/ZQgllnH8Md/Fqdv9sewyToG/ffi5JTvBu2fKQYr3QkKwC5wAvDACcADJwAPnAA8cALwwAnAAycAD5wAPHAC8MAJwAMnAA+cADxwAvDACcADJwAPnAA8cALwwAnAAycAD5wAPHAC8MAJwAMnAA+cADxwAvDACcADJwAPnAA8cALwwAnAAycAD5wAPHAC8MAJwAMnAA+cADyEBvPKZ8dPPxQmpz1/cpJ1DPUPhMlX6/0x3GUdw7OfiNOt/TE4jayDeF+c3E93ouzPp54dn3wqTE5rkdrXGcdw/VSYXEv5PEZXGccw+YEwua3vj2FZyjgGiwhT+6kPyCSpD7g9ipZ4pvlUJ0YZx7DnQbpp39GX80G64lq34EQEnPCBEzFwwgdOxMAJHzgRAyd84EQMnPCBEzFwwgdOxMAJHzgRAyd8cu6E4/65sBNeDJd2wg3i0k44QZ5zOnEXDq7eRcmNKT2vE+swhlmU3L+h53XCiUaZnTB5fkXP7MQsjCG6CLSpbvw8qU5sx4ZFTcPcJtJWTTs1DKETjkXUMqmG12CqpKTqI1byulCYyzthrySrQuzE7KlSYwWH18lIQe32Wem0RKaSTrD6MAeWXAxiJ+5+W1NZwSEForZvXDsbpCvvxKA3ME2pNYVOrL96ohZJPYyhRGoN/ZbZ2SeqQw+3E7bC/ii7EigPdWLZrxdUYu0UtLb0drl2/TtCymtpJ7Se3HoCJzajRqH+5Ot5Ms2x+t1auXNNCBNTrp1w60MyCoET03apWvuttZNmja7rxdaQEDKUdcL9AExDatX7Tsw75dInT63NTtpUvyo0hm8R0qEPcGKxYAuuDIuFtBPrbntKnaFa7s7Exs6//hNWF3VH0omVUZFaL+mEc9MYOnTaKrWnjrA/sRy+QVwx5Z2w5aJIODFq3KzprFNsjNbC/sRm8iMWQ8GSc8LwKtiSWTVR61a7O6dLvVwbLsX9iemvWQykL+OEbbP/aY9qhmGaTToebyuSTjgqK+NX5Y7FRZeg74ZBWpJODGhzLLViwok62/5Pqo2Jd+AW9jHnXgz1bySdsG3JIGInpmz7P3xWH27cBWEf0ym4MRSfSzmhyDURHlGt37Ltf7tZ9qctFPcxa15F3Mo6YSs9TTO3A4Uq8seOkVvE98IejNCJEvE/kJHUDhrUVOSqInJi5m3/v4MloRMNP4aPpJ148LHD+8C/DhaETvjfDfLeuzIbPsqJK3f7/xgsCJ3wvxukeCd57LDdajANS1lV5J3wdrR0L7oEa927+eSrH41k9m9sLezKQqoqIif8HQ1Pc4RO3EzdIObyxw4qFwTnxCRYEDoxHHlnAHLHjqZsr4ryTnSCBaETt30vho1sf2LFjhdmc8uW2AtZJ5ZlFsboXnS73Omsyfr5iErgVoWhyayZOHa4x696tGClZDldf6LrfjfCs87Hj1ktFHb6tbVlVo1rfcLEjOaCftSY1dZosnNRxdiOlSbtaWZzZSk9Jf14GvcxNy11eD+6JMOq9z3+bCSxe2ONfT0NReocLHHeca12N+HrRzvB6qPX0+TaqkQfc6i2ohGZDMYxF01tINmximt9pl5FIzK5Hsf0mhJSx9h2WB0Zx/BCjm0vnzAnbuBEkAVOMDZ/80NClnAiyAInqHu5Y1muX/oamJ8FTkR5LuqEW0HLCZwIs8AJOm34/8KJIAucuKsFJ+1wIsjyyjvhVMOi4USQ5ZV3ohMNaMGJIMur7kQiMDgRZHnFnYiPHHAiyvKKO3F9E7+GE0GWV9uJWT2xACeCLHlx4iLPJHFqd4klPJMkcCInzyTpZP64nJ8Jkxs75fa7yaVh1jH87V+L05f7a2KWdQx//1ScPt0fw+Yq6yDK4uQULy/2jDOnvH78RsBpuJATu80EyBWXcQLNRJ65jBNoJvLMRZxAM5FrLuLEsPP4bYCTcREn6rPHbwOcjEs4kf1oHciSSziRNroLLs8lnMj8CgvIlAs4sXP1C+SPCzgR314Fcsn5nXBKm0vvNEjl/E6kX7sHl+f8TuCsI++c34m0e51AHji7E07RefxGwCk5uxPoTuSeszuB7kTuObsT6E7knrM7UcKtE3nn3E44hUvvMTjEuZ24q156j8Ehzu3EtPH4bYDTInLi7oG/NTrIf8Uvv/gsfn334GjBORA5Ua4/6KdGh3nz7ejlk8SPo9C1yCdCJ5YZF5L4VbE3rU9K2eDynNuJauKAASfyybmdSG4bTuQTOAF44ATggROA59xOFBJ3T8CJfHJuJ5LlwYl8AicAz7mdKG7SywaXB31MwHNuJ5K3WcGJfPJwJ1a9Jvs7HjygkIQTrUmcDCfyyRHthF3RgqnLZUk48bs/pJcNLs8xTljK2HXCHGuLXnOlaVvzQKMRO9EmJH70OpzIJ8c4YS8qtm2vNHvQpAq1mvTQ/KeRE+5k7uQqrWxweY5ygpoV07Z7TA7aXAwUemhO9ciJa9eJ6MlFcCKfHOcEHbCWgnU1F9TSxoPeob5F5MQE7cQLwBFOmO6M4ZpNFc2wKDt4uP+lE/cnOqyZmKeVDS7Pke0EpVt2Pmq5S25rcYDEecedlV42uDznHrM6VDa4PHAC8MAJwAMnAA+cADxwAvDACcADJwAPnAA8cALwwAnAAycAD5wAPOd+Tk0SPKcmn5z7eVZJ8DyrfIL2G/DACcADJwAPnAA8cALwwAnAAycAD5wAPHAC8MAJwAMnAA+cADxwAvDACcADJwAPnAA8cALwwAnAAycAD5wAPGSU8T3a6ke/ECa3nf1BzLOO4ZfiO8+vlvtjWF5lHMOzvxOnz/fH4LQzr4hnwuRRuhNqP+ObtNs1YXIp5fPQ2xnHcP1UmHyVUhejq4xjmPxAXD16ipeljGOwiv8mSu2rB5ywjmpfUj7gj4XJaT8k0lPq6ShG7wuT26OULO2MY1i+/uB9XZZpxrz1XJRqwYkIOOEDJ2LghA+ciIETPnAiBk74wIkYOOEDJ2LghA+ciIETPnAiBk74wImYPU54o+6XdsINAk4ksugZx5DmxMYf393EyRO3+LM64fgxrBNrux/TeZ2YeTEkHgzj1P1KOeCEba/owt6dtGVspoZxQie2slUhdmLzyadqjRT9y0BFQuot3ftYamQq6wSrC1YjUuxx4vOPVZUU/BhKhFQb+tStmS7pyjuxMMzDE+l4iJ3496cNtv/+dcIqISVVH82pOzOX6jWZB5ww3XmdKrvzfRnpU8Kd0Ime7ES3AidmnWrxnc+seTJpoqul+s1/ElKYSzqxrWxXPU1mTZETS71Oyh9bViLpbqo3ytXu/xYIGco6oQ0Ofggh951YD9XCj59Mk+3k2tLbtVJ7+gEhHXf5UDvhOqEc6YTT12+j5Cyc0A7OPBaQcGKqj1jNX5frwzthf2J2/X13LsO15LGj4v4v1VIknJjr/Q1d92tlfSbc17v+uyyGgiXnxNidB5qaMqsmnFje6EvqjBqljuWI+hPr0TN3Ar8hlXbCsJrmSrMUd3K4pqQTTp2V0Q+TM3BivFIsqRUTTnRYDJ82qjde6cI+5tqtClL/RtoJU87M2IkZawTe+6dyd753X52SG0PxuZQTilwT4RE5MWfHyu98UW5P3QVxH7NBPDEPO1ExDKNiL5pGr2ma2wrVFtLthDfBbDFMzsAJI/iKHCZywv/A/yNYEjrR9VYh/yDphGE0e1Jrxk5U3e1rTsq+Tv0Yfnw6J7wPvBZ0aoVOrAteDMWlZDthe9VgmBV33khZJ7zJRKNnYO53wpkoOpXAMsyxXLMdO7H09jPcRaETQ13Xby3rjw84dhyad9kv+vXwVZEkGkyhExMWw9SyJu/KbPh4JxphTYqcmLEYRt6JiJwTC8X7SFiNKKa0E2u3Llph8h4nnEmrQOSccL3U5OojPna4x69SeNtfBmNWrhPKA51wj1+F8Lzz8WNW/rHr0Dy/PpET3hd0Giw8bnxioCzY8WPAenfuJNQDxbQUo5negMd9zNmH3+5swgWhE7ctr8HSdHoYU9t68x/LVEXsxLJVbESn4I93wmLHDu2hxw6nW65ZUfWk7Kvkece4ObYkz8DiPuawWu1He5HNmFXcZq8OjBIkzkWT9Sx0Yu41q2WMbQdZZMes5BoJmsdxzINO0PnrzIlrOBFkeQXGtoedOHlPf+KX3yVkBieCLK+AE91+nCx24vpmXixf+hqYnwVOhJzUiat4GFPsxISdlsxv4ESY5RVwopS48CdyYl73zxLhRJDl5XfCSU7aInBiXQ/S4ESQ5eV3Yl5LJAuciIqGE0GWl9+JnWq+78TNdZRFzzgGOBGQOyca00TyPSeW1eiX5nAiyPLyO1HcJJLvOZEoGE4EWV56J3a6E/ecSI5nwYkgy0vvxO7ec06sy4lnlMCJIMtL78TuljknksNZcCLMkhMn2uQ87HQu6LSRXBplXlpBnGztrwgr8xheFyeP9sewKZ6pHtL9P90zzq5vUt6szU9WLngsp3MiObDNs9tMgHxxMidur1LeRDORZ07mxM6AFQeaiVxzKid2Byc40EzkmlM5gWbixeVETqQ2E63JpfcapHEiJ9KaiU3Jkd4OuACncWJWT3kzeaUD5JCTOOHU7lLezXw0HWTLSZxIvX6R/aA+yJZTOBHeeism8wteIGNO4UR9lvZu9U52O+AynMCJ1ItfOHTkn+ydODAilfl9CiBrMncivTORfl8LyAVZOxH9jmcf5aXMZsAFydiJTdoUaC7oTuSf7JxYtySUQHfiBSA7J7qkf1gJdCdeADJzYl0g35G4LwK3TuSfzJzoEkLeXB9cbff2bZBHsnLCf+KmenC10qV3GBwkKyeuvd8NFA/dLZN6ER3kA4ET6yPmQP6fN75X+/zryZ4345dffRK/xnWPnCJwolaXmByd4+NnKW+++Xb08q/eiZMLD48WnAOBE5mPNLbiCS+Sp6Kn+7kReBRndiJ5jxWcyClwAvDACcBzZieS24YTOQVOAB44AXjgBOCBE4AHTgCeMzuRvH0CTuSUMzuRfAQinMgpD3Zi1XOnDRzLzhzugusdLxYPbyfsCvuIbemZ6+iOE8nfiMGJnHKEE5Yydp0wx9qi11xp2tY80GjEToxeI7Vo63AipxzhhL2o2La90uxBkyrUatJD0/JGTsx37s+DEznlGCeoWTFtu8fkoO7sxPTQfNGRE7p3g15K0SAPHOWEO0W0zbqaC2pp40HvUN8icmLqKhE9/QxO5JSHO2Ga7I9mU0UzLMoOHlQ5VEbcn2gTUoweTgEncspx7QSlW3Y+alFv5uzFoTIS5x1zK/7VOZzIKWceszpQNMgDcALwwAnAAycAD5wAPHAC8MAJwAMnAA+cADxwAvDACcADJwAPnAA8Iie6era8/zNhMpzIKf8P4BOVdBdP12sAAAAASUVORK5CYII= " src="9aPYe0E1fb2zicmibmGHVgv00XPuQicciba2kNm1E9J21o0ffglt6SU1EZyhH2br0qWOnjF9GxEwvm9uvXBMvUC2Eg"  data-type="png" data-w="531" style="margin: auto; border-width: 0px; border-style: initial; border-color: initial; font-size: 0px; color: transparent; vertical-align: middle; text-align: center; display: block; clear: both; box-sizing: border-box !important; word-wrap: break-word !important; width: auto !important; visibility: visible !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">如图我们在原list中加入一个节点new到A之前，所要做的第一步是将new的指针指向A节点，第二步才是将Head的指针指向new。这样做的目的是当插入操作完成第一步的时候，对于链表的读取并不产生影响，而执行完第二步的时候，读线程如果读到new节点，也可以继续遍历链表。如果把这个过程反过来，第一步head指向new，而这时一个线程读到new，由于new的指针指向的是Null，这样将导致读线程无法读取到A，B等后续节点。从以上过程中，可以看出RCU并不保证读线程读取到new节点。如果该节点对程序产生影响，那么就需要外部调用做相应的调整。如在文件系统中，通过RCU定位后，如果查找不到相应节点，就会进行其它形式的查找，相关内容等分析到文件系统的时候再进行叙述。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">我们再看一下删除一个节点的例子：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img class="" data-ratio="0.2806026365348399" src="data:image/PNG;base64,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 " src="9aPYe0E1fb2zicmibmGHVgv00XPuQicciba2o06Ndic2yad6MvYyf4sywZJBRJQ4Rria5c68FqryMY5iaibEXSRxHGP8MQ"  data-type="png" data-w="531" style="margin: auto; border-width: 0px; border-style: initial; border-color: initial; font-size: 0px; color: transparent; vertical-align: middle; text-align: center; display: block; clear: both; box-sizing: border-box !important; word-wrap: break-word !important; width: auto !important; visibility: visible !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">如图我们希望删除B，这时候要做的就是将A的指针指向C，保持B的指针，然后删除程序将进入宽限期检测。由于B的内容并没有变更，读到B的线程仍然可以继续读取B的后续节点。B不能立即销毁，它必须等待宽限期结束后，才能进行相应销毁操作。由于A的节点已经指向了C，当宽限期开始之后所有的后续读操作通过A找到的是C，而B已经隐藏了，后续的读线程都不会读到它。这样就确保宽限期过后，删除B并不对系统造成影响。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><h4 style="max-width: 100%; color: rgb(62, 62, 62); line-height: 25.6px; white-space: normal; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(123, 12, 0); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">小结</strong></span></h4><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"  /></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; widows: 1; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">RCU的原理并不复杂，应用也很简单。但代码的实现确并不是那么容易，难点都集中在了宽限期的检测上，后续分析源代码的时候，我们可以看到一些极富技巧的实现方式。</p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name">Linux爱好者</div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p class="reward_button_wrp">
                    
                      <span class="reward_pop_panel">
                        <img src="https://res.wx.qq.com/mpres/zh_CN/htmledition/pages/home/index/pic_mp_app4290ba.png" alt="">
                        <strong>扫一扫下载订阅号助手，用手机发文章</strong>
                      </span>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='http://i.ijrou.com' target='_blank'>
			我的博客
		</a>
	</div>
</body>