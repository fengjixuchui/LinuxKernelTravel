<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		Linux可信计算机制模块详细分析之函数实现机制（1）字符设备驱动
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664603577&amp;idx=1&amp;sn=d0307f7193f4b67f3ce2f591d34efc97&amp;chksm=f04db25cc73a3b4a179e74bbedc8db9b4351aee22940d7fad6b596df729681b5f31d446b1321&amp;scene=27#wechat_redirect&cpage=52' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">Linux可信计算机制模块详细分析之函数实现机制（1）字符设备驱动</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                                                        <span class="rich_media_meta rich_media_meta_text">
                                                        程香鹏
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2016-12-20</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <h2><span style="font-size: 16px; color: rgb(2, 30, 170);"><strong><span style="font-size: 16px; font-family: 宋体;">2.3 函数实现机制</span></strong></span></h2><p><span style="color: rgb(2, 30, 170);"><strong><span style="color: rgb(2, 30, 170); font-family: 宋体; font-size: 16px;">2.3.1 Linux 字符设备驱动</span></strong></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">在</span>linux 3.5.4<span style="font-family:宋体">中，用结构体</span><span style="font-family:Times New Roman">cdev </span><span style="font-family:宋体">描述字符设备，</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">结构体在文件</span></span><span style=";font-size:14px">include/linux/cdev.h<span style="font-family:宋体">中定义</span></span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">，如下所示：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">struct cdev {</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct kobject kobj;</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct module *owner;</span></p><p style="text-indent:28px"><span style=";font-size:14px">const struct file_operations *ops;</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct list_head list;</span></p><p style="text-indent:28px"><span style=";font-size:14px">dev_t dev;</span></p><p style="text-indent:28px"><span style=";font-size:14px">unsigned int count;</span></p><p style="text-indent:28px"><span style=";font-size:14px">};</span></p><table width="568"><tbody><tr><td width="158" valign="top" style="padding: 0px 7px; border-width: 1px; border-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">类型</span></p></td><td width="85" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">字段</span></p></td><td width="325" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">说明</span></p></td></tr><tr><td width="158" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">struct kobject</span></p></td><td width="85" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">kobj</span></p></td><td width="325" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">设备在底层的统一接口，是设备模型的核心结构，每个<span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">结构体都有一个</span><span style="font-family:Times New Roman">kobject</span><span style="font-family:宋体">，每个在内核中注册的</span><span style="font-family:Times New Roman">kobject</span><span style="font-family:宋体">对象都对应于</span><span style="font-family:Times New Roman">sysfs</span><span style="font-family:宋体">文件中的一个目录</span></span></p></td></tr><tr><td width="158" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">struct module *</span></p></td><td width="85" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">owner</span></p></td><td width="325" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">指向实现驱动的模块</span></p></td></tr><tr><td width="158" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">struct file_operations *</span></p></td><td width="85" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">ops</span></p></td><td width="325" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">操作设备文件的方法，实现与具体硬件通信的操作，也是字符设备驱动程序的主体部分</span></p></td></tr><tr><td width="158" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">struct list_head</span></p></td><td width="85" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">list</span></p></td><td width="325" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">实现一个双向链表，其中包含表示该设备的设备文件的<span style="font-family:Times New Roman">inode</span></span></p></td></tr><tr><td width="158" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">dev_t</span></p></td><td width="85" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">dev</span></p></td><td width="325" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">表示设备号，一个设备号由主设备号和次设备号组成</span></p></td></tr><tr><td width="158" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">unsigned int</span></p></td><td width="85" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">count</span></p></td><td width="325" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">表示与该设备关联的次设备号的数目</span></p></td></tr></tbody></table><p style="text-align:center"><a name="_Ref344374144"></a><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">表</span> </span><span style=";font-size:14px">2</span><span style=";font-size:14px"></span><span style=";font-size:14px">1</span><span style=";font-family:宋体;font-size:14px">&nbsp;<span style="font-family:宋体">结构体</span>cdev <span style="font-family:宋体">各字段说明</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">flle_operations<span style="font-family:宋体">结构体中定义了操作设备文件的方法，都是一些函数指针，其在</span><span style="font-family:Times New Roman">/include/linux/fs.h</span><span style="font-family:宋体">文件中定义如下：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">struct file_operations {</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct module *owner;</span></p><p style="text-indent:28px"><span style=";font-size:14px">loff_t (*llseek) (struct file *, loff_t, int);</span></p><p style="text-indent:28px"><span style=";font-size:14px">ssize_t (*read) (struct file *, char __user *, size_t, loff_t *);</span></p><p style="text-indent:28px"><span style=";font-size:14px">ssize_t (*write) (struct file *, const char __user *, size_t, loff_t *);</span></p><p style="text-indent:28px"><span style=";font-size:14px">ssize_t (*aio_read) (struct kiocb *, const struct iovec *, unsigned long, loff_t);</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;. . . . . . .</span></p><p style="text-indent:28px"><span style=";font-size:14px">ssize_t (*aio_write) (struct kiocb *, const struct iovec *, unsigned long, loff_t);</span></p><p style="text-indent:28px"><span style=";font-size:14px">int (*readdir) (struct file *, void *, filldir_t);</span></p><p style="text-indent:28px"><span style=";font-size:14px">long (*compat_ioctl) (struct file *, unsigned int, unsigned long);</span></p><p style="text-indent:28px"><span style=";font-size:14px">int (*mmap) (struct file *, struct vm_area_struct *);</span></p><p style="text-indent:28px"><span style=";font-size:14px">int (*open) (struct inode *, struct file *);</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=";font-size:14px">int (*release) (struct inode *, struct file *);</span></p><p style="text-indent:28px"><span style=";font-size:14px">int (*fsync) (struct file *, loff_t, loff_t, int datasync);</span></p><p style="text-indent:28px"><span style=";font-size:14px">int (*fasync) (int, struct file *, int);</span></p><p style="text-indent:28px"><span style=";font-size:14px">int (*lock) (struct file *, int, struct file_lock *);</span></p><p style="text-indent:28px"><span style=";font-size:14px">int (*check_flags)(int);</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;. . . . . . . .</span></p><p style="text-indent:28px"><span style=";font-size:14px">};</span></p><table width="568"><tbody><tr><td width="187" valign="top" style="padding: 0px 7px; border-width: 1px; border-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">字段名</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">说明</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">owner</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">指向拥有该结构体的驱动模块指针</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">llseek</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">用于修改文件读写位置</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">read</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">从字符设备中读取数据</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">write</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">向字符设备发送数据</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">aio_read</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">初始化一个异步的读取操作</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">aio_write</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">初始化一个异步的写入操作</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">readdir</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">用于读取目录，对于字符设备文件，该字段为<span style="font-family:Times New Roman">NULL</span></span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">unlocked_ioctl</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">执行设备<span style="font-family:Times New Roman">I/O</span><span style="font-family:宋体">控制命令</span></span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">mmap</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">用于将设备内存映射到进程地址空间</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">open</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">打开操作</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">release</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">关闭操作</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">synch</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">刷新待处理的数据</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">lock</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">文件锁操作</span></p></td></tr><tr><td width="187" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">check_flags</span></p></td><td width="381" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px;text-align:justify;text-justify:inter-ideograph"><span style=";font-family:宋体;font-size:14px">标志位检查</span></p></td></tr></tbody></table><p style="text-indent:28px;text-align:center"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">表</span>2-2 file_operations<span style="font-family:宋体">结构体字段说明</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">内核中所有已分配的字符设备编号都记录在一个名为</span></span><span style=";font-size:14px">&nbsp;chrdevs </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">散列表里。该散列表中的每一个元素是一个</span></span><span style=";font-size:14px">&nbsp;char_device_struct </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">结构，内核并不是为每一个字符设备编号定义一个</span></span><span style=";font-size:14px">&nbsp;char_device_struct </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">结构，而是为一组对应同一个字符设备驱动的设备编号范围定义一个</span></span><span style=";font-size:14px">&nbsp;char_device_struct </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">结构。</span></span><span style=";font-size:14px">chrdevs </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">散列表的大小是</span></span><span style=";font-size:14px">&nbsp;255</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">。</span>char_device_struct<span style="font-family:宋体">结构在文件</span><span style="font-family:Times New Roman">/fs/char_dev.c</span><span style="font-family:宋体">中定义，如下所示：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">static struct char_device_struct {</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct char_device_struct *next;</span></p><p style="text-indent:28px"><span style=";font-size:14px">unsigned int major;</span></p><p style="text-indent:28px"><span style=";font-size:14px">unsigned int baseminor;</span></p><p style="text-indent:28px"><span style=";font-size:14px">int minorct;</span><span style=";font-family:宋体;font-size:14px">&nbsp;</span></p><p style="text-indent:28px"><span style=";font-size:14px">char name[64];</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct cdev *cdev;</span><span style=";font-size:14px">/* will die */</span></p><p style="text-indent:28px"><span style=";font-size:14px">} *chrdevs[CHRDEV_MAJOR_HASH_SIZE];</span></p><table width="534"><tbody><tr style="height:10px"><td width="178" valign="top" style="padding: 0px 7px; border-width: 1px; border-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">类型</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">字段</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">说明</span></p></td></tr><tr style="height:10px"><td width="178" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">struct char_device_struct*</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">next</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">指向散列链表中的下一个元素的指针</span></p></td></tr><tr style="height:10px"><td width="178" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">unsigned int</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">major</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">主设备号</span></p></td></tr><tr style="height:10px"><td width="178" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">usigned int</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">baseminor</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">次设备号范围中的起始设备号</span></p></td></tr><tr style="height:21px"><td width="178" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">int</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">minorct</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">次设备号范围</span></p></td></tr><tr style="height:42px"><td width="178" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">char</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">name[64]</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">与设备编号关联的设备驱动名称</span></p></td></tr><tr style="height:65px"><td width="178" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">struct cdev*</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">cdev</span></p></td><td width="178" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style=";font-family:宋体;font-size:14px">指向字符设备描述结构体的指针，在未来内核版本中会删除此字段</span></p></td></tr></tbody></table><p style="text-indent:28px;text-align:center"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">表</span>2-3 char_device_struct<span style="font-family:宋体">结构个字段说明</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">用于操作</span>cdev<span style="font-family:宋体">结构体的函数的具体实现在文件</span><span style="font-family:Times New Roman">/fs/char_dev.c</span><span style="font-family:宋体">中，</span><span style="font-family:Times New Roman">cdev_init()</span><span style="font-family:宋体">函数用于初始化</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">成员，并建立</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">和</span><span style="font-family:Times New Roman">file_operations</span><span style="font-family:宋体">之间的连接实现，代码如下：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">void cdev_init(struct cdev *cdev, const struct file_operations *fops)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">memset(cdev, 0, sizeof *cdev);</span></p><p style="text-indent:28px"><span style=";font-size:14px">INIT_LIST_HEAD(&amp;cdev-&gt;list);</span></p><p style="text-indent:28px"><span style=";font-size:14px">kobject_init(&amp;cdev-&gt;kobj, &amp;ktype_cdev_default);</span></p><p style="text-indent:28px"><span style=";font-size:14px">cdev-&gt;ops = fops;</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">cdev_init()<span style="font-family:宋体">函数执行流程如下：</span></span></p><p style="margin-left:76px"><span style=";font-size:14px">（1）&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">调用</span>memset()<span style="font-family:宋体">函数初始化</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">结构体实例。</span></span></p><p style="margin-left:76px"><span style=";font-size:14px">（2）&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">初始化</span>cdev<span style="font-family:宋体">结构体实例链表。</span></span></p><p style="margin-left:76px"><span style=";font-size:14px">（3）&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">初始化</span>kobject<span style="font-family:宋体">结构体。</span></span></p><p style="margin-left:76px"><span style=";font-size:14px">（4）&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">将</span>cdev<span style="font-family:宋体">结构体实例与对应</span><span style="font-family:Times New Roman">file_operations</span><span style="font-family:宋体">结构体对应。</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">cdev_alloc()<span style="font-family:宋体">函数用于动态申请一个</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">内存，具体代码在文件</span></span><span style=";font-size:14px">fs/char_dev.c</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">中，代码如下：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">struct cdev *cdev_alloc(void)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct cdev *p = kzalloc(sizeof(struct cdev), GFP_KERNEL);</span></p><p style="text-indent:28px"><span style=";font-size:14px">if (p) {</span></p><p style="text-indent:28px"><span style=";font-size:14px">INIT_LIST_HEAD(&amp;p-&gt;list);</span></p><p style="text-indent:28px"><span style=";font-size:14px">kobject_init(&amp;p-&gt;kobj, &amp;ktype_cdev_dynamic);</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-size:14px">return p;</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">cdev_alloc()<span style="font-family:宋体">函数执行流程如下：</span></span></p><p style="margin-left:52px"><span style=";font-size:14px">(1)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">调用</span>kzalloc()<span style="font-family:宋体">给</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">结构体分配空间。</span></span></p><p style="margin-left:52px"><span style=";font-size:14px">(2)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">如果分配空间成功，初始化</span>cdev<span style="font-family:宋体">结构体实例链表并初始化</span><span style="font-family:Times New Roman">kobject</span><span style="font-family:宋体">结构体。</span></span></p><p style="margin-left:52px"><span style=";font-size:14px">(3)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">返回</span>cdev<span style="font-family:宋体">结构体指针</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">cdev_add()<span style="font-family:宋体">函数用于向系统添加一个</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">对象，完成字符设备的注册，对</span><span style="font-family:Times New Roman">cdev_add()</span><span style="font-family:宋体">的调用通常发生在字符设备驱动模块加载函数中。在调用</span><span style="font-family:Times New Roman">cdev_add()</span><span style="font-family:宋体">函数前，要首先调用</span><span style="font-family:Times New Roman">register_chrdev_region()</span><span style="font-family:宋体">或者</span><span style="font-family:Times New Roman">alloc_chrdev_region()</span><span style="font-family:宋体">函数向系统申请设备号。具体代码在文件</span></span><span style=";font-size:14px">fs/char_dev.c</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">中，代码如下：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">int cdev_add(struct cdev *p, dev_t dev, unsigned count)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">p-&gt;dev = dev;</span></p><p style="text-indent:28px"><span style=";font-size:14px">p-&gt;count = count;</span></p><p style="text-indent:28px"><span style=";font-size:14px">return kobj_map(cdev_map, dev, count, NULL, exact_match, exact_lock, p);</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">cdev_add<span style="font-family:宋体">执行流程如下：</span></span></p><p style="margin-left:56px"><span style=";font-size:14px">(1)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">初始化</span>cdev<span style="font-family:宋体">结构体中的</span><span style="font-family:Times New Roman">dev</span><span style="font-family:宋体">、</span><span style="font-family:Times New Roman">count</span><span style="font-family:宋体">字段，</span><span style="font-family:Times New Roman">dev</span><span style="font-family:宋体">是设备号，</span><span style="font-family:Times New Roman">count</span><span style="font-family:宋体">是设备号范围，及与该设备驱动相关的次设备号范围。</span></span></p><p style="margin-left:56px"><span style=";font-size:14px">(2)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">调用</span>kobj_map()<span style="font-family:宋体">函数，返回结果。</span><span style="font-family:Times New Roman">kobj_map()</span><span style="font-family:宋体">用于</span></span><span style=";font-size:14px"><span style="font-family:宋体">用来把字符设备编号和</span>cdev <span style="font-family:宋体">结构变量一起保存到 </span><span style="font-family:Times New Roman">cdev_map </span><span style="font-family:宋体">这个散列表里。当后续要打开一个字符设备文件时，通过调用 </span><span style="font-family:Times New Roman">kobj_lookup() </span><span style="font-family:宋体">函数，根据设备编号就可以找到 </span><span style="font-family:Times New Roman">cdev </span><span style="font-family:宋体">结构变量，从而取出其中的 </span><span style="font-family:Times New Roman">ops </span><span style="font-family:宋体">字段</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">cdev_del()<span style="font-family:宋体">函数用于删除一个</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">对象，完成字符设备的销毁，通常在字符设备驱动模块卸载函数中调用，在调用</span><span style="font-family:Times New Roman">cdev_del()</span><span style="font-family:宋体">函数前，要调用</span><span style="font-family:Times New Roman">unregister_chrdev_region()</span><span style="font-family:宋体">释放原先申请的设备号。具体代码在文件</span></span><span style=";font-size:14px">fs/char_dev.c</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">中，代码如下。</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">void cdev_del(struct cdev *p)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">cdev_unmap(p-&gt;dev, p-&gt;count);</span></p><p style="text-indent:28px"><span style=";font-size:14px">kobject_put(&amp;p-&gt;kobj);</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">cdev_del()<span style="font-family:宋体">执行流程如下：</span></span></p><p style="margin-left:56px"><span style=";font-size:14px">(1)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">调用</span>cdev_unmap()<span style="font-family:宋体">函数从</span><span style="font-family:Times New Roman">cdev_map</span><span style="font-family:宋体">散列表中删除</span><span style="font-family:Times New Roman">cdev</span><span style="font-family:宋体">设备实例和相应设备编号。</span></span></p><p style="margin-left:56px"><span style=";font-size:14px">(2)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">将</span>kobject<span style="font-family:宋体">结构体实例数量减一。</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">register_chrdev_region()<span style="font-family:宋体">函数用于向系统申请设备号，函数有三个参数：第一个为初始的设备号，第二个是请求的设备号的大小，即次设备号的大小，第三个参数是这个范围（次设备号大小）内的设备号对应的设备驱动程序。该函数先执行个</span><span style="font-family:Times New Roman">for </span><span style="font-family:宋体">循环检查请求的设备号范围是否超过了次设备号范围，然后在每个设备号范围上调用</span><span style="font-family:Times New Roman">__register_chrdev_region()</span><span style="font-family:宋体">函数，函数执行成功返回</span><span style="font-family:Times New Roman">0</span><span style="font-family:宋体">，错误返回错误代码。具体代码在文件</span></span><span style=";font-size:14px">fs/char_dev.c</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">中，代码如下：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">int register_chrdev_region(dev_t from, unsigned count, const char *name)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct char_device_struct *cd;</span></p><p style="text-indent:28px"><span style=";font-size:14px">dev_t to = from + count;</span></p><p style="text-indent:28px"><span style=";font-size:14px">dev_t n, next;</span></p><p style="text-indent:28px"><span style=";font-size:14px">for (n = from; n &lt; to; n = next) {</span></p><p style="text-indent:28px"><span style=";font-size:14px">next = MKDEV(MAJOR(n)+1, 0);</span></p><p style="text-indent:28px"><span style=";font-size:14px">if (next &gt; to)</span></p><p style="text-indent:28px"><span style=";font-size:14px">next = to;</span></p><p style="text-indent:28px"><span style=";font-size:14px">cd = __register_chrdev_region(MAJOR(n), MINOR(n),</span></p><p style="text-indent:28px"><span style=";font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next - n, name);</span></p><p style="text-indent:28px"><span style=";font-size:14px">if (IS_ERR(cd))</span></p><p style="text-indent:28px"><span style=";font-size:14px">goto fail;</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-size:14px">return 0;</span></p><p style="text-indent:28px"><span style=";font-size:14px">fail:</span></p><p style="text-indent:28px"><span style=";font-size:14px">to = n;</span></p><p style="text-indent:28px"><span style=";font-size:14px">for (n = from; n &lt; to; n = next) {</span></p><p style="text-indent:28px"><span style=";font-size:14px">next = MKDEV(MAJOR(n)+1, 0);</span></p><p style="text-indent:28px"><span style=";font-size:14px">kfree(__unregister_chrdev_region(MAJOR(n), MINOR(n), next - n));</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-size:14px">return PTR_ERR(cd);</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-family:宋体;font-size:14px">register_chrdev_region()<span style="font-family:宋体">函数执行流程如下：</span></span></p><p style="margin-left:56px"><span style=";font-size:14px">(1)&nbsp;</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">通过</span></span><span style=";font-size:14px">MKDEV</span><span style=";font-family:宋体;font-size:14px">()<span style="font-family:宋体">函数得到一个设备号存储于</span><span style="font-family:Times New Roman">next</span><span style="font-family:宋体">中。</span></span></p><p style="margin-left:56px"><span style=";font-size:14px">(2)&nbsp;</span><span style=";font-size:14px"><span style="font-family:宋体">判断在</span>from<span style="font-family:宋体">的基础上再追加</span><span style="font-family:Times New Roman">count</span><span style="font-family:宋体">个设备是否已经溢出到下一个主设备号</span></span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">，</span></span><span style=";font-size:14px"><span style="font-family:宋体">。如果溢出（</span>next</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">大于</span></span><span style=";font-size:14px">to<span style="font-family:宋体">），那么整个</span><span style="font-family:Times New Roman">for</span><span style="font-family:宋体">语句就只执行个一次</span><span style="font-family:Times New Roman">__register_chrdev_region</span><span style="font-family:宋体">函数；否则当设备号</span></span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">没</span></span><span style=";font-size:14px"><span style="font-family:宋体">溢出时，</span></span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">会循环</span></span><span style=";font-size:14px"><span style="font-family:宋体">调用</span>__register_chrdev_region<span style="font-family:宋体">函数</span></span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">，直到</span>next<span style="font-family:宋体">大于</span><span style="font-family:Times New Roman">to</span><span style="font-family:宋体">。</span></span></p><p style="margin-left:56px"><span style=";font-size:14px">(3)&nbsp;</span><span style=";font-size:14px"><span style="font-family:宋体">如果在某个小范围调用</span>__register_chrdev_region<span style="font-family:宋体">时出现了失败，那么会将此前分配的设备号都释放</span></span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">。</span></span></p><p style="line-height:24px"><span style=";font-size:14px">alloc_chrdev_region</span><span style=";font-family:宋体;font-size:14px">()<span style="font-family:宋体">函数也是向系统申请设备号，但相比</span></span><span style=";font-size:14px">register_chrdev_region</span><span style=";font-family:宋体;font-size:14px">()<span style="font-family:宋体">函数，其可以动态分配一个主设备号。函数有四个参数：第一个为初始设备号，第二个是请求分配的次设备号的初始值，第三个是次设备号的范围，第四个是次设备号对应的驱动程序的名称，此函数最终调用</span><span style="font-family:Times New Roman">__register_chrdev_region()</span><span style="font-family:宋体">函数实现。具体代码在文件</span></span><span style=";font-size:14px">fs/char_dev.c</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">中，如下所示：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">int alloc_chrdev_region(dev_t *dev, unsigned baseminor, unsigned count,</span></p><p style="text-indent:28px"><span style=";font-size:14px">const char *name)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct char_device_struct *cd;</span></p><p style="text-indent:28px"><span style=";font-size:14px">cd = __register_chrdev_region(0, baseminor, count, name);</span></p><p style="text-indent:28px"><span style=";font-size:14px">if (IS_ERR(cd))</span></p><p style="text-indent:28px"><span style=";font-size:14px">return PTR_ERR(cd);</span></p><p style="text-indent:28px"><span style=";font-size:14px">*dev = MKDEV(cd-&gt;major, cd-&gt;baseminor);</span></p><p style="text-indent:28px"><span style=";font-size:14px">return 0;</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="line-height:24px"><span style=";font-size:14px">register_chrdev</span><span style=";font-family:宋体;font-size:14px">()<span style="font-family:宋体">函数是一个老式分配设备编号范围的函数，其是</span><span style="font-family:Times New Roman">__register_chrdev()</span><span style="font-family:宋体">函数的封装，</span><span style="font-family:Times New Roman">__register_chrdev()</span><span style="font-family:宋体">函数内部调用</span><span style="font-family:Times New Roman">__register_chrdev_region()</span><span style="font-family:宋体">函数实现。其分配一个单独主设备号和</span></span><span style=";font-size:14px">&nbsp;0 ~ 255 </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">的次设备号范围。如果申请的主设备号为</span></span><span style=";font-size:14px">&nbsp;0 </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">则动态分配一个。该函数还需传入一个</span></span><span style=";font-size:14px">&nbsp;file_operations </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">结构的指针，函数内部自动分配了一个新的</span></span><span style=";font-size:14px">&nbsp;cdev </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">结构。</span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">resgister_chrdev_region()<span style="font-family:宋体">、</span></span><span style=";font-size:14px">alloc_chrdev_region</span><span style=";font-family:宋体;font-size:14px">()<span style="font-family:宋体">、</span></span><span style=";font-size:14px">register_chrdev</span><span style=";font-family:宋体;font-size:14px">()<span style="font-family:宋体">三个字符设备注册函数最终都调用了</span><span style="font-family:Times New Roman">__register_chrdev_region()</span><span style="font-family:宋体">函数。</span><span style="font-family:Times New Roman">__register_chrdev_region()</span><span style="font-family:宋体">函数用于向系统注册一个设备号，有四个参数，第一个是设备的主设备号，第二个是初始此设备号，第三个是次设备号范围，第四个是与设备号对应的设备驱动名称。</span><span style="font-family:Times New Roman">__register_chrdev_region()</span><span style="font-family:宋体">函数代码在文件</span><span style="font-family:Times New Roman">/fs/char_dev.c</span><span style="font-family:宋体">中。</span><span style="font-family:Times New Roman">__register_chrdev_region()</span><span style="font-family:宋体">函数执行流程图如下所示：</span></span></p><p style="text-align: center;"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0GrhbhictvWicmcXFDzFpIABbjvVbsTHPyu45Y5vpTctFGuHamcAGsyibj890ib8ayphl8yOdGeC5CIsw"  data-ratio="1.426183844011142" data-w="359"  /></p><p style="text-indent:28px;text-align:center"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">图</span>2-4 __register_chrdev_region()<span style="font-family:宋体">函数执行流程图</span></span></p><p style="text-indent:28px;text-align:center"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体"><br  /></span></span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">chrdev_open()<span style="font-family:宋体">函数用于打开字符设备文件，其有两个参数，第一个是文件索引节点结构体指针，第二个参数是文件对象结构体指针。</span><span style="font-family:Times New Roman">chrdev_open()</span><span style="font-family:宋体">函数执行流程图如下：</span></span></p><p style="text-align: center;"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0GrhbhictvWicmcXFDzFpIABbN53ruukepRq4MUicf5Sk4fR3S3MFLFENLv4RVvK2RMPRnVZvlZiapNWw"  data-ratio="2.171974522292994" data-w="314"  /><br  /></p><p style="line-height:24px"><span style=";font-size:14px"></span></p><p style="text-indent:28px;text-align:center"><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">图</span>2-5 chrdev_open()<span style="font-family:宋体">函数执行流程图</span></span></p><p style="line-height:24px"><span style=";font-size:14px"></span><br  /></p><p style="line-height:24px"><span style=";font-size:14px">unregister_chrdev_region()</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">函数用于注销设备号，其调用</span></span><span style=";font-size:14px">__unregister_chrdev_region() </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">函数具体，代码在文件</span></span><span style=";font-size:14px">fs/char_dev.c</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">中，如下所示：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">void unregister_chrdev_region(dev_t from, unsigned count)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">dev_t to = from + count;</span></p><p style="text-indent:28px"><span style=";font-size:14px">dev_t n, next;</span></p><p style="text-indent:28px"><span style=";font-size:14px">for (n = from; n &lt; to; n = next) {</span></p><p style="text-indent:28px"><span style=";font-size:14px">next = MKDEV(MAJOR(n)+1, 0);</span></p><p style="text-indent:28px"><span style=";font-size:14px">if (next &gt; to)</span></p><p style="text-indent:28px"><span style=";font-size:14px">next = to;</span></p><p style="text-indent:28px"><span style=";font-size:14px">kfree(__unregister_chrdev_region(MAJOR(n), MINOR(n), next - n));</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="line-height:24px"><span style=";font-size:14px">unregister_chrdev()</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">函数也是用于注销一个设备号，与设备号注册函数</span></span><span style=";font-size:14px">register_chrdev</span><span style=";font-family:宋体;font-size:14px">()<span style="font-family:宋体">对应，其是对</span><span style="font-family:Times New Roman">__unregister_chrdev()</span><span style="font-family:宋体">函数的封装，</span><span style="font-family:Times New Roman">__unregister_chrdev()</span><span style="font-family:宋体">函数中调用了</span><span style="font-family:Times New Roman">_</span></span><span style=";font-size:14px">_unregister_chrdev_region()</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">。</span>__unregister_chrdev()<span style="font-family:宋体">函数代码在文件</span></span><span style=";font-size:14px">fs/char_dev.c</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">中，如下所示：</span></span></p><p style="text-indent:28px"><span style=";font-size:14px">void __unregister_chrdev(unsigned int major, unsigned int baseminor,</span></p><p style="text-indent:28px"><span style=";font-size:14px">&nbsp;unsigned int count, const char *name)</span></p><p style="text-indent:28px"><span style=";font-size:14px">{</span></p><p style="text-indent:28px"><span style=";font-size:14px">struct char_device_struct *cd;</span></p><p style="text-indent:28px"><span style=";font-size:14px">cd = __unregister_chrdev_region(major, baseminor, count);</span></p><p style="text-indent:28px"><span style=";font-size:14px">if (cd &amp;&amp; cd-&gt;cdev)</span></p><p style="text-indent:28px"><span style=";font-size:14px">cdev_del(cd-&gt;cdev);</span></p><p style="text-indent:28px"><span style=";font-size:14px">kfree(cd);</span></p><p style="text-indent:28px"><span style=";font-size:14px">}</span></p><p style="line-height:24px"><span style=";font-family:宋体;font-size:14px">_</span><span style=";font-size:14px">_unregister_chrdev_region()</span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">是注销设备号的核心函数，代码在文件</span>fs/char_dev.c<span style="font-family:宋体">中。其执行流程比较简单，先从</span></span><span style=";font-size:14px">chrdevs </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">散列表里中找到需要释放的</span>char_device_struct<span style="font-family:宋体">结构实例，再将</span><span style="font-family:Times New Roman">char_device_struct</span><span style="font-family:宋体">结构实例从</span></span><span style=";font-size:14px">chrdevs </span><span style=";font-family:宋体;font-size:14px"><span style="font-family:宋体">散列表中删除。</span></span></p><p style="text-align: center;"><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_reward_area" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_reward_avatar">
                        <img src="" alt="" id="js_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" style="display: none;" id="js_reward_author">程香鹏</div>
                                                            <p class="reward_button_wrp">
                      <span id="js_author_reward_qrcode" class="reward_pop_panel">
                        <img id="js_author_reward_qrcode_img" src="" alt="赞赏二维码">
                        <strong>微信扫一扫赞赏作者</strong>
                      </span>
                        <a class="reward_button" id='js_reward_link' href="##"><span id="js_reward_link_text">赞赏</span></a>
                    </p>
                    <div id="js_reward_inner" class="reward_area_inner" style="display:none;">
                        <p class="weui-loadmore weui-loadmore_line reward_user_tips" id="js_reward_total_parent">
                          <span class="weui-loadmore__tips">
                            <a href="javascript:;" id="js_reward_total"></a>&nbsp;<span id="js_reward_total_text">人赞赏</span>
                        </span>
                        </p>
                        
                        <div id="js_reward_list" class="reward_user_list"></div>
                        <div id="js_reward_pagination" class="simple_pagination" style="display: none;">
                          <button disabled class="btn_sp_prev js_reward_pagination_prev">上一页</button>
                          <span class="sp_page_num_area">
                            <a class="sp_page_current js_reward_pagination_curpage" href="javascript:;">1</a>&#47;<span class="sp_page_num js_reward_pagination_totalpage">3</span>
                          </span>
                          <button class="btn_sp_next js_reward_pagination_next">下一页</button>
                        </div>
                    </div>
                </div>
                                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='https://www.52pojie.cn/' target='_blank'>
			吾爱破解论坛
		</a>
	</div>
</body>