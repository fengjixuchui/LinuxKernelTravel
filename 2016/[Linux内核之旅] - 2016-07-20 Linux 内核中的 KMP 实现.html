<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		Linux 内核中的 KMP 实现
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664602625&amp;idx=1&amp;sn=5e2ba1a876e5362ee623819bea50e04f&amp;chksm=f04db1e4c73a38f2a31b957684eb42f323eefd6ca555ffacfe0556fefb3bde235006651b5b1a&amp;scene=27#wechat_redirect&cpage=66' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">Linux 内核中的 KMP 实现</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                                                        <span class="rich_media_meta rich_media_meta_text">
                                                        王聪
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2016-07-20</em>





                </div>

                
                
                                
                
                
                
                                                
                                <div class="rich_media_thumb_wrp" id="media">
                    
                                        
                                    </div>
                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p style=""><span style="font-size: 16px;">Linux 内核中使用到了字符串搜索，所以它也有</span><a target="_blank" rel="external" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-style: inherit; font-family: inherit; vertical-align: baseline; color: rgb(44, 166, 203); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">&nbsp;<span style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-style: inherit; font-family: inherit; vertical-align: baseline; text-decoration: underline; font-size: 16px; color: rgb(2, 30, 170);"><strong>KMP 算法</strong></span></span></a><span style="font-size: 16px;">的实现，代码在 lib/ts_kmp.c 中。</span></p><p style=""><span style="font-size: 16px;">Linux 内核中用到 KMP 算法的地方有三处：iptables string match 模块、iptables conntrack amanda 模块（不知道这个是用来干什么的）、以及 ematch qdisc。iptables string match 是通过字符串搜索来匹配一个包，然后进行相应的处理，比如用下面的命令可以阻止对domain.com服务器的HTTP请求：</span></p><p style=""><span style="font-size: 16px;">iptables -I INPUT 1 -p tcp —dport 80 -m string —string “domain.com” —algo kmp -j DROP</span></p><p style=""><span style="font-size: 16px;">至于 ematch qdisc，和它类似，可以通过字符串匹配到对应的包进行 QoS，比<span style="font-size: 16px; color: rgb(0, 0, 0);">如</span></span><a target="_blank" rel="external" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-style: inherit; font-family: inherit; vertical-align: baseline; font-size: 16px; text-decoration: underline; color: rgb(2, 30, 170);"><span style="color: rgb(2, 30, 170);"><strong><span style="color: rgb(2, 30, 170); font-size: 16px;">这个例子</span></strong></span></a><span style="font-size: 16px;">：</span></p><p style=""><span style="font-size: 16px;">tc filter add dev eth0 parent 10:12 prio 10 protocol ip basic match ‘text(kmp foobar from 0 to 200)’ flowid 10:1</span></p><p style=""><span style="font-size: 16px;">总之，在内核中实现 KMP 算法是有必要的。下面来看具体实现。</span></p><p style=""><span style="font-size: 16px;">我们知道，KMP 算法中最核心的地方就是 prefix 的计算，也称为 next 数组，它用来表示当字符 pattern[i] 匹配失败后应该从 pattern[next[i]] 字符继续进行匹配，而不总是从头开始，因此它的时间复杂度是O(n)。如果你对 KMP 不熟悉的话，网上有很多介绍，我觉得</span><a target="_blank" rel="external" style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-style: inherit; font-family: inherit; vertical-align: baseline; font-size: 16px; text-decoration: underline; color: rgb(2, 30, 170);"><span style="color: rgb(2, 30, 170);"><strong><span style="color: rgb(2, 30, 170); font-size: 16px;">这篇文章</span></strong></span></a><span style="font-size: 16px;">还算不错，在继续看下面的代码之前可以读一下它。</span></p><p style=""><span style="font-size: 16px;">内核中实现比网上的很多代码都更容易理解，因为在匹配开始之前，它就先把 prefix 计算好了。计算 prefix 的函数是：</span></p><p style=""><span style="font-size: 16px;">[c]<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />static inline void compute_prefix_tbl(const u8&nbsp;<em style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-family: inherit; vertical-align: baseline;">pattern, unsigned int len,<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />unsigned int&nbsp;</em>prefix_tbl, int flags)<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />{<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />unsigned int k, q;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />const u8 icase = flags &amp; TS_IGNORECASE;</span></p><p><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0GPRp0tYmaRrB4QxdAJ9NqcdarQhwKpnBKDBIXwzzRRR8kKibVx2KJicId8VJQk1GhQqWUpO2pVB7oA"  data-ratio="0.25539568345323743" data-w=""  /><br  /></p><p style=""><span style="font-size: 16px;">}<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />[/c]</span></p><p style=""><span style="font-size: 16px;">结合 KMP 实现的主函数来理解更一目了然：</span></p><p style=""><span style="font-size: 16px;">[c]<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />static unsigned int kmp_find(struct ts_config&nbsp;<em style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-family: inherit; vertical-align: baseline;">conf, struct ts_state&nbsp;</em>state)<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />{<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />struct ts_kmp&nbsp;<em style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-family: inherit; vertical-align: baseline;">kmp = ts_config_priv(conf);<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />unsigned int i, q = 0, text_len, consumed = state-&gt;offset;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />const u8&nbsp;</em>text;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />const int icase = conf-&gt;flags &amp; TS_IGNORECASE;</span></p><p><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0GPRp0tYmaRrB4QxdAJ9NqcQqsarvWyACicWVwkE98qhLPSt7iaFbibicjwMXLGPkzU9tpia5Yucx07UFA"  data-ratio="0.6816546762589928" data-w=""  /><br  /></p><p style=""><span style="font-size: 16px;">}<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />[/c]</span></p><p style=""><span style="font-size: 16px;">内核中的 KMP 函数接口是封装过的，你不能直接调用它。如果你的内核模块中要使用它，可以参考 lib/textsearch.c 中给的例子：</span></p><p style=""><span style="font-size: 16px;">[c]<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />int pos;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />struct ts_config&nbsp;<em style="-webkit-margin-before: 0px; -webkit-margin-after: 0px; border: 0px; outline: 0px; font-weight: inherit; font-family: inherit; vertical-align: baseline;">conf;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />struct ts_state state;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />const char&nbsp;</em>pattern = “chicken”;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />const char *example = “We dance the funky chicken”;</span></p><p style=""><span style="font-size: 16px;">conf = textsearch_prepare(“kmp”, pattern, strlen(pattern),<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />GFP_KERNEL, TS_AUTOLOAD);<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />if (IS_ERR(conf)) {<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />err = PTR_ERR(conf);<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />goto errout;<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />}</span></p><p style=""><span style="font-size: 16px;">pos = textsearch_find_continuous(conf, &amp;state, example, strlen(example));<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />if (pos != UINT_MAX)<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />panic(“Oh my god, dancing chickens at %dn”, pos);</span></p><p style=""><span style="font-size: 16px;">textsearch_destroy(conf);<br style="-webkit-margin-before: 0px; -webkit-margin-after: 0px;"  />[/c]</span></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_reward_area" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_reward_avatar">
                        <img src="" alt="" id="js_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" style="display: none;" id="js_reward_author">王聪</div>
                                                            <p class="reward_button_wrp">
                      <span id="js_author_reward_qrcode" class="reward_pop_panel">
                        <img id="js_author_reward_qrcode_img" src="" alt="赞赏二维码">
                        <strong>微信扫一扫赞赏作者</strong>
                      </span>
                        <a class="reward_button" id='js_reward_link' href="##"><span id="js_reward_link_text">赞赏</span></a>
                    </p>
                    <div id="js_reward_inner" class="reward_area_inner" style="display:none;">
                        <p class="weui-loadmore weui-loadmore_line reward_user_tips" id="js_reward_total_parent">
                          <span class="weui-loadmore__tips">
                            <a href="javascript:;" id="js_reward_total"></a>&nbsp;<span id="js_reward_total_text">人赞赏</span>
                        </span>
                        </p>
                        
                        <div id="js_reward_list" class="reward_user_list"></div>
                        <div id="js_reward_pagination" class="simple_pagination" style="display: none;">
                          <button disabled class="btn_sp_prev js_reward_pagination_prev">上一页</button>
                          <span class="sp_page_num_area">
                            <a class="sp_page_current js_reward_pagination_curpage" href="javascript:;">1</a>&#47;<span class="sp_page_num js_reward_pagination_totalpage">3</span>
                          </span>
                          <button class="btn_sp_next js_reward_pagination_next">下一页</button>
                        </div>
                    </div>
                </div>
                                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='https://www.52pojie.cn/' target='_blank'>
			吾爱破解论坛
		</a>
	</div>
</body>