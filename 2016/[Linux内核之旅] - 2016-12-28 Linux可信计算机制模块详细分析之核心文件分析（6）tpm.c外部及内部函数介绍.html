<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		Linux可信计算机制模块详细分析之核心文件分析（6）tpm.c外部及内部函数介绍
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664603606&amp;idx=1&amp;sn=ad8f862b2a0b143e10e83d56af63c4eb&amp;chksm=f04db233c73a3b252930db109f573d3dbdcc86c60b82ae100ae49a4f63127e2e41ee0a149394&amp;scene=27#wechat_redirect&cpage=51' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">Linux可信计算机制模块详细分析之核心文件分析（6）tpm.c外部及内部函数介绍</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                                                        <span class="rich_media_meta rich_media_meta_text">
                                                        程香鹏
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2016-12-28</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p><span style="color: rgb(2, 30, 170);"><strong><span style="font-family: 宋体; font-size: 16px;">2.4.2.4 外部函数</span></strong></span></p><p><br  /></p><table width="487"><tbody><tr style="height:27px"><td width="243" valign="top" style="padding: 0px 7px; border-width: 1px; border-color: windowtext;"><p style="text-indent:0;text-align:center"><span style="font-family: 宋体; font-size: 16px;">函数名</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0;text-align:center"><span style="font-family: 宋体; font-size: 16px;">说明</span></p></td></tr><tr style="height:26px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">schedule_work()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">调度执行一个具体的任务，执行的任务将会被插入<span style=" font-size: 16px ; ;; ">workqueue</span>队列中</span></p></td></tr><tr style="height:27px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">mutex_lock()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">加锁互斥量，与<span style=" font-size: 16px ; ;; ">mutex_lock()</span>函数成对出现，用来操作临界资源</span></p></td></tr><tr style="height:26px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">atomic_set()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">原子操作</span></p></td></tr><tr style="height:26px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">memset()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">内存空间初始化</span></p></td></tr><tr style="height:28px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">mutex_unlock()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">解锁互斥量</span></p></td></tr><tr style="height:28px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">be32_to_cpu()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">字节序转换，将<span style=" font-size: 16px ; ;; ">32</span>位字节序转换成<span style=" font-size: 16px ; ;; ">CPU</span>字节序</span></p></td></tr><tr style="height:28px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">cpu_to_be32()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">与<span style=" font-size: 16px ; ;; ">be32_to_cpu()</span>功能相反，将<span style=" font-size: 16px ; ;; ">CPU</span>字节序转换成<span style=" font-size: 16px ; ;; ">32</span>为字节序</span></p></td></tr><tr style="height:28px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">msleep()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">睡眠操作</span></p></td></tr><tr style="height:28px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">copy_to_user()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">将数据从内核空间拷贝到用户空间</span></p></td></tr><tr style="height:28px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">copy_from_user()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">将数据从用户空间拷贝到内核空间</span></p></td></tr><tr style="height:28px"><td width="243" valign="top" style="padding: 0px 7px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">container_of()</span></p></td><td width="243" valign="top" style="padding: 0px 7px; border-left: none; border-right-width: 1px; border-right-color: windowtext; border-top: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="text-indent:0"><span style="font-family: 宋体; font-size: 16px;">通过结构体中的成员地址获取结构体本身的地址或其他成员的入口地址</span></p></td></tr></tbody></table><p><span style="font-size: 16px; font-family: 宋体;"><br  /></span></p><p><strong><span style="font-family: 宋体; font-size: 16px; color: rgb(2, 30, 170);">2.4.2.5 内部函数</span></strong></p><p style="margin-left:56px"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;">1.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span></span><span style="font-size: 14px;">tpm_register_hardware</span><span style="font-family: 宋体; font-size: 14px;">()</span></span></p><p style="margin-left:28px;text-indent:0"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span> </span><span style="font-size: 14px;">struct tpm_chip *tpm_register_hardware(struct device *dev,const struct tpm_vendor_specific *entry</span><span style="font-family: 宋体; font-size: 14px;">)</span></span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">函数参数：dev是指向<span style=" font-size: 16px ; ;; ">device</span>结构体指针，<span style=" font-size: 16px ; ;; ">entry</span>指向<span style=" font-size: 16px ; ;; ">tpm_vendor_specific</span>结构体。</span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">返回值 ：tpm_chip结构体指针。</span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">函数功能：注册tpm_chip结构体实例，为<span style=" font-size: 16px ; ;; ">tpm_chip</span>结构体分配空间，将结构初始化，设置工作函数、日志文件等。</span></p><p style="margin-left:56px"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;">2.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span></span><span style="font-size: 14px;">tpm_remove_hardware</span><span style="font-family: 宋体; font-size: 14px;">()</span></span></p><p style="margin-left:28px;text-indent:0"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span><span style="font-size: 14px;">void tpm_remove_hardware(struct device *dev)</span></span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">函数参数：dev指向<span style=" font-size: 16px ; ;; ">device</span>结构体。</span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">返回值 &nbsp;：无返回值。</span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">函数功能：注销tpm_chip实例，释放<span style=" font-size: 16px ; ;; ">tpm_chip</span>实例所占空间。</span></p><p style="margin-left:56px"><span style="font-family: 宋体; font-size: 14px;">3.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span>tpm_open()</span></p><p style="margin-left:28px;text-indent:0"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span><span style="font-size: 14px;">int tpm_open(struct inode *inode, struct file *file)</span></span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">函数参数：inode指向<span style=" font-size: 16px ; ;; ">inode </span>结构体，<span style=" font-size: 16px ; ;; ">file</span>指向<span style=" font-size: 16px ; ;; ">file</span>结构体。</span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">返回值 &nbsp;：成功返回0，错误返回错误码。</span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">函数功能：打开tpm_chip对象实例。</span></p><p style="margin-left:28px;text-indent:0"><span style="font-family: 宋体; font-size: 16px;">tpm_open()函数执行流程如下：</span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(1)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">从</span>tpm_chip_list<span style="font-size: 16px; font-family: 宋体;">链表中找到要打开的</span><span style=" font-size: 16px ; ;; ">tpm_chip</span><span style="font-size: 16px; font-family: 宋体;">实例。如果没找到返回错误码。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(2)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">检测</span>tpm_chip<span style="font-size: 16px; font-family: 宋体;">实例中</span><span style=" font-size: 16px ; ;; ">is_open</span><span style="font-size: 16px; font-family: 宋体;">字段的值。如果不为</span><span style=" font-size: 16px ; ;; ">0</span><span style="font-size: 16px; font-family: 宋体;">，表示此</span><span style=" font-size: 16px ; ;; ">tpm_chip</span><span style="font-size: 16px; font-family: 宋体;">实例正在使用，返回错误码。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(3)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">为</span>tpm_chip<span style="font-size: 16px; font-family: 宋体;">实例的</span><span style=" font-size: 16px ; ;; ">data_buffer</span><span style="font-size: 16px; font-family: 宋体;">字段分配空间。</span><span style=" font-size: 16px ; ;; ">data_buffer</span><span style="font-size: 16px; font-family: 宋体;">字段用于存储输入的</span><span style=" font-size: 16px ; ;; ">TPM</span><span style="font-size: 16px; font-family: 宋体;">命令和返回的数据。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(4)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">设置</span>data_buffer<span style="font-size: 16px; font-family: 宋体;">缓冲区读写互斥锁。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(5)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">将设备实例</span>tpm_chip<span style="font-size: 16px; font-family: 宋体;">放在文件结构</span><span style=" font-size: 16px ; ;; ">file</span><span style="font-size: 16px; font-family: 宋体;">的私有数据成员上。</span></span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">tpm_open()函数执行流程图如下:</span></p><p style="margin-left: 28px; text-indent: 0px; line-height: 24px; text-align: center;"><span style="text-align: center; font-family: 宋体; font-size: 16px;"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0FlqKoMbm98wbiafiak6ibZfmst8IGiaIYMicajszX2zNMvBCOjGVNzJ8uw3hgKvVft0u7tRtBCQsDMn9g"  data-ratio="1.1858823529411764" data-w="425"  /><br  />&nbsp;</span><span style="font-family: 宋体; font-size: 14px; text-align: center;">图2-12 tpm_open()函数执行流程图</span></p><p style="margin-left:56px;line-height:24px"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;">4.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span></span><span style="font-size: 14px;">tpm_release</span><span style="font-family: 宋体; font-size: 14px;">()</span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span><span style="font-size: 14px;">int tpm_release(struct inode *inode, struct file *file)</span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数参数：inode指向<span style=" font-size: 16px ; ;; ">inode </span>结构体，<span style=" font-size: 16px ; ;; ">file</span>指向<span style=" font-size: 16px ; ;; ">file</span>结构体。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">返回值 &nbsp;：返回0.</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数功能：释放tpm_chip实例，清除<span style=" font-size: 16px ; ;; ">tpm_chip</span>实例中各字段的值。</span></p><p style="margin-left:56px;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">5.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span>tpm_write()</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span><span style="font-size: 14px;">ssize_t tpm_write(struct file *file, const char __user *buf,size_t size, loff_t *off)</span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数参数：file指向文件结构体<span style=" font-size: 16px ; ;; ">file</span>；<span style=" font-size: 16px ; ;; ">buf</span>是用户空间缓冲区，存储要写入的数据；<span style=" font-size: 16px ; ;; ">size</span>表示写入的数据的字节数；<span style=" font-size: 16px ; ;; ">loff_t</span>为读写指针。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">返回值 ：成功返回发送的字节数，失败返回错误码。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数功能：从用户空间将TPM命令数据读入到内核空间的<span style=" font-size: 16px ; ;; ">TPM</span>设备驱动中的数据缓存区，然后调用<span style=" font-size: 16px ; ;; ">tpm_transmit </span>函数通过<span style=" font-size: 16px ; ;; ">TPM</span>硬件完成<span style=" font-size: 16px ; ;; ">TPM</span>命令操作，操作后的结构放入<span style=" font-size: 16px ; ;; ">TPM</span>设备驱动中的数据缓存区。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">tpm_write()函数执行流程如下：</span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(1)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">读取</span>tpm_chip<span style="font-size: 16px; font-family: 宋体;">设备实例</span><span style=" font-size: 16px ; ;; ">data_pending</span><span style="font-size: 16px; font-family: 宋体;">字段的值。</span><span style=" font-size: 16px ; ;; ">data_pending</span><span style="font-size: 16px; font-family: 宋体;">的值如果为非</span><span style=" font-size: 16px ; ;; ">0</span><span style="font-size: 16px; font-family: 宋体;">，表示设备缓存区正在进行读操作，写操作进入失眠，直到</span><span style=" font-size: 16px ; ;; ">data_penging</span><span style="font-size: 16px; font-family: 宋体;">的值为</span><span style=" font-size: 16px ; ;; ">0</span><span style="font-size: 16px; font-family: 宋体;">。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(2)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">调用</span>copy_from_user()<span style="font-size: 16px; font-family: 宋体;">从用户空间拷贝数据到内核空间的</span><span style=" font-size: 16px ; ;; ">data_buffer</span><span style="font-size: 16px; font-family: 宋体;">中。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(3)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">调用</span>tpm_transmit()<span style="font-size: 16px; font-family: 宋体;">函数将数据传输给</span><span style=" font-size: 16px ; ;; ">TPM</span><span style="font-size: 16px; font-family: 宋体;">芯片执行。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(4)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">设置数据缓存区</span>data_buffer<span style="font-size: 16px; font-family: 宋体;">的读写互斥锁。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(5)&nbsp;</span><span style="font-size: 16px; font-family: 宋体;">设置读定时器，在定时到达是，读者必须声明读的结果。</span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(6)&nbsp;</span><span style="font-size: 16px; font-family: 宋体;">返回写入的字节数。</span></span></p><p style="margin-left:52px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">&nbsp;</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">tpm_write()函数执行流程图如下：</span></p><p style="margin-left: 28px; text-indent: 0px; line-height: 24px; text-align: center;"><span style="font-family: 宋体; text-align: center; font-size: 16px;"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0FlqKoMbm98wbiafiak6ibZfmsp5RfQx8FUWenhwQ8f77seSxOm9cHD57fEsmdalpxT3SZljTN8A8Y8w"  data-ratio="1.3177257525083612" data-w="299"  /><br  />&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">图2-13 tpm_write()函数执行流程图</span></p><p style="margin-left:56px;line-height:24px"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;">6.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span></span><span style="font-size: 14px;">tpm_transmit</span><span style="font-family: 宋体; font-size: 14px;">()</span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span><span style="font-size: 14px;">static ssize_t tpm_transmit(struct tpm_chip *chip, const char *buf,size_t bufsiz</span><span style="font-family: 宋体; font-size: 14px;">e</span><span style="font-size: 14px;">)</span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数参数：chip指向要处理<span style=" font-size: 16px ; ;; ">TPM</span>命令的<span style=" font-size: 16px ; ;; ">TPM</span>芯片设备实例；<span style=" font-size: 16px ; ;; ">buf</span>为数据缓存区；<span style=" font-size: 16px ; ;; ">bufsize</span>为传输数据的字节数。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">返回值 ：成功返回执行结果，失败返回错误码。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数功能：传输TPM命令的内部接口，和<span style=" font-size: 16px ; ;; ">TPM</span>设备通信。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">tpm_transmit</span><span style="font-family: 宋体; font-size: 14px;">()<span style="font-size: 16px; font-family: 宋体;">函数执行流程如下：</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(1)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">设置</span>TPM<span style="font-size: 16px; font-family: 宋体;">命令对应的次序值。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(2)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">调用</span>TPM<span style="font-size: 16px; font-family: 宋体;">芯片的特定发送指令，将</span><span style=" font-size: 16px ; ;; ">TPM</span><span style="font-size: 16px; font-family: 宋体;">命令传输给</span><span style=" font-size: 16px ; ;; ">TPM</span><span style="font-size: 16px; font-family: 宋体;">设备。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(3)&nbsp;</span><span style="font-size: 16px; font-family: 宋体;">计算命令执行停止时间。</span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(4)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">在命令停止时间内不断读取</span>TPM<span style="font-size: 16px; font-family: 宋体;">设备的操作状态，等待执行结果。如果操作完成，调用</span><span style=" font-size: 16px ; ;; ">TPM</span><span style="font-size: 16px; font-family: 宋体;">芯片的特定接收指令返回操作结果，如果操作取消，返回取消信息。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(5)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">如果操作超出命令执行时间，调用</span>TPM<span style="font-size: 16px; font-family: 宋体;">芯片的取消指令终止命令执行。</span></span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">tpm_transmit</span><span style="font-family: 宋体; font-size: 14px;">()<span style="font-size: 16px; font-family: 宋体;">函数执行流程图如下：</span></span></span></p><p style="margin-left:28px;text-indent:0;text-align:center"><span style="font-family: 宋体; font-size: 16px;">&nbsp;</span></p><p style="margin-left:28px;text-indent:0;text-align:center"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">图</span>2-14 </span><span style="font-size: 14px;">tpm_transmit</span><span style="font-family: 宋体; font-size: 14px;">()<span style="font-size: 16px; font-family: 宋体;">函数执行流程图</span></span></span></p><p style="margin-left:56px;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">7.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span>tpm_read()</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span><span style="font-size: 14px;">ssize_t tpm_read(struct file *file, char __user *buf, size_t size, loff_t *off)</span></span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数参数：file 为文件结构体指针，<span style=" font-size: 16px ; ;; ">buf</span>是要返回数据的用户空间，<span style=" font-size: 16px ; ;; ">size</span>是读取的字节数，<span style=" font-size: 16px ; ;; ">off</span>为读写指针。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">返回值 ：读取的字节数。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数功能：关闭读定时器，从TPM设备驱动数据缓冲区将操作结果拷贝到用户空间。</span></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">tpm_read()函数执行流程如下：</span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(1)&nbsp;</span><span style="font-size: 16px; font-family: 宋体;">关闭读定时器。</span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(2)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">设置</span>data_buffer<span style="font-size: 16px; font-family: 宋体;">缓存区读写互斥锁的值并设置为</span><span style=" font-size: 16px ; ;; ">0.</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(3)&nbsp;</span><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">调用</span>copy_to_user()<span style="font-size: 16px; font-family: 宋体;">将数据拷贝到用户空间。</span></span></span></p><p style="margin-left:52px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 14px;">(4)&nbsp;</span><span style="font-size: 16px; font-family: 宋体;">返回读取字节数。</span></span></p><p style="margin-left:56px;line-height:24px"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;">8.&nbsp;<span style="font-size: 16px; font-family: 宋体;">函数名：</span></span><span style="font-size: 14px;">tpm_do_selftest</span><span style="font-family: 宋体; font-size: 14px;">()</span></span></p><p style="text-indent:28px;line-height:24px"><span style="font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">函数原型：</span><span style="font-size: 14px;">int tpm_do_selftest(struct tpm_chip *chip)</span></span></p><p style="text-indent:28px;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数参数：chip指向<span style=" font-size: 16px ; ;; ">tpm_chip</span>结构体实例指针。</span></p><p style="text-indent:28px;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">返回值 &nbsp;：成功返回0，失败返回非<span style=" font-size: 16px ; ;; ">0.</span></span></p><p style="text-indent:28px;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">函数功能：TPM设备状态自检。检测<span style=" font-size: 16px ; ;; ">TPM</span>设备是否可以接受执行并执行命令。</span></p><p><br  /></p><p style="margin-left:28px;text-indent:0;line-height:24px"><span style="font-size: 16px; font-family: 宋体;"><br  /></span></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_reward_area" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_reward_avatar">
                        <img src="" alt="" id="js_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" style="display: none;" id="js_reward_author">程香鹏</div>
                                                            <p class="reward_button_wrp">
                      <span id="js_author_reward_qrcode" class="reward_pop_panel">
                        <img id="js_author_reward_qrcode_img" src="" alt="赞赏二维码">
                        <strong>微信扫一扫赞赏作者</strong>
                      </span>
                        <a class="reward_button" id='js_reward_link' href="##"><span id="js_reward_link_text">赞赏</span></a>
                    </p>
                    <div id="js_reward_inner" class="reward_area_inner" style="display:none;">
                        <p class="weui-loadmore weui-loadmore_line reward_user_tips" id="js_reward_total_parent">
                          <span class="weui-loadmore__tips">
                            <a href="javascript:;" id="js_reward_total"></a>&nbsp;<span id="js_reward_total_text">人赞赏</span>
                        </span>
                        </p>
                        
                        <div id="js_reward_list" class="reward_user_list"></div>
                        <div id="js_reward_pagination" class="simple_pagination" style="display: none;">
                          <button disabled class="btn_sp_prev js_reward_pagination_prev">上一页</button>
                          <span class="sp_page_num_area">
                            <a class="sp_page_current js_reward_pagination_curpage" href="javascript:;">1</a>&#47;<span class="sp_page_num js_reward_pagination_totalpage">3</span>
                          </span>
                          <button class="btn_sp_next js_reward_pagination_next">下一页</button>
                        </div>
                    </div>
                </div>
                                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='https://www.52pojie.cn/' target='_blank'>
			吾爱破解论坛
		</a>
	</div>
</body>