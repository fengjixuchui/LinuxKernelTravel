<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		阅读Linux0.11——main.c
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664602826&amp;idx=1&amp;sn=4bda9dd195ac25d53db2db1bb03ad974&amp;chksm=f04db12fc73a3839c950595445dbda94a484ead121e222052747cac9f5a9aa2c79d7f2637758&amp;scene=27#wechat_redirect&cpage=64' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">阅读Linux0.11——main.c</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                                                        <span class="rich_media_meta rich_media_meta_text">
                                                        张释文
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2016-08-10</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <h3 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">一、前言</span></strong></span></h3><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">这个前言的目的就是解释清楚理解main运行的一些基本的概念。如下：</span></p><h4 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">1、Linux0.11也是有CPU负载均衡的的</span></strong></span></h4><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">很神奇吧，最开始Linus已经考虑了CPU负载均衡这一点了，先别急着惊叹，我来跟你说说是怎么一回事。&nbsp;</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">基本上现在的Linux里，都有0号进程，进程调度的时候，如果检测到就绪队列为空，就会一直执行0号进程，因此我们也把0号进程称为闲逛进程。当然我们现代操作系统所实现的负载均衡并不只是执行进程0，因为我们目前都是多核CPU，有可能这一个CPU上没有等待执行的进程的，别的CPU上还有呢？这个不是我们今天的重点，这部分的分析，我在前面写进程调度源码分析的时候已经说过了，这个不再赘述。</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">但是当时Linus实现的CPU负载均衡就只是把进程0放在CPU上执行。&nbsp;<br style="box-sizing: border-box;"  />进程0是在什么时候创建的呢？我们前面分析boot的时候提过，boot执行完了以后把控制权交给了init模块（也就是开始执行main.c），这时候是在0特权级下运行的，0特权级也就是最高特权级。main.c执行完了内核各个模块的初始化工作以后，需要切换到3特权级下，等切换完了以后main.c就是以进程0的身份运行的。&nbsp;<br style="box-sizing: border-box;"  />我们知道Linux创建进程是用函数fork创建的，执行的操作基本上就是复制父进程的各个资源，例如：子进程复制父进程的栈空间，子进程复制父进程的数据段等等。进程0是没有父进程的，所以进程0是怎么创建的呢？我们在本文第三个部分——分析源码的时候会讲，这里暂且不提。这里只需要记住，进程0负责创建进程1，进程1创建进程2和第一个进程组。</span></p><h4 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">1、进程0 不能使用栈空间</span></strong></span></h4><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">这个没什么要理解的，我直接告诉你进程0在创建进程1也就是我们常说的init进程之前，不能使用栈空间，下面是解释。&nbsp;<br style="box-sizing: border-box;"  />前面有一篇讲请求分页机制的博文里面讲过：从内核空间fork的进程，并没有写时复制机制（COW），是创建的时候就直接分配的。所以进程1创建的时候，是直接复制了进程0的用户栈空间，为了避免进程0的栈中有进程1并不想要的多余的信息，在fork之前，进程0不能用自己的栈，这也就意味着，进程0不能调用函数。所有的函数调用都是触发中断来实现的。</span></p><h4 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">2、_exit和exit的区别</span></strong></span></h4><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">exit函数（标准IO库函数）和_exit函数（系统调用）都是实现进程退出功能，具体的操作都是，关闭打开的文件，如果进程还有子进程，子进程被init进程收养，然后返回给父进程一个SIGCHLD信号，调用sys_exit。&nbsp;<br style="box-sizing: border-box;"  />不同的是，_exit函数并不会刷标准I/O缓冲。</span></p><h4 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">3、TSS和特权级转移</span></strong></span></h4><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">在讲TSS之前我们先说一说特权级这个问题。特权级是只有在保护模式下才有的概念，设置特权级都是为了限制非法访问的，比如说低特权级的进程访问了高特权级的资源。特权级有4个，分别是0,1,2,3，数字越小特权级越高。在Linux中内核的特权级最高是0，用户特权级最小是3。我们常常会有这样的进程，在用户特权级下运行，但是调用了一个系统调用，需要陷入内核。这时候就需要特权级切换。</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">TSS（Task State Segment），任务状态段，用于任务切换的时候保存现场信息的数据结构。TSS段有很多的字段，主要可以分为：寄存器保存区域、堆栈指针保存区域和其他的预留区域等等。说起来很复杂，本文并不全部介绍，只是说几个跟我们主题有关的字段——堆栈指针保存区域。&nbsp;<br style="box-sizing: border-box;"  />每一个TSS保存的堆栈不能超过四个，这是因为同一个任务在同一个特权级下最多只能有一个堆栈，因为只有四个特权级，所以最多只能有四个堆栈（ss0,sp0,ss1,sp1,ss2,sp2,ss3,sp3）。</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">我们前面说了特权级切换，特权级切换有两种情况：&nbsp;<br style="box-sizing: border-box;"  />* 低特权级向高特权级切换，就像我们刚刚举得系统调用例子&nbsp;<br style="box-sizing: border-box;"  />* 高特权级向低特权级切换，我们本文遇到的情况。&nbsp;<br style="box-sizing: border-box;"  />低特权级向高特权级切换的时候，CPU自己把当前特权级的堆栈指针（ss和sp）压入高特权级所对应的栈中。比如说我们刚刚的例子中，是从特权级3切换到特权级0，则特权级3的堆栈指针信息压入TSS中的ss0和sp0中。&nbsp;<br style="box-sizing: border-box;"  />所以如果执行iret或retf指令从低特权级切换到高特权级的时候，只需要从高特权的堆栈中拿出低特权级对应的堆栈信息即可。</span></p><h4 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">4.会话组</span></strong></span></h4><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">一个或者多个进程组构成一个会话组，会话组ID就是创建会话组的进程（称为会话首进程）的ID，在Linux0.11中每登陆一个用户，init进程创建一个会话组。&nbsp;<br style="box-sizing: border-box;"  />每一个会话组可以打开一个终端设备作为控制终端，打开控制终端的进程称为控制进程。一个会话组中有很多个进程组，这些进程组被分为前台进程组和后台进程组。&nbsp;<br style="box-sizing: border-box;"  />函数setsid函数可以创建一个会话组，函数原型如下：</span></p><pre class="prettyprint" name="code" style=" white-space: nowrap; word-wrap: break-word; box-sizing: border-box;  overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588); "><code class="hljs cs has-numbering" style="display: block; color: inherit; box-sizing: border-box; font-family: &#39;Source Code Pro&#39;, monospace; font-size: inherit; white-space: pre; border-radius: 0px; word-wrap: normal; text-align: justify; background: transparent;"><span style="font-size: 16px;">pid_t setsid(<span class="hljs-keyword" style="font-size: 16px; color: rgb(0, 0, 136); box-sizing: border-box;">void</span>);</span></code></pre><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">调用setsid函数的进程创建一个新的会话组，会话组ID既该进程PID，同事也创建一个新的进程组，进程组ID也是该进程的PID。这就要求，调用setsid的进程并不是任何一个进程组的组长。该进程如果之前已经和一个终端关联，setsid函数”切断”这中关联。</span></p><h3 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">一、main.c功能描述</span></strong></span></h3><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">setup.s程序读出了系统的一些硬件信息，存在主存里。 main.c的具体功能是：&nbsp;<br style="box-sizing: border-box;"  />* 读取根设备&nbsp;<br style="box-sizing: border-box;"  />* 读取硬盘信息&nbsp;<br style="box-sizing: border-box;"  />* 得到内存大小（包括缓存、内核镜像所占空间和主存在内的全部大小）&nbsp;<br style="box-sizing: border-box;"  />* 根据内存大小设置缓冲大小&nbsp;<br style="box-sizing: border-box;"  />* 设置分页开始位置&nbsp;<br style="box-sizing: border-box;"  />* 主存分页管理&nbsp;<br style="box-sizing: border-box;"  />* 陷阱门初始化&nbsp;<br style="box-sizing: border-box;"  />* 块设备初始化&nbsp;<br style="box-sizing: border-box;"  />* 字符设备初始化&nbsp;<br style="box-sizing: border-box;"  />* tty初始化&nbsp;<br style="box-sizing: border-box;"  />* 时间初始化&nbsp;<br style="box-sizing: border-box;"  />* 调度初始化&nbsp;<br style="box-sizing: border-box;"  />* 缓冲管理初始化&nbsp;<br style="box-sizing: border-box;"  />* 硬盘和软盘初始化&nbsp;<br style="box-sizing: border-box;"  />* 创建进程0（此时0特权级切换为3特权级）&nbsp;<br style="box-sizing: border-box;"  />* 进程0创建进程1（init进程）&nbsp;<br style="box-sizing: border-box;"  />* 进程1打开标准输入标准输出和标准错误&nbsp;<br style="box-sizing: border-box;"  />* 创建进程2执行shell&nbsp;<br style="box-sizing: border-box;"  />* 循环创建进程执行登陆shell</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">我们知道新建进程都是调用fork函数实现的，那下面我们看看第一个进程是怎么创建出来的。</span></p><h3 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 16px;">二、main.c代码分析</span></strong></span></h3><h3 style="margin-top: 0.8em; margin-bottom: 0.8em; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; text-align: justify; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">下面我们分析main.c的代码：</span></h3><p><span style="font-size: 16px;"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAAYQAAABZBAMAAADMRE6lAAAAElBMVEXx8fHu7u7d3d35+fkzMzMAAIiPpcxUAAADeklEQVR42u2bDXK0IAyGe4XOeIMeATjATnIDhvtf5YMEFFzX5dPAsjPEtjj8KI8EzSv25+f77be0P/V1NhFGsIkwgk2EEWwijGC9EPRpKXwDwnkndd1BbiDYdc/wX1dkvjIEpdH3DxjB7gvjjiDCUiKYIinN1Bya+u07B7roI5PodVx0rCmAsGAbhABxhJBMECEfBeOscS44TEicP6tznK+MdYTgM52x7FNsiNpvPvHuA+QoBUJs4MLRfA0MvuQbgA7OJo9g/WbWhP6adPndlmkNVUlXMzgHZMluFLjBNgqhSAO7VINRsOwsbkNQCaHk4ovKo+B7pSkBus4HCOoJgds0QAinop+3CDY7FqTuhA6BrkXAJghnjrRHSBBrZ3eORDB8U40IGgqEcrZLIdDk5bnsk+As7C8+w9BGmWHbprPmCazj0wARMMxXTM+F2MA7achI09lPf0AphAXx9tNZ15XAvhTUDZMJMPzVpIcsVtWuq9UZ4aM2EUawiTCCTYQRbAztXFPh4wggUOMOgl335LRzEwR8dNTOz3bZk7Iwj0JVeYRj7dwcoZt29hs3EEH4zRDaa+eyJtyRPTnCNhfaa2fqNFLC+kgEoat2Bh4A4NcXxCyA8OipnZ8dCe4j5NO5k3am8tRAAqGrdob6pvUIXbVzZc2OCB+1iTCCTYQRbCKMYMNo5+uHGkc7Xz5WB+3MgWtNg/x8HHvxFQ+xOP1yJPYaoZV2RjjRzvCqrckQ1iAYjsRRe+28JhcQUFOYGxHi6mgdgqR2TkmhnVOVEJL7jlKQqEIUr2Jgz+eLnznEOJ7FyAnC77I5kqR2XpMj7bxppHjaqIrS+SLCNgoKzxDyUbBy2jlHyBZtgd9iFAjGqBLh2ZHU2VzIESS18zFC9Ik3COV0fouwVL6E+W/tvN1Un7Vz1gBeIODTHQlqEES1M3LB0bozORTVZIVtedY7mzkoFs8FRFX/XLhid9adoablUcYQ6840aq8ODeqNzUh1BJsII9hEGMEmQrXNb7ZrEV4GGHbda7Tu3Aih67ozyCAsbRCq1p2FEB4bQvN151CFovHj+PkiwpI5Urd1Z9xqCiN0+GY7DFJcuRVzpEc+nZuvO1O2NEK+4tll3Tlqep3eBNxHyG+qfdadfddp/gt+dt77m23YZ9wfhc7aef2fqps2I9URbCKMYBNhBPsHFgT7eM7fi+IAAAAASUVORK5CYII= " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricfCYLGsbm5eia4OSYTia2PjL5grGiaEpAHB2f4kY3DicH1un6giaeTRhoBgg"  data-ratio="0.22938144329896906" data-w="388"  /><br  /><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; font-size: 16px; background-color: rgb(255, 255, 255);">这几行代码以内嵌宏代码的形式实现了fork、pause、setup和sync函数的调用，我们前面说过了进程0不能使用栈空间，所以意味着进程0在不能直接调用函数。_syscall0通过触发0x80（系统调用）中断实现了函数的调用。</span></span></p><p><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricCtWb85Q3YZX7qgQTG9Cp7tyJV6xEE1cdTjDtR86BhyFebsISvljt9g"  data-ratio="0.6568627450980392" data-w="510"  /></p><p><span style="font-size: 16px;"><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; background-color: rgb(255, 255, 255);">先得到根设备的设备号，然后设置内存结束的位置（此时的内存是缓冲加上主存的全部大小），内存大小忽略不到4k字节的内容（一页大小是4k字节）。如果内存大小超过了16M字节则按16M字节计。根据内存的大小设置缓冲区的大小：如果内存大小大于12M，缓冲大小是4M；如果内存大小在6M～12M之间，缓冲大小是2M；否则缓冲大小是1M。&nbsp;</span><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"  /><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; background-color: rgb(255, 255, 255);">设置主存开始的位置是缓冲结束的位置，从主存开始的位置到主存结束的位置都是要分页管理的。此时我们看到了，缓冲并不需要分页。&nbsp;</span><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"  /><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; background-color: rgb(255, 255, 255);">最后条件编译的意思是：如果设置了虚拟内存盘，主存大小还要增加。</span></span></p><p><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; font-size: 16px; background-color: rgb(255, 255, 255);"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricXwRmLiaAlWh7oIGdUBQ4y7xFCvQkC2GkH32zR1WNSIdWhHwguzdtO4w"  data-ratio="0.6358695652173914" data-w="368"  /><br  /></span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">调用各个模块开始内核的初始化工作，这里解释一下为什么我们前面解释用内嵌的汇编实现系统调用，这里却可以调用函数了。我们前面说了特权级，特权级是保护模式下才有的概念。此时计算机是在保护模式下运行的，此时的当前特权级（CPL）是什么呢？我们知道CPL是存储在cs和ss的第0位和第1位。现在看看cs的值是多少？&nbsp;<br style="box-sizing: border-box;"  />cs是在什么时候赋值的呢？我们常常看到的汇编代码，第一步都是初始化ds，es，fs等等，并没有初始化cs的。实际上cs和ip都是可以赋值的，但是并不能想ds那样做。跳转指令负责给cs和ip寄存器赋值，我们想知道main的cs是多少，就要知道跳转到main的长跳转指令给cs赋了什么，通过猜测这个跳转指令在head.s中（main之前执行的程序）。分析head.s代码我们发现head把控制权交给main并不是通过长跳转指令，而是通过ret指令从栈中拿出main的地址。直接取得main的地址不太好理解，通过分析head的代码我们知道在head的执行中，特权级并没有发生改变（前面讲TSS的时候我们解释过，修改特权级需要修改TSS的内容），所以main的CPL和head的CPL是相同的。head的cs值是0x08，ss是0x10（cs在setup中，ss在head中设置），所以特权级是0.&nbsp;<br style="box-sizing: border-box;"  />其实并不需要这么复杂，启动的时候我们需要对一系列的硬件操作（关中断，开终端，打开8259引脚之类的），这肯定需要高特权级，所以特权级一定是0。解释完了特权级，接下来就是好理解了。&nbsp;<br style="box-sizing: border-box;"  /> 通过前面的一系列解释，main程序运行到现在还是在0特权级下运行的。此时并不是进程0，所以并不用担心弄乱进程0的堆栈这个问题，可以随意调用函数。</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">这些初始化模块的大致功能是：主存初始化，陷阱门初始化，块设备初始化，字符设备初始化，tty初始化，时间初始化，调度初始化，缓冲管理初始化，硬盘初始化，软盘初始化，开中断。各个模块初始化细节作者后面再写一系列文章展开分析，本文暂且不提。</span></p><p><img data-s="300,640" data-type="png" src="data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAAbUAAABqBAMAAADJm9KgAAAAD1BMVEXu7u7d3d35+fkzMzOIAADQ+bbdAAAD/0lEQVR42u2ci3GEIBCGnbGDVJABCnCWDhj6ryksT1FEvMtF1vCbiYqgfLcrL9FpWumLPUnf02CjqMFGU4ONpgYbTX2YjTN4LBsYusexyZ7Y5na2luzy+B9uZ5vlc9kO7calcS8JXHJpViGEW5/jwIG5PQk2RJooeMxH8Ww3+eW5TwIAt+WdXVkkzLDF9IG4524wzvk6sHO7BTaTaWvCLRuTzlqwZbMmpMPmQ3I2v71jA9b9/ZaxVXyywAa91wEcwBUiwHxZgpUX994pTRFjSw/pjkluyhfnpTaKY7u5LJml/Fyb6+5ysq1dYgzlWxzGNMGM+2MbAbtFox9AU4ONpgYbTQ22IF4OhNWRTRWn/gqkcKFrbFCqh/Pmfn5c/BVa6UINbMBC89GzhT3T1mxgU+yyNP7bpdtmX4QY6oxNLhW7QTZEANEBge361lfZ9plSrdZuZZttR+CQjWVsWXiVTQml9GfZ3BVKv+A5m4TQgfEYfkwER0gg9a15ws/zqWMGtMuA1hhoFqFwy6FrJfyPoM2mcTeMHI7ZBPiHUWICptwJ7RVqbNOx3aBgNz+YgN5Zs5vwVzbXVko4e+DK5AtXOtoo7PnfQwlnPp9A2UXgjaiEi2XP4tPqgzIrsS1tbCyy4QrO2IJPIpv7xYXNvvKIKzaV2Px9qtmGTeVsKrpEnW2eXmCTJ2wqeou1W7BlK5sPsLdTYIvAIvg4xlJVtqWBDYt7yOzmwA7rgJQ/IdjeJ0/YYgKW2S0lEG1slbIEhz5gxZZGSLh0qFU2FthiWeIKGG1k1z5QaH9rmhIDFwyxCYRLIDA6LiolUPsLldiaxksutrl+p1UisvOI0lnLF6LQVg73VWmvJgpsr2qw0dRgo6nBRlPvssGNz6A+zMbvfHb462yQrWiwVcdLirp3EsIFtvp4yf9gw9ETnFQCbtYC3P28voVtmht9ErtwfA3Vv92mVp8EN11hsPXB1lyW5Gwk6oDmskSCXXAERUa2PvneqN+sXJurc7Z32sqd3nKjH0BTg42mBhtN/W82efWU3eicrdOK+RLbMtgI6bzf/QC25bAfAHfn8V22+cE++WS25cFsx/MU6LM9uw44stuT21x0NdhoarDR1GCjqcFmBX5daaj0NduknS1lGypRgPWjEzaeWlx02Q76AVAiOnQ86KtlnfqmRbtBafMZbKtXb3ZP78Mx+wUCCJ8l6Gm2SfLJ5cBu4eMkKcfhhbH1ZyHWD/h7UbLbXGGDAzb8IA1u5LOEelEqJ19h495g/usfnbKd221bYhZ8stc6oMi2/jhJetUNVsfsQfe5pO5mm0SfPJ9fEt4pKr+h6KJ0NdvkUlsZ1kSbr5ckdXPLjX4ATQ02mvr+ASePlmk0K5hSAAAAAElFTkSuQmCC " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricLmfUzaKABnJicrT8iaZicEiaRCNe7ev6xy8ukuJYzyqeYY6XfhkcNg1mZQ"  data-ratio="0.2425629290617849" data-w="437"  /><br  /></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">这里我们着重介绍函数move_to_user_mode，这个函数执行完了以后程序就以进程0的身份运行了，进程0创建进程1，进程1执行init函数，而进程1的父进程也就是进程0循环执行pause函数。</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">这里说一个问题，我之前在看的时候，看到这里非常不能理解，为什么pause函数还是要通过触发中断的方式调用，进程1不是已经创建结束了吗？这里需要澄清一个我之前的误会，之前作者以为进程0是在特权级0下运行的，所以进程0创建进程1是在0特权级下进行的。我们知道，在内核态创建的进程并不需要COW机制，是直接分配空间的，所以作者觉得，只要fork函数通过触发中断的形式的调用就可以。因为fork结束了以后，子进程已经有了自己的运行空间了。后来分析了函数move_to_user_mode以后，发现进程0是在3特权级下运行的。所以，进程0创建进程1以后自己调用pause函数为什么还是通过触发中断，虽然在用户空间创建的进程并不会直接分配空间，但是只要父进程要修改自己的内容，还是会出发COW机制，分配空间给子进程啊？&nbsp;<br style="box-sizing: border-box;"  />这里main.c程序的main函数已经解释完了，进程0的功能我们也已经分析完了，下面看init进程.&nbsp;<br style="box-sizing: border-box;"  />创建进程0这里不是很好理解，作者再啰嗦一次，要理解这个，前面说的TSS的介绍一定要仔细看看。&nbsp;<br style="box-sizing: border-box;"  />这个函数的定义如下：</span></p><p style="box-sizing: border-box; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricawXmGBQFWLJshicBibdNnBTOrDAGXUGg56EqPXiaJKym8zGDCttTO2dMQ"  data-ratio="0.8111111111111111" data-w="360"  /><br  /><span style="font-size: 16px;"><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; background-color: rgb(255, 255, 255);">这个函数要实现特权级切换，在这个函数之前main在0特权级下运行。这个函数结束以后，进程0在3特权级下运行。我们前面介绍特权级切换的时候介绍，调用iret指令从高特权级切换到低特权级的CPU的操作是从当前任务TSS中特权级3对应的栈中拿出对应的堆栈信息。这个进程是一个特殊的特例，我们需要自己先把这个信息填充进去。&nbsp;</span><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"  /><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; background-color: rgb(255, 255, 255);">move_to_user_mode函数定义是一端内联汇编，没有输入和输出部分，破坏描述部分是ax。前面的一系列push指令就是实现这个功能，分别的ss入栈，esp入栈，eflags入栈，cs入栈，ip入栈，调用iret指令切换特权级，初始化ds，es，fs，gs。&nbsp;</span><br style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);"  /><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; background-color: rgb(255, 255, 255);">解释完了move_to_user_mode以后，我们看进程1的执行函数，init函数。代码如下：</span></span></p><p><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; font-size: 16px; background-color: rgb(255, 255, 255);"></span><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricdx7W1JtRXD2t7XBmMS4NeQTy3ouSu1pcXdh2UrcGRsu6geYROibK8HQ"  data-ratio="0.4516765285996055" data-w="507"  /></p><p><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; font-size: 16px; background-color: rgb(255, 255, 255);">setup函数读取硬盘参数和安装根文件，然后打开终端，这是系统打开的第一个文件，得到的文件描述符是0，这表示把标准输入定向到终端文件，两次dup函数分别得到描述符1和描述符2。这就意味着得到了标准输入、标准输出和标准错误。输出一些提示信息。</span></p><p><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; font-size: 16px; background-color: rgb(255, 255, 255);"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricdBPiciceeT8wuHLgUVFjcRJvbIibVkWSuMzRLwBLw4xQOYInTS1kyITbg"  data-ratio="0.6408668730650154" data-w="323"  /><br  />进程1创建进程2，进程2先关闭0，然后打开文件/etc/rc，返回的文件描述符是0，把输入定向到rc文件。然后调用函数execve函数执行shell，传入参数列表和环境变量。进程1阻塞等待进程2结束，进程1有很多个子进程，wait函数只要收到一个进程结束就停止阻塞状态，wait函数并不能直接实现等待指定子进程结束。</span></p><p><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; font-size: 16px; background-color: rgb(255, 255, 255);"><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0EowmN0Ib9VfcIsCrY814ricjsJVm439t0RZxllIjvVSIBaKibFKU2oeDjSe8iaRibtA3yLO1Lux4Quvg"  data-ratio="0.805019305019305" data-w="518"  /><br  /></span></p><p style="box-sizing: border-box; margin-bottom: 1.1em;"><span style="font-size: 16px;">进程2结束运行了，执行到这里init进程一直循环创建新进程， 创建的子进程关闭从父进程（init进程）继承来的三个文件描述符（这里我猜测是因为子进程要创建一个新的会话组，要切断和其他的终端设备的联系），创建一个新的会话。重新和终端设备建立联系，新进程调用execve函数执行登陆shell。init进程阻塞等待子进程退出，输出一行提示信息,调用sync函数刷新文件系统缓冲，init再去创建一个新进程，执行刚才的操作，构成一个死循环。&nbsp;<br style="box-sizing: border-box;"  />这里main.c程序就分析结束了。&nbsp;<br style="box-sizing: border-box;"  />这里有一点不理解，为什么新进程创建了一个会话以后还要和一个终端建立联系，后面不是要调用execve函数了吗？子进程的资源不是基本上全部被抛弃了吗？</span></p><p><span style="color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; background-color: rgb(255, 255, 255);"><br  /></span></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_reward_area" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_reward_avatar">
                        <img src="" alt="" id="js_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" style="display: none;" id="js_reward_author">张释文</div>
                                                            <p class="reward_button_wrp">
                      <span id="js_author_reward_qrcode" class="reward_pop_panel">
                        <img id="js_author_reward_qrcode_img" src="" alt="赞赏二维码">
                        <strong>微信扫一扫赞赏作者</strong>
                      </span>
                        <a class="reward_button" id='js_reward_link' href="##"><span id="js_reward_link_text">赞赏</span></a>
                    </p>
                    <div id="js_reward_inner" class="reward_area_inner" style="display:none;">
                        <p class="weui-loadmore weui-loadmore_line reward_user_tips" id="js_reward_total_parent">
                          <span class="weui-loadmore__tips">
                            <a href="javascript:;" id="js_reward_total"></a>&nbsp;<span id="js_reward_total_text">人赞赏</span>
                        </span>
                        </p>
                        
                        <div id="js_reward_list" class="reward_user_list"></div>
                        <div id="js_reward_pagination" class="simple_pagination" style="display: none;">
                          <button disabled class="btn_sp_prev js_reward_pagination_prev">上一页</button>
                          <span class="sp_page_num_area">
                            <a class="sp_page_current js_reward_pagination_curpage" href="javascript:;">1</a>&#47;<span class="sp_page_num js_reward_pagination_totalpage">3</span>
                          </span>
                          <button class="btn_sp_next js_reward_pagination_next">下一页</button>
                        </div>
                    </div>
                </div>
                                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='http://i.ijrou.com' target='_blank'>
			我的博客
		</a>
	</div>
</body>