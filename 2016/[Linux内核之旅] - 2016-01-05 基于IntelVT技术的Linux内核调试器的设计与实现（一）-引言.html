<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		基于IntelVT技术的Linux内核调试器的设计与实现（一）-引言
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=415101682&amp;idx=1&amp;sn=2f6c8cb461b57c599cbb2fa6653c10c4&amp;chksm=7622df1741555601fe67e4f28e9779463146edafde0cca038d93ad7a32372e664244cb531811&amp;scene=27#wechat_redirect&cpage=81' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">基于IntelVT技术的Linux内核调试器的设计与实现（一）-引言</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                        MXP
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2016-01-05</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p><strong><span style="color: rgb(2, 30, 170);">前言：这是几年前学生做的本科毕业设计，因为作者深厚的计算机基础，擅长在Winodow下内核级的开发，当他把这个调试器移植到Linux内核下时，依然达到了预期的效果，其中的一些做法或许对你有所启发。</span></strong></p><p><br  /></p><p><strong>摘要：</strong><span style="text-indent: 32px; line-height: 1.6; font-family: 宋体;">传统调试器在特殊领域的应用具有一定困难。如果程序拥有反调试机制，那么就首先就需要破解他的反调试机制。而且</span><span style="text-indent: 32px; line-height: 1.6;">Linux</span><span style="text-indent: 32px; line-height: 1.6; font-family: 宋体;">平台内置的内核调试器</span><span style="text-indent: 32px; line-height: 1.6;">KDB</span><span style="text-indent: 32px; line-height: 1.6; font-family: 宋体;">使用方法过于复杂，需要重新编译内核。其它一些第三方内核调试器同样不能很好地应用于特殊领域，有一些存在兼容性问题，有一些同样存在易用性的问题，有一些已经停止开发。</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">国外</span><span style=";font-size:16px">hyperdbg</span><span style=";font-family:宋体;font-size:16px">项目是一款基于</span><span style=";font-size:16px">Intel </span><span style=";font-family:宋体;font-size:16px">硬件虚拟化技术的内核调试器。该调试器使用硬件虚拟化技术达到隐藏自身的目的，支持</span><span style=";font-size:16px">Windows</span><span style=";font-family:宋体;font-size:16px">和</span><span style=";font-size:16px">Linux</span><span style=";font-family:宋体;font-size:16px">操作系统。但是一直以来项目开发进度慢，接口不友好，功能单一，只有简单的单步命令和断点命令，对调试符号支持不好，很难将其应用于实际工作中。</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">基于以上几点，针对特殊领域的应用，有必要开发一款具有反侦测功能、简单易用的内核调试器。</span><span style=";font-size:16px">VMXICE</span><span style=";font-family:宋体;font-size:16px">调试器就是一款基于</span><span style=";font-size:16px">Linux</span><span style=";font-family:宋体;font-size:16px">的内核调试器，同样使用了硬件虚拟化技术，将当前运行的操作系统运行级别降低为</span><span style=";font-size:16px">GUEST</span><span style=";font-family:宋体;font-size:16px">，而调试器运行级别为</span><span style=";font-size:16px">HOST</span><span style=";font-family:宋体;font-size:16px">，这样一来，不修改中断向量表就可以实现监视和拦截调试中断。操作系统被放置于</span><span style=";font-size:16px">GUEST</span><span style=";font-family:宋体;font-size:16px">，并不能探测在位于</span><span style=";font-size:16px">HOST</span><span style=";font-family:宋体;font-size:16px">的调试器软件，这样的做法被证明可以很好地将调试器隐藏。</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px"><br  /></span></p><p style="text-indent:32px"><br  /></p><h1 style="margin-bottom:21px"><span style="color: rgb(2, 30, 170);"><span style="font-weight: bold; font-size: 20px;">1 </span><span style="font-family: 黑体; font-weight: bold; font-size: 20px;">引言</span></span></h1><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">硬件辅助虚拟技术，顾名思义就是硬件支持虚拟化，一般特指</span><span style=";font-size:16px">CPU</span><span style=";font-family:宋体;font-size:16px">的虚拟化。物理</span><span style=";font-size:16px">CPU</span><span style=";font-family:宋体;font-size:16px">虚拟出一个虚拟</span><span style=";font-size:16px">CPU</span><span style=";font-family:宋体;font-size:16px">给客户机使用，并且提供特权级保护支持，虚拟机软件不必关心指令的解析以及特权指令造成的安全问题。这种技术方便了虚拟机的开发，同时也提升了虚拟机的性能。</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">硬件虚拟化技术除了可以提高虚拟机性能外还有很多其它的用途，例如软件加密与保护，还可以被恶意程序利用。在</span><span style=";font-size:16px">2006</span><span style=";font-family:宋体;font-size:16px">年</span><span style=";font-size:16px">8</span><span style=";font-family:宋体;font-size:16px">月</span><span style=";font-size:16px">3</span><span style=";font-family:宋体;font-size:16px">日的拉斯韦加斯的黑帽大会上，</span><span style=";font-size:16px">COSEINC</span><span style=";font-family:宋体;font-size:16px">的安全研究员</span><span style=";font-size:16px">Joanna Rutkowska</span><span style=";font-family:宋体;font-size:16px">演示了一个叫做</span><span style=";font-size:16px">Blue Pill</span><span style=";font-family:宋体;font-size:16px">的恶意程序，该程序使用硬件虚拟化技术侵入</span><span style=";font-size:16px">Windows</span><span style=";font-family:宋体;font-size:16px">操作系统底层并完美地隐藏起来，所有的</span><span style=";font-size:16px">Anti Rootkit</span><span style=";font-family:宋体;font-size:16px">工具均无法检测其存在。</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">硬件虚拟化技术还可以应用到调试与反调试领域。很多恶意程序都有反调试功能，而基于硬件虚拟化技术的调试器作为</span><span style=";font-size:16px">VMM</span><span style=";font-family:宋体;font-size:16px">，可以优于操作系统响应并拦截调试异常，完美地将自己隐藏起来，被调试的代码很难进行反调试。难以被检测是基于硬件虚拟化技术的调试器最主要的优点。</span></p><p><img data-s="300,640" data-type="png" src="data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAAb4AAADfAQAAAAChKYsPAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAAB3YoTpAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAADJ0RVh0UmF3IHByb2ZpbGUgdHlwZSBleGlmAApleGlmCiAgICAgICA2CjQ1Nzg2OTY2MDAwMAr5vKEOAAAEZ0lEQVRo3u3aYWgbVRwA8Ei1+yKtgtp+sEt1oEK/KVKlSC3rV3Hih2pD6cBvK2YybVPIkku14FiRfRAngqzgF4XadTCu55Ze3slEQT9oka1ll7uXIUMxzV1maV7l9e55JGlyTS539x5M2HL/T8klP/4veS/37p//hQhb7IUCGMAAtoaaiXSSJMbBV5AfiEsdmbV+arjZJ83IprhMDVUjZi5ITz7lDc3udAZC0yC4DC/sRn+UTSL4gETMwK1DidmRMjzWJc2c7S+GvGGu8wkRFgQjHilDxciX8FUTeUMNCaJi9KReOlqG2d6p0sJVA3vDv8LCFfkTwSAnyxCCfGkp/Z6P6dDQ5/xG4bGR3AOVoXIDpxa+mPAxHfqhQfHXApo29Mp0zMrT+OsvfUyHluHFxULPNEaVoYpr8W2i+Mj498rl05OFsZnciMsid4Jbi6uiervn+XSEEqpAVNQ8er06Hf7hbx0vKDn0J6HOaAsvmArVo5sGAtsRPYAB/F/gcQOYhxEDjBpgzsQsGfEcNiSOGu4N40mUiDFkHD0Fpd0oA3x86hpOsgx1NA6RmGfIGMdQ6p1igKGh7w3CkvEEhgoYoP+MJBKH4qZMD82hNPzXWGPIWIsABtAJ2rbeUJhQ7Mic7SgkFNcAAQygA/S35C4lIemOH4DA9l69JRSSUCIJBngpIRlmbpgammFjBWfSDBm/evlk7vQgRw/P8rcMcJxhqE+/omN1h2GooqHnHn6RAab6ciZhycgndA1+BujhsqirW+8ywD5F3zNV+m+1HgegVcMDNkhENmjV8Gv9P3D00Krh04LLRWBLaNXwAmKBVg3PBq0aXihqLBkzvIBYoFXDx5igVcOnBRfovCODcg2ffecOob8GsGp4WH5MC2sRwDaEzH/LtIx7Ejr/Hn1AznYUtg3cDTmEH4gdEpkBpIS41veghvt9D2q43/eghKnewWrfgxKm1UK170EJr2SPlip9DxvkVIPosHaadISr2dVq38MOYVKKbcyHcWXGHOHKeKHa97DDzS6Z2+ABOvPIEdACLo7L1b5HHRY7Osn6bMf8sK58+ixsAYHK/1Ppe9QhiivfyRwsEXeo7VT6HjY4dCa5Pno4FNbzLvDCYrXvUYcl+bwKY5Mq0fNLY5Bike/kJzLrsUnA0cLtfCR5PRZ9MEwLEb6ReeP9AWs60NIYoIKKCj7Ynh/G6Lk3ORq4/bue5DDvuuScYGO0KWzekX3CxmgP6HNHboauEcD2gHezOduy1PWCnO0oDGAAa7Cwf06khcu7r3IeUN6/negA/LbrZvGjR11hpJhygB9elDQl7Qrf6uNvdR5phCcu3oQe8KGJOSUda4TRb8Y9oHl9ggfN8HZUgtfcoXLMCf4SxRC6D/VnZQ583ASf0SQveF5BADTBghbX3KH5mpWxGebfxnfO/eS+ALJIaYY6SHHlx63hjcvoj/A5Qr/IIVd9RgtrEcD7Dd7N5izzn12NEcAA3kcwRB0d99wt0wFsBf8Dj9Y+7Xsvh5YAAAAASUVORK5CYII= " src="SeWfibBcBT0H554dHnwSDHtbJHIVA2eRibkibxLPYRoHDSZLWbceAmFLFziaOI4wkib0sSqDuibWzJ0ib5M8yTUlRPB3A"  data-ratio="0.5" data-w="446"  /><br  /><span style=";font-family:宋体;font-size:16px"> </span></p><p><span style=";font-family:宋体;font-size:16px">图</span><span style=";font-size:16px">1-1 </span><span style=";font-family:宋体;font-size:16px">传统内核调试器、虚拟化调试器与操作系统层次对比</span></p><p style="text-indent:32px"><span style=";font-size:16px">2010</span><span style=";font-family:宋体;font-size:16px">年</span><span style=";font-size:16px">Aristide Fattori</span><span style=";font-family:宋体;font-size:16px">等人建立</span><span style=";font-size:16px">hyperdbg</span><span style=";font-family:宋体;font-size:16px">开源项目，该项目基于</span><span style=";font-size:16px">New Blue Pill</span><span style=";font-family:宋体;font-size:16px">部分代码，最初实现了一个基于</span><span style=";font-size:16px">Intel VT-x</span><span style=";font-family:宋体;font-size:16px">技术的</span><span style=";font-size:16px">Windows</span><span style=";font-family:宋体;font-size:16px">内核调试器，后来又支持</span><span style=";font-size:16px">Linux</span><span style=";font-family:宋体;font-size:16px">操作系统，但一直以来该项目进度迟缓，调试器功能单一且</span><span style=";font-size:16px">Bug</span><span style=";font-family:宋体;font-size:16px">太多，无法进行实际应用。本文重新设计了一个基于</span><span style=";font-size:16px">Intel VT-x</span><span style=";font-family:宋体;font-size:16px">的内核调试器，名字叫</span><span style=";font-size:16px">VMXICE</span><span style=";font-family:宋体;font-size:16px">，实现了调试器的基本功能以及符号的解析，满足对</span><span style=";font-size:16px">Linux</span><span style=";font-family:宋体;font-size:16px">内核模块的调试需求。</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px"><br  /></span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px"></span></p><h1 style="margin-bottom:21px"><span style="color: rgb(2, 30, 170);"><span style="font-weight: bold; font-size: 20px;">2 Intel VT-x</span><span style="font-family: 黑体; font-weight: bold; font-size: 20px;">技术简介</span></span></h1><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">支持</span><span style=";font-size:16px">VT-x</span><span style=";font-family:宋体;font-size:16px">技术的</span><span style=";font-size:16px">CPU</span><span style=";font-family:宋体;font-size:16px">有两种运行模式，</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">模式和非</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">模式。</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">模式就是支持</span><span style=";font-size:16px">VT</span><span style=";font-family:宋体;font-size:16px">技术的主要模式，而非</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">模式则与不支持</span><span style=";font-size:16px">VT-x</span><span style=";font-family:宋体;font-size:16px">技术的</span><span style=";font-size:16px">CPU</span><span style=";font-family:宋体;font-size:16px">运行模式完全相同。而</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">模式又分为两种操作模式，</span><span style=";font-size:16px">VMX root</span><span style=";font-family:宋体;font-size:16px">模式和为</span><span style=";font-size:16px">VMX non-root</span><span style=";font-family:宋体;font-size:16px">模式，</span><span style=";font-size:16px">VMX root</span><span style=";font-family:宋体;font-size:16px">模式是提供给</span><span style=";font-size:16px">VMM</span><span style=";font-family:宋体;font-size:16px">使用的，在这种模式下可以调用</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">指令集，</span><span style=";font-size:16px">VMM</span><span style=";font-family:宋体;font-size:16px">用以创建和管理虚拟机。而</span><span style=";font-size:16px">VMX non-root</span><span style=";font-family:宋体;font-size:16px">模式就是虚拟机运行的模式，这种模式不支持</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">指令集。</span></p><p style="text-indent:32px"><span style=";font-size:16px">VT</span><span style=";font-family:宋体;font-size:16px">技术有两种转换，分别为</span><span style=";font-size:16px">VM Entry</span><span style=";font-family:宋体;font-size:16px">和</span><span style=";font-size:16px">VM Exit</span><span style=";font-family:宋体;font-size:16px">。</span><span style=";font-size:16px">VM Entry</span><span style=";font-family:宋体;font-size:16px">就是从</span><span style=";font-size:16px">VMX root</span><span style=";font-family:宋体;font-size:16px">模式切换到</span><span style=";font-size:16px">VMX non-root</span><span style=";font-family:宋体;font-size:16px">模式，简单的说，就是</span><span style=";font-size:16px">VMM</span><span style=";font-family:宋体;font-size:16px">切换到虚拟机这个转换过程。</span><span style=";font-size:16px">VM Exit</span><span style=";font-family:宋体;font-size:16px">就是从</span><span style=";font-size:16px">VMX non-root</span><span style=";font-family:宋体;font-size:16px">模式切换到</span><span style=";font-size:16px">VMX root</span><span style=";font-family:宋体;font-size:16px">模式，同理可理解为从虚拟机返回到</span><span style=";font-size:16px">VMM</span><span style=";font-family:宋体;font-size:16px">这个过程。</span></p><p><img data-s="300,640" data-type="png" src="data:image/PNG;base64,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 " src="SeWfibBcBT0H554dHnwSDHtbJHIVA2eRibuYkdyRkcfclk6ibA7wznLGSh6OUsEwymjq6Lc26u8vXg4RvbkeS7KDA"  style="" data-ratio="0.37333333333333335" data-w="450"  /><span style="line-height: 1.6; font-family: 宋体;"> </span></p><p><span style=";font-family:宋体;font-size:16px">图</span><span style=";font-size:16px">2-1 VMM</span><span style=";font-family:宋体;font-size:16px">与客户机的切换</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">另外每个硬件虚拟的</span><span style=";font-size:16px">CPU</span><span style=";font-family:宋体;font-size:16px">都有一个表示其状态以及控制其特性的结构，</span><span style=";font-size:16px">VT-x</span><span style=";font-family:宋体;font-size:16px">技术的叫做</span><span style=";font-size:16px">VMCS</span><span style=";font-family:宋体;font-size:16px">。该结构包含</span><span style=";font-size:16px">3</span><span style=";font-family:宋体;font-size:16px">个部分：版本标志、</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">退出原因、数据区。而数据区则包含大量与</span><span style=";font-size:16px">CPU</span><span style=";font-family:宋体;font-size:16px">状态和控制相关的信息，包括虚拟机状态保存区（各种寄存器）、宿主机状态保存区、虚拟机运行控制域、</span><span style=";font-size:16px">VM Entry</span><span style=";font-family:宋体;font-size:16px">行为控制域、</span><span style=";font-size:16px">VM Exit</span><span style=";font-family:宋体;font-size:16px">行为控制域、</span><span style=";font-size:16px">VM Exit</span><span style=";font-family:宋体;font-size:16px">信息域。</span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px">支持</span><span style=";font-size:16px">VT-x</span><span style=";font-family:宋体;font-size:16px">技术的指令集叫做</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">指令集，该指令集总共有</span><span style=";font-size:16px">10</span><span style=";font-family:宋体;font-size:16px">条指令，详见附录<span style="font-family:宋体">。</span></span></p><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px"><br  /></span></p><h1 style="margin-bottom:21px"><span style=";font-family:黑体;font-weight:bold;font-size:20px">附录<span style="font-family:Times New Roman"> </span><span style="font-family:黑体">指令集：</span><span style="font-family:Times New Roman">VMX</span></span></h1><p><span style=";font-family:宋体;font-size:16px">表</span><span style=";font-size:16px">2-1 VMX</span><span style=";font-family:宋体;font-size:16px">指令集</span></p><table width="497"><tbody><tr style="height:19px"><td width="133" valign="top" style="padding: 0px 7px; border-width: 2px 43px 1px; border-left-style: none; border-color: windowtext rgb(255, 255, 255); border-right-style: none; background: rgb(204, 204, 204);"><p><span style=";font-family:宋体;font-size:16px">指令</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-width: 2px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext; background: rgb(204, 204, 204);"><p><span style=";font-family:宋体;font-size:16px">作用</span></p></td></tr><tr style="height:21px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMPTRLD</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style="font-family:宋体;font-size:16px">加</span><span style=";font-size:16px">载</span><span style="font-family:宋体;font-size:16px">一</span><span style=";font-size:16px">个<span style="font-family:Times New Roman">VMCS</span><span style="font-family:宋体">结</span></span><span style=";font-family:宋体;font-size:16px">构体指</span><span style=";font-size:16px">针</span><span style="font-family:宋体;font-size:16px">作</span><span style=";font-size:16px">为当</span><span style=";font-family:宋体;font-size:16px">前操作</span><span style=";font-size:16px">对</span><span style="font-family:宋体;font-size:16px">象</span></p></td></tr><tr style="height:24px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMPTRST</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-family:宋体;font-size:16px">保存</span><span style=";font-size:16px">当</span><span style="font-family:宋体;font-size:16px">前</span><span style=";font-size:16px">VMCS<span style="font-family:宋体">结</span></span><span style=";font-family:宋体;font-size:16px">构体指</span><span style=";font-size:16px">针</span></p></td></tr><tr style="height:17px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMCLEAR</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-family:宋体;font-size:16px">清除</span><span style=";font-size:16px">当</span><span style="font-family:宋体;font-size:16px">前</span><span style=";font-size:16px">VMCS<span style="font-family:宋体">结</span></span><span style=";font-family:宋体;font-size:16px">构体</span></p></td></tr><tr style="height:19px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMREAD</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">读<span style="font-family:Times New Roman">VMCS</span><span style="font-family:宋体">结</span></span><span style=";font-family:宋体;font-size:16px">构体指定域</span></p></td></tr><tr style="height:20px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMWRITE</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">写<span style="font-family:Times New Roman">VMCS</span><span style="font-family:宋体">结</span></span><span style=";font-family:宋体;font-size:16px">构体指定域</span></p></td></tr><tr style="height:13px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMCALL</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style="font-family:宋体;font-size:16px">引</span><span style=";font-size:16px">发</span><span style="font-family:宋体;font-size:16px">一</span><span style=";font-size:16px">个<span style="font-family:Times New Roman">VM Exit</span></span><span style=";font-family:宋体;font-size:16px">事件，返回到</span><span style=";font-size:16px">VMM</span></p></td></tr><tr style="height:5px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMLAUNCH</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">启动</span><span style="font-family:宋体;font-size:16px">一</span><span style=";font-size:16px">个虚拟</span><span style="font-family:宋体;font-size:16px">机</span></p></td></tr><tr style="height:5px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMRESUME</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">从<span style="font-family:Times New Roman">VMM</span></span><span style=";font-family:宋体;font-size:16px">返回到</span><span style=";font-size:16px">虚拟</span><span style="font-family:宋体;font-size:16px">机</span><span style=";font-size:16px">继续运</span><span style="font-family:宋体;font-size:16px">行</span></p></td></tr><tr style="height:5px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMXOFF</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style=";font-family:宋体;font-size:16px">退出</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">操作模式</span></p></td></tr><tr style="height:5px"><td width="133" valign="top" style="padding: 0px 7px; border-left-width: 43px; border-left-style: none; border-left-color: rgb(255, 255, 255); border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 2px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">VMXON</span></p></td><td width="364" valign="top" style="padding: 0px 7px; border-left-style: none; border-right-width: 43px; border-right-style: none; border-right-color: rgb(255, 255, 255); border-top-style: none; border-bottom-width: 2px; border-bottom-color: windowtext;"><p><span style=";font-size:16px">进</span><span style="font-family:宋体;font-size:16px">入</span><span style=";font-size:16px">VMX</span><span style=";font-family:宋体;font-size:16px">操作模式</span></p></td></tr></tbody></table><p style="text-indent:32px"><span style=";font-family:宋体;font-size:16px"> </span></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name">MXP</div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p class="reward_button_wrp">
                    
                      <span class="reward_pop_panel">
                        <img src="https://res.wx.qq.com/mpres/zh_CN/htmledition/pages/home/index/pic_mp_app4290ba.png" alt="">
                        <strong>扫一扫下载订阅号助手，用手机发文章</strong>
                      </span>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='https://www.52pojie.cn/' target='_blank'>
			吾爱破解论坛
		</a>
	</div>
</body>