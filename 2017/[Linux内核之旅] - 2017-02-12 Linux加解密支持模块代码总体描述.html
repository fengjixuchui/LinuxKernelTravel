<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		Linux加解密支持模块代码总体描述
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664603719&amp;idx=1&amp;sn=87e34766fe912f0fa01dfdf3025bd1da&amp;chksm=f04d8da2c73a04b43fc8f08d9f2ff70b1e404d16ec8eda79a8ff33aecbbf39143c72170056d1&amp;scene=27#wechat_redirect&cpage=48' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">Linux加解密支持模块代码总体描述</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                                                        <span class="rich_media_meta rich_media_meta_text">
                                                        于运超
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2017-02-12</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <h4><span style="font-size: 16px; color: rgb(2, 30, 170);"><span style="font-size: 16px; font-family: 宋体; font-weight: bold;">1.3.1.4.&nbsp;</span><strong><span style="font-size: 16px; font-family: 宋体;">算法的具体实现</span></strong></span></h4><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph"><span style="font-family: 宋体; font-size: 14px;">Linux<span style="font-size: 16px; font-family: 宋体;">内核加密算法的实现是通过内核模块动态加载实现的。使用内核模块实现算法可以丰富内核的加密算法，在加密时既可以使用内核里面已经实现的算法，同时也可以动态加载自己实现的算法。算法的具体实现主要通过定义在算法操作集</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">xxx_tfm</span><span style="font-size: 16px; font-family: 宋体;">和</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">xxx_alg</span><span style="font-size: 16px; font-family: 宋体;">中的定义的钩子函数完成。其中</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">xxx</span><span style="font-size: 16px; font-family: 宋体;">为具体的算法名称。这一类算法操作集里面主要定义的钩子函数有算法密钥的设置、加密、解密。操作集函数里面包含了密钥的设置、加解密操作。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph"><span style="font-family: 宋体; font-weight: bold; font-size: 16px; color: rgb(2, 30, 170);">1.3.2.&nbsp;内核算法</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph"><span style="line-height: 24px; font-family: 宋体; font-size: 14px;">Linux内核中具体算法的实现在<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto</span>中，从独立的<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto</span>文件就可以看出加密在<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">linux</span>内核里面的重要性，具体分析算法<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">MD5</span>，研究内核是如何实现加密的。具体代码参见<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">linux-3</span>.5.4/crypto/md5.c。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">从</span>md5.c<span style="font-size: 16px; font-family: 宋体;">可以看出，在内核中加密算法的实现是通过内核模块的形式实现的。为什么不直接在内核实现</span>?<span style="font-size: 16px; font-family: 宋体;">如果在内核直接实现有其以下几个缺点：</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">1. 增加了内核的“体积”；</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">2. 如果在现有的内核中再新增或删除算法时，将不得不重新编译内核。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;">&nbsp;Linux<span style="font-size: 16px; font-family: 宋体;">内核模块主要由以下几部分组成</span></span><sup><span style="font-size: 16px; vertical-align: super;">[2]</span></sup><span style="font-size: 16px; font-family: 宋体;">：</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">1. 模块加载函数（必须）。当通过<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">insmod</span>命令加载模块时，模块的加载函数会自动被内核执行，完成相关初始化工作。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">2. 模块的卸载函数（必须）。当通过<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">rmmod</span>命令卸载模块时，模块的卸载函数会自动被内核执行，完成模块的卸载工作。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">3. 模块许可证声明（必须）。模块许可证<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">LICENSE</span>声明了内核模块的许可权限，如果不声明<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">LICENSE</span>则在内核加载时会收到内核污染的警告。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">4. 模块参数（可选）。模块参数是指模块在加载时可以传入参数。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">5. 模块的导出（可选）。和内核中函数导出类似，在有<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">EXPORT_SYMBOL</span>（）导出函数或变量后就可以被其他模块使用。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">6. 模块的其他信息（可选）。比如模块的作者<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">MODULE_AUTHOR(</span>“<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">XXX</span>”<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">)</span>，模块的功能描述以及模块的版本等。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">了解算法以何种形式在内核出现，实现算法需要注意哪些操作。首先要了解这个算法的实现原理，比如</span>MD5<span style="font-size: 16px; font-family: 宋体;">是一种</span>Hash<span style="font-size: 16px; font-family: 宋体;">算法，它是以</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">512</span><span style="font-size: 16px; font-family: 宋体;">位的分组长度来处理消息，然后每一个分组又被划分为</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">16</span><span style="font-size: 16px; font-family: 宋体;">个</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">32</span><span style="font-size: 16px; font-family: 宋体;">位的子分组，最终产生</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">128</span><span style="font-size: 16px; font-family: 宋体;">位的消息摘要。接下来</span>MD5<span style="font-size: 16px; font-family: 宋体;">主要实现了算法操作集中定义的钩子函数。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">在算法里面实现了上述钩子函数之后通过向算法注册结构crypto_alg中成员变量填充赋值来实现算法。具体填充方式如下。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;"></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;">static struct </span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">shash_alg</span></a><span style="font-size: 16px;">&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">alg</span></a><span style="font-size: 16px;">&nbsp;= { </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">digestsize</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">MD5_DIGEST_SIZE</span></a><span style="font-size: 16px;">, </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">init</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">md5_init</span></a><span style="font-size: 16px;">, </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">update</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">md5_update</span></a><span style="font-size: 16px;">, </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">final</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">md5_final</span></a><span style="font-size: 16px;">, </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">export</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">md5_export</span></a><span style="font-size: 16px;">, </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">import</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">md5_import</span></a><span style="font-size: 16px;">, </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">descsize</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sizeof(struct </span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">md5_state</span></a><span style="font-size: 16px;">), &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-family: 宋体; font-size: 16px;">.</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">statesize</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sizeof(struct </span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">md5_state</span></a><span style="font-size: 16px;">), </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">base</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">.</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">cra_name</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"md5", &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-family: 宋体; font-size: 16px;">.</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">cra_flags</span></a><span style="font-size: 16px;"><span style="font-family: 宋体; font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;">=</span><span style="font-family: 宋体; font-size: 14px;">&nbsp;&nbsp;</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">CRYPTO_ALG_TYPE_SHASH</span></a><span style="font-size: 16px;">, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-family: 宋体; font-size: 16px;">.</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">cra_blocksize</span></a><span style="font-size: 16px;"><span style="font-size: 14px;">&nbsp;&nbsp;</span><span style="font-family: 宋体; font-size: 14px;">&nbsp;&nbsp;</span><span style="font-size: 14px;">= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">MD5_HMAC_BLOCK_SIZE</span></a><span style="font-size: 16px;">, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-family: 宋体; font-size: 16px;">.</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">cra_module</span></a><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style="font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">THIS_MODULE</span></a><span style="font-size: 16px;">, </span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-other;text-align:justify;text-justify:inter-ideograph;line-height:16px"><span style="font-size: 16px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">后操作就是模块的加载卸载操作，加载模块时注册算法，使用crypto_register_xxx进行算法注册，其中<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">xxx</span>为具体算法名称或该算法属于哪一类算法。卸载模块时使用<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto_unregister_xxx</span>注销算法。这样一个完整的算法就实现了。</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">另外内核中实现加密算法模块还有另一种形式。以</span>ablkcipher<span style="font-size: 16px; font-family: 宋体;">异步分组算法进行具体分析。具体源码参见</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">linux-3</span>.5.4/crypto/ablkcipher.c<span style="font-size: 16px; font-family: 宋体;">。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">Ablkcipher<span style="font-size: 16px; font-family: 宋体;">算法以内核模块的形式给出，但它不像上面提到的简单的对算法操作集</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">xxx_alg</span><span style="font-size: 16px; font-family: 宋体;">或</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto_alg</span><span style="font-size: 16px; font-family: 宋体;">进行填充，而是对结构体</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto_type</span><span style="font-size: 16px; font-family: 宋体;">中成员进行赋值，接下来其他操作和</span>MD5<span style="font-size: 16px; font-family: 宋体;">基本一致。结构体</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto_type</span><span style="font-size: 16px; font-family: 宋体;">包含的主要成员见表</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">1-1</span><span style="font-size: 16px; font-family: 宋体;">。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-numeric;text-align:center;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">表1-1 &nbsp;结构体<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto_type</span>中成员定义</span></p><table width="544"><tbody><tr><td width="335" valign="top" style="padding: 4px; border-width: 1px; border-color: windowtext;"><p style=";text-align:center"><span style="font-family: 宋体; font-size: 16px;">成员函数</span></p></td><td width="209" valign="top" style="padding: 4px; border-left-style: none; border-right-width: 1px; border-right-color: windowtext; border-top-width: 1px; border-top-color: windowtext; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style=";text-align:center"><span style="font-family: 宋体; font-size: 16px;">函数功能</span></p></td></tr><tr><td width="335" valign="top" style="padding: 4px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-numeric;text-align:center;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">(*ctxsize)(struct crypto_alg *alg, u32 type, u32 mask)</span></p></td><td width="209" valign="top" style="padding: 4px; border-left-style: none; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style="font-family: 宋体; font-size: 16px;">算法上下文大小</span></p></td></tr><tr><td width="335" valign="top" style="padding: 4px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-numeric;text-align:center;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">(*init)(struct crypto_tfm *tfm, u32 type, u32 mask)</span></p></td><td width="209" valign="top" style="padding: 4px; border-left-style: none; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style="font-family: 宋体; font-size: 16px;">算法操作的初始化 ，包括密钥设置、加密、解密操作</span></p></td></tr><tr><td width="335" valign="top" style="padding: 4px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-numeric;text-align:center;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">(*show)(struct seq_file *m, struct crypto_alg *alg)</span></p></td><td width="209" valign="top" style="padding: 4px; border-left-style: none; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style="font-family: 宋体; font-size: 16px;">输出内核算法里面的基本信息</span></p></td></tr><tr style="height:36px"><td width="335" valign="top" style="padding: 4px; border-left-width: 1px; border-left-color: windowtext; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:0;text-autospace:ideograph-numeric;text-align:center;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">(*report)(struct sk_buff *skb, struct crypto_alg *alg)</span></p></td><td width="209" valign="top" style="padding: 4px; border-left-style: none; border-right-width: 1px; border-right-color: windowtext; border-top-style: none; border-bottom-width: 1px; border-bottom-color: windowtext;"><p><span style="font-family: 宋体; font-size: 16px;">变量的初始化操作</span></p></td></tr></tbody></table><p><span style="font-family: Calibri; font-size: 16px;">&nbsp;</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">通过md5和<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">ablkcipher</span>可以总结出内核对算法实现的主要步骤：</span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">1. <span style="font-size: 16px; font-family: 宋体;">了解算法的实现原理。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">2. <span style="font-size: 16px; font-family: 宋体;">以内核模块实现。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">3. <span style="font-size: 16px; font-family: 宋体;">针对具体算法或算法属于的类型实现算法的操作集里面定义的钩子函数。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">4. <span style="font-size: 16px; font-family: 宋体;">对算法注册结构</span>crypto_alg<span style="font-size: 16px; font-family: 宋体;">或</span><span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">crypto_type</span><span style="font-size: 16px; font-family: 宋体;">中成员结构进行赋值。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;">5. <span style="font-size: 16px; font-family: 宋体;">在加载卸载算法时进行注册、注销操作。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-size: 16px; color: rgb(2, 30, 170);"><span style="font-size: 16px; font-family: 宋体; font-weight: bold;">1.3.3.&nbsp;</span><strong style="line-height: 1.6; font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;">算法测试</span></strong><strong style="line-height: 1.6; font-size: 16px;"><span style="font-size: 16px; font-family: 宋体;"></span></strong></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 14px;"><span style="font-size: 16px; font-family: 宋体;">掌握了内核如何实现算法，那么怎么能判断一个算法是否是一个好的算法？一个好的算法要做到消息内容安全和加解密速度的平衡。也就是说在保证消息安全的同时也要使消息的加解密速度尽可能快，不能为了安全而单纯提高密钥的位数，这样的结构使得加解密过程比较耗时。当然也不能纯粹为了提高加解密的速度而放弃了消息的安全性。内核给出了算法加解密执行速度测的程序。测试代码位于</span>/linux-3.5.4/crypto/tcrypt.c<span style="font-size: 16px; font-family: 宋体;">。</span></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-family: 宋体; font-size: 16px;">在测试算法时使用slab分配器为算法测试分配空间。算法性能的测试几乎包含了内核提供的所有算法。这里的检测主要是通过对加解密的速度进行检测。以<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">cipher</span>算法为例，它的算法测试函数为<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">test_cipher_speed</span>，该函数的执行首先判断是进行算法加密测试还是解密测试，确定加解密形式之后对算法分配对象<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">tfm</span>，然后对其进行密钥的设置、表的初始化、设置缓冲区以及获取初始化向量的大小，最后通过<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">sec</span>变量选择调用<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">test_cipher_jiffies</span>还是<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">test_cipher_cycles</span>。其中函数<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">test_cipher_jiffies</span>主要是对加密或解密操作处理消息的时间进行计数。而函数<span style="font-size: 16px; font-family: &#39;Times New Roman&#39;;">test_cipher_cycles</span>则是对算法的执行轮数中对消息的处理进行时间计数，执行过程中主要是通过加密或解密轮数进行速度测试。</span></p><p style="margin-right:0;margin-left:0;text-indent:28px"><span style="font-family: Calibri; font-size: 14px;"><br  /></span></p><p style="margin-top:0;margin-right:0;margin-bottom:0;margin-left:0;text-indent:28px;text-autospace:ideograph-numeric;text-align:justify;text-justify:inter-ideograph;line-height:24px"><span style="font-size: 16px; font-family: 宋体;"><br  /><br  /></span></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_reward_area" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_reward_avatar">
                        <img src="" alt="" id="js_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" style="display: none;" id="js_reward_author">于运超</div>
                                                            <p class="reward_button_wrp">
                      <span id="js_author_reward_qrcode" class="reward_pop_panel">
                        <img id="js_author_reward_qrcode_img" src="" alt="赞赏二维码">
                        <strong>微信扫一扫赞赏作者</strong>
                      </span>
                        <a class="reward_button" id='js_reward_link' href="##"><span id="js_reward_link_text">赞赏</span></a>
                    </p>
                    <div id="js_reward_inner" class="reward_area_inner" style="display:none;">
                        <p class="weui-loadmore weui-loadmore_line reward_user_tips" id="js_reward_total_parent">
                          <span class="weui-loadmore__tips">
                            <a href="javascript:;" id="js_reward_total"></a>&nbsp;<span id="js_reward_total_text">人赞赏</span>
                        </span>
                        </p>
                        
                        <div id="js_reward_list" class="reward_user_list"></div>
                        <div id="js_reward_pagination" class="simple_pagination" style="display: none;">
                          <button disabled class="btn_sp_prev js_reward_pagination_prev">上一页</button>
                          <span class="sp_page_num_area">
                            <a class="sp_page_current js_reward_pagination_curpage" href="javascript:;">1</a>&#47;<span class="sp_page_num js_reward_pagination_totalpage">3</span>
                          </span>
                          <button class="btn_sp_next js_reward_pagination_next">下一页</button>
                        </div>
                    </div>
                </div>
                                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='https://www.52pojie.cn/' target='_blank'>
			吾爱破解论坛
		</a>
	</div>
</body>