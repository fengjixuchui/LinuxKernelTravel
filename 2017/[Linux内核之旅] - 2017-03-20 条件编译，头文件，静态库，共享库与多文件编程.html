<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		条件编译，头文件，静态库，共享库与多文件编程
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzI3NzA5MzUxNA==&amp;mid=2664603857&amp;idx=2&amp;sn=bdcf500f398d531b151c2d1f82b5f0a2&amp;chksm=f04d8d34c73a0422150c834e9566cf3f77324d2f6cc6f83c84b9c297d7afd417fce4c9fe00f0&amp;scene=27#wechat_redirect&cpage=45' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">条件编译，头文件，静态库，共享库与多文件编程</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux内核之旅</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux内核之旅</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxKernelTravel</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">Linux内核之旅</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2017-03-20</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <h1 style="margin: 10px 0px; padding: 0px; font-weight: 400; font-size: 28px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 41, 65);"><strong><span style="font-size: 18px;">本文转载自嵌入式Linux中文站</span></strong></span></h1><h1 style="margin: 10px 0px; padding: 0px; font-weight: 400; font-size: 28px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 128, 255);"><strong><span style="font-size: 18px;">条件编译</span></strong></span></h1><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">条件编译即满足某些条件的时候编译某部分代码，常用于开发多个版本的程序，当满足条件A时，编译出免费版本的软件，当满足条件B时，编译除vip版本的软件，可以提高代码的复用率。条件编译使用"预处理命令+宏定义"来实现，更多宏命令参见</span></p><pre style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; overflow: auto; font-size: 13.3333px; line-height: 20px; color: rgb(51, 51, 51); word-break: break-all; border-width: medium; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-radius: 4px; font-stretch: normal; white-space: pre-wrap; background-color: rgb(39, 40, 34);"><code class="" style="margin: auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(0, 0, 0); vertical-align: middle; display: block; height: auto; overflow-x: auto; background-image: initial; background-attachment: initial; background-color: transparent; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span style="font-size: 16px;"><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; color: rgb(178, 178, 178);">$vi tutu.c</span><br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(43, 145, 175);">#<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">ifdef</span> VIP &nbsp; &nbsp;<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">//也可以写成<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  />#if defined (VIP)</span></span><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: green;">//把免费版改造成VIP版的代码<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /></span><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(43, 145, 175);">#<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">elif</span> defined PRO</span><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: green;">//把免费版改造成PRO版代码<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /></span><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(43, 145, 175);">#<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">endif</span></span><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: green;">//免费版本的代码<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /><br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /></span><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; color: rgb(178, 178, 178);">$gcc -DVIP tutu.c &nbsp;</span> &nbsp;<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: green;">//将编译出VIP版的软件 </span></span></code></pre><h1 style="margin: 10px 0px; padding: 0px; font-weight: 400; font-size: 28px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">头文件header</span></h1><h3 style="margin: 10px 0px; padding: 0px; font-weight: bold; font-size: 16px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 18px; color: rgb(0, 128, 255);">头文件的编写</span></strong></h3><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">C语言的标识符在使用之前一定要声明，把所有的标识符的声明都放在一个头文件中，在预处理阶段把这些声明一股脑的复制到源文件的开头，这样任何标识符在使用之前不就都被声明过了。但这个方案引起了一个问题，就是如果我调用了fcn.c的函数，包括了它的头文件fcn.h，我的同事也这么做，那么编译的文件中不就有了两份fcn.h，而一个项目数百的文件，每个文件都有自己的头文件，还会有相互调用的问题，这样编译器的压力就会很大，所以就有了"头文件卫士"：</span></p><pre style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; overflow: auto; font-size: 13.3333px; line-height: 20px; color: rgb(51, 51, 51); word-break: break-all; border-width: medium; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-radius: 4px; font-stretch: normal; white-space: pre-wrap; background-color: rgb(39, 40, 34);"><code class="" style="margin: auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(0, 0, 0); vertical-align: middle; display: block; height: auto; overflow-x: auto; background-image: initial; background-attachment: initial; background-color: transparent; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span style="font-size: 16px;"><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(43, 145, 175);">#<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">ifndef</span> __FCN_H<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  />#<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">define</span> __FCN_H</span>
 &nbsp; &nbsp;<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: green;">//fcn.c里标识符声明<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /><br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /></span><span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(43, 145, 175);">#<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">endif</span> &nbsp; &nbsp;<span class="" style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">//__FCN_N</span></span></span></code></pre><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">这三句话就保证了这个头文件在整个程序中只有一份，因为一旦第一次使用这个头文件的时候，__FCN_H还没有被定义，那么他就会被定义，里面的声明代码也会被使用，如果再由文件使用这个头文件，那么由于__FCN_H已经被定义了，条件编译的条件不满足，所以里面的声明代码也就不会再被使用，反正声明有一份就够了。</span></p><h3 style="margin: 10px 0px; padding: 0px; font-weight: bold; font-size: 16px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 128, 255);"><strong><span style="font-size: 18px;">头文件的使用</span></strong></span></h3><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">头文件需要使用#include宏命令把头文件原封不动的复制到当前文件夹</span></p><pre style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; overflow: auto; font-size: 13.3333px; line-height: 20px; color: rgb(51, 51, 51); word-break: break-all; border-width: medium; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-radius: 4px; font-stretch: normal; white-space: pre-wrap; background-color: rgb(39, 40, 34);"><code class="" style="margin: auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(0, 0, 0); vertical-align: middle; display: block; height: auto; overflow-x: auto; background-image: initial; background-attachment: initial; background-color: transparent; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(43, 145, 175); font-size: 16px;">#include&lt;标准头文件&gt; //在默认头文件路径里查找头文件，如果找不到就报错<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  />#include<span class="" style="color: rgb(43, 145, 175); font-size: 16px; margin: 0px; padding: 0px; max-width: 100%;">"头文件路径" </span>//按照指定的路径查找头文件，找不到就到默认头文件路径查找，还是找不到就报错</span></code></pre><h1 style="margin: 10px 0px; padding: 0px; font-weight: 400; font-size: 28px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><span style="font-size: 18px;">静态库</span></h1><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">静态库:由若干个.o目标文件打包生成的.a文件叫静态库文件, 链接静态库就是将被调用的代码指令到调用模块中,并体现在最终的可执行文件中 ，静态库只能静态链接，<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  />优势</span></p><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">不需跳转,执行效率较共享库高一些</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">使用静态库的代码在运行时不需要依赖静态库</span></p></li></ul><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">劣势</span></p><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">静态库占用空间比较大,多次链接(多次复制)之后最终生成的可执行文件比较大</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">修改维护不方便,库文件改一点,链接它的文件就得从头复制一遍</span></p></li></ul><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 18px;">生成静态库</span></p><ol class=" list-paddingleft-2" style="margin: 0px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">编写.c文件 $vi add.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">生成.o文件 $cc -c add.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">生成静态库文件 $ar –r libadd.a add.o</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">链接静态库文件 $cc -o main main.o -static -ladd -L.<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  />Note:</span></p></li></ol><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">对于临时使用不在公用库目录的库,链接前可以把库的路径添加到LIBRARY_PATH,</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$export LIBRARY_PATH=$LIBRARY_PATH:`pwd`</span></code></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">或者使用直接链接</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$cc main.o ./libadd.a</span></code></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">或者使用编译选项链接</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$cc main.o -ladd –L.</span></code></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">和动态库不同，静态库不存在运行时找不到的问题，编译时就把所有库问题解决了。</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">add是库名,libadd不是，是文件名</span></p></li></ul><h1 style="margin: 10px 0px; padding: 0px; font-weight: 400; font-size: 28px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><span style="font-size: 18px;">共享库</span></h1><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">共享库就是由若干个目标文件打包生成的xxx.so文件 ，链接共享库不是将被调用代码指令复制到调用模块中，而是将被调用代码指令在共享库中的相对地址复制到调用模块中, 体现在最终的可执行文件中，不论静态链接还是动态链接(共享库可以静态链接也可以动态链接)。 Linux下进行链接的缺省操作是先考虑动态链接库，即如果同时存在静态和共享库，不特别指定的话，将与共享库相连接</span></p><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">优势</span></p><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">共享库占用空间比较小, 生成的可执行文件比较小, 即使修改了库中的代码, 只要相对地址/接口保持不变, 则不需要重新链接.</span></p></li></ul><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">劣势</span></p><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">使用共享库的代码在运行时需要依赖共享库, 并且执行效率较静态库低。</span></p></li></ul><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 18px; color: rgb(0, 128, 255);">生成共享库</span></strong></p><ol class=" list-paddingleft-2" style="margin: 0px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">编写.c文件 $vi add.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">生成.o文件 $cc -c -fpic add.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">生成共享库文件 $cc -shared -o libadd.so add.o</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">链接共享库 $cc -o main main.o -ladd -L.</span></p></li></ol><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;"><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">Q</strong></span>:如果本文件夹有了</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">libdl.a</span></code><span style="font-size: 16px;">或者</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">libdl.so</span></code><span style="font-size: 16px;">会链接本文件夹的还是系统默认的???<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">A</strong></span>:如果使用</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$gcc main.o -L. -ldl</span></code><span style="font-size: 16px;">当然会链接本文件夹的, 你当-L.是空气啊</span></p><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">Note：</span></p><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">-fpic是生成位置无关码的选项, 即生成相对地址</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$ldd a.out</span></code><span style="font-size: 16px;">&nbsp;#查看a.out所依赖的共享库信息</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">对于临时使用的不在公用库目录的共享库,链接后可以把库的路径添加到LD_LIBRARY_PATH:</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:`pwd`</span></code></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">如要永久更改动态库的搜索目录，可以创建文件</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">/etc/ld.so.conf.d/my.config</span></code><span style="font-size: 16px;">并将路径写入其中，再使用</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$ldconfig /etc/ld.so.conf.d/my.config</span></code><span style="font-size: 16px;">配置链接选项</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">与静态库不同，修改环境变量和配置文件都是用来解决运行时找不到库的问题，并不针对编译时链接的问题，编译时还是要使用</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">-L.</span></code></p></li></ul><h1 style="margin: 10px 0px; padding: 0px; font-weight: 400; font-size: 28px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><strong><span style="font-size: 18px; color: rgb(0, 128, 255);">静态链接</span></strong></h1><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">静态链接，即编译时链接，使用-static可以强制链接静态库<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">Q</strong></span>:静态链接时调用函数需要包含相应库的头文件吗?<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">A</strong></span>:需要. 链接我们熟知的</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">#include&lt;stdio.h&gt;...</span></code><span style="font-size: 16px;">对应的</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">libc.so</span></code><span style="font-size: 16px;">时就是使用的静态链接, 默认都是静态链接共享库,也可以使用</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">$gcc –static</span></code><span style="font-size: 16px;">强制链接静态库</span><code style="margin: 1px 5px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(199, 37, 78); line-height: 1.8; vertical-align: middle; display: inline-block;"><span style="font-size: 16px;">libc.a</span></code><span style="font-size: 16px;">,任何一个库都有两个版本:.a版本和.so版本</span></p><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">静态链接:</span></p><ol class=" list-paddingleft-2" style="margin: 0px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">编写.c文件 $vi main.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">生成.o文件 $cc -c main.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">链接库文件 $cc main.o –ladd</span></p></li></ol><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">Note:</span></p><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">开发时，使用静态链接，以便gcc能够找到编译时需要的共享库。</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">发布时，使用动态链接，以便程序加载运行时能够自动找到需要的共享库。</span></p></li></ul><h1 style="margin: 10px 0px; padding: 0px; font-weight: 400; font-size: 28px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(62, 62, 62); font-style: normal; font-variant: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 1.5; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 128, 255);"><strong><span style="font-size: 18px;">动态链接</span></strong></span></h1><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">动态链接:运行时链接，建立在静态链接libdl.so(a)库的基础上, 程序在运行过程中动态地链接共享库，所以需要在源代码中写链接代码，编译器是无能为力了，只能帮到dl库了<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">Q</strong></span>:动态链接时调用函数需要包含相应库的头文件吗?<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">A</strong></span>:动态链接libadd.so是建立在静态链接 libdl.so的基础上的, 既然后者是静态链接, 当然还需要包含相应的,但libadd.so里的函数在调用时就不需要相应的头文件了</span></p><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;"><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">Q</strong></span>:-ldl是不是因为使用的???<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">A</strong></span>:是,man dlopen,这个库包含实现动态链接的代码<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">ATENTION:</strong></span>动态链接和静态链接不是并列关系,是依存关系, 没有静态链接的libdl.so(a), 动态链接就是个屁</span></p><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;"><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">Q</strong></span>: 为什么共享库要有执行权限, 静态库不需要<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;"  /><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; text-decoration: underline;"><strong style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important;">A</strong></span>:因为共享库在运行时使用，静态库在编译时里面的代码已经链接到程序里了，运行时和静态库就没关系了</span></p><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">动态连续需要静态链接dl.so库:</span></p><ol class=" list-paddingleft-2" style="margin: 0px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">编写.c文件 $vi main.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">生成.o文件 $cc -c main.c</span></p></li><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">链接库文件 $cc main.o –ldl</span></p></li></ol><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;">动态链接的源文件</span></p><pre style="margin: 10px 0px; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; overflow: auto; font-size: 13.3333px; line-height: 20px; color: rgb(51, 51, 51); word-break: break-all; border-width: medium; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-radius: 4px; font-stretch: normal; white-space: pre-wrap; background-color: rgb(39, 40, 34);"><code class="" style="margin: auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; color: rgb(0, 0, 0); vertical-align: middle; display: block; height: auto; overflow-x: auto; background-image: initial; background-attachment: initial; background-color: transparent; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; color: rgb(255, 255, 255); font-size: 16px;">#include&lt;stdio.h&gt;<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  />#include&lt;stdlib.h&gt;<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  />#include&lt;dlfcn.h&gt;<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /><br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  />int main(){<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /> &nbsp;void *handle=dlopen("../libfcn.so",RTLD_NOW);<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /> &nbsp;if(NULL==handle)<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /> &nbsp; &nbsp;printf("%s",dlerror()), exit(-1); &nbsp; &nbsp; &nbsp; &nbsp;
 &nbsp;int (*pAdd)(int,int)=(int (*)(int,int))dlsym(handle, "add");<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /> &nbsp;if(NULL==pAdd) &nbsp; &nbsp; &nbsp;
 &nbsp; &nbsp;printf("%s",dlerror()),exit(-1); &nbsp; &nbsp;
 &nbsp;printf("%d\n",pAdd(1,2)); &nbsp; &nbsp;
 &nbsp;int res=dlclose(handle);<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /> &nbsp;if(0!=res)<br style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important;"  /> &nbsp; &nbsp;printf("%s",dlerror()),exit(-1); &nbsp; &nbsp;
 &nbsp;return 0;
} &nbsp;</span></code></pre><p style="margin: 10px auto; padding: 0px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word; clear: both; min-height: 1em; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><span style="font-size: 16px;"><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; color: rgb(0, 0, 0);">Note</span><span style="font-size: 16px; margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; color: rgb(255, 255, 255);">:</span></span></p><ul class=" list-paddingleft-2" style="margin: 0px 0px 0px 30px; padding: 0px 0px 0px 30px; max-width: 100%; box-sizing: border-box; overflow-wrap: break-word ! important; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 13.3333px; background-color: rgb(255, 255, 255);"><li><p style="margin: 0px; padding: 0px; max-width: 100%; box-sizing: border-box ! important; overflow-wrap: break-word ! important; clear: both; min-height: 1em;"><span style="font-size: 16px;">-l是静态链接库名选项, dl是共享库名(libdl.so), 用来实现我们程序中的动态加载卸载libadd.so</span></p></li></ul><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name"></div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p class="reward_button_wrp">
                    
                      <span class="reward_pop_panel">
                        <img src="https://res.wx.qq.com/mpres/zh_CN/htmledition/pages/home/index/pic_mp_app4290ba.png" alt="">
                        <strong>扫一扫下载订阅号助手，用手机发文章</strong>
                      </span>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='http://mp.weixin.qq.com/s/KJh3qyElu2gWk74pIRT_tQ#rd' target='_blank'>
			阅读全文
		</a>
	</div>
</body>